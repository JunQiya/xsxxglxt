(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f33c7efc"],{3917:function(t,a,e){"use strict";e.r(a),e.d(a,"totalStats",(function(){return s}));var i=e("b775");function s(){return Object(i["default"])({url:"/stats/totalStats",method:"get"})}},"715f":function(t,a,e){},"9df5":function(t,a,e){"use strict";e("715f")},e293:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"fullscreen-container"},[a("dv-border-box-11",{staticClass:"dashboard-container",attrs:{title:"滇西科技师范学院"}},[a("div",{staticClass:"main-content"},[a("div",{staticClass:"left-section"},[a("dv-border-box-8",{staticStyle:{height:"100%"}},[a("dv-scroll-board",{key:t.scrollBoardKey,staticStyle:{width:"calc(100% - 20px)",height:"calc(80% - 20px)",margin:"10px"},attrs:{config:t.scrollBoardConfig}},[0===t.scrollBoardConfig.data.length?a("div",{staticClass:"empty-tip"},[t._v(" "+t._s(t.loading?"数据加载中...":"暂无请假记录")+" ")]):t._e()]),a("dv-percent-pond",{staticStyle:{width:"calc(100% - 20px)",height:"calc(20% - 10px)",margin:"10px"},attrs:{config:t.precentPondConfig}})],1),a("dv-border-box-8",{staticStyle:{height:"75%"}},[a("dv-capsule-chart",{staticStyle:{width:"100%",height:"100%"},attrs:{":key":t.capsuleRefreshKey,config:t.cCapsuleChartConfig}})],1)],1),a("div",{staticClass:"center-section"},[a("div",{staticClass:"slider"},[a("img",{style:{transform:"translateZ(0)"},attrs:{src:t.images[t.currentIndex]},on:{load:t.handleImageLoad}})]),a("dv-border-box-8",{staticStyle:{height:"75%"}},[a("div",{attrs:{id:"stackedLine"}})])],1),a("div",{staticClass:"right-section"},[a("dv-border-box-8",{staticStyle:{height:"100%"}},[a("h2",[t._v("本月卫生评分")]),a("dv-active-ring-chart",{staticStyle:{width:"100%",height:"100%"},attrs:{":key":t.ringRefreshKey,config:t.ringChartConfig}})],1),a("dv-border-box-8",{staticStyle:{height:"75%"}},[a("div",{staticClass:"digital-grid"},t._l(t.totalStats,(function(e,i){return a("div",{key:i,staticClass:"digital-item"},[a("div",{staticClass:"digital-label"},[t._v(t._s(e.label))]),a("div",{staticClass:"digital-value"},[a("span",{staticClass:"value-bg"},[t._v(t._s(e.value))]),a("animated-number",{staticClass:"value-front",attrs:{value:e.value,duration:1e3,easing:"easeOutCubic"}})],1)])})),0)])],1)])]),a("div",{staticClass:"float-button",on:{click:t.handleBack}},[t._m(0)])],1)},s=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"button-content"},[a("i",{staticClass:"el-icon-back"},[t._v(" 返回 ")])])}],n=(e("14d9"),e("13d5"),e("e9f5"),e("910d"),e("7d54"),e("ab43"),e("9485"),e("2b0e")),r=e("6c29"),o=e("313e"),l=e("5a0c"),c=e.n(l),d=e("5992"),h=e.n(d),g=e("21f4"),u=e("49e5"),f=e("70ad"),m=e("8757"),C=e("3917");n["default"].component("animated-number",h.a),n["default"].use(r["a"]);var p={data(){return{ringRefreshKey:0,capsuleRefreshKey:0,scrollBoardKey:0,loading:!1,listQuery:{page:1,rows:99999,entity:{}},imgRatio:.5625,isHovering:!1,images:["https://xsxx.lxxno.cn/2025xszhwz/other/1.png","https://xsxx.lxxno.cn/2025xszhwz/other/2.png","https://xsxx.lxxno.cn/2025xszhwz/other/3.png"],currentIndex:0,timer:null,totalStats:[],countConifg:{number:[100],content:"{nt}个"},ringChartConfig:{data:[]},cCapsuleChartConfig:{data:[]},scrollBoardConfig:{header:["姓名","请假时间","返校时间"],data:[],index:!1,columnWidth:[80],align:["center"]},precentPondConfig:{value:0,borderWidth:1,borderRadius:5,borderGap:5,localGradient:!1}}},methods:{handleBack(){this.$router.push("/")},async listData(){try{this.loading=!0,this.scrollData(),this.percentPondData(),this.cCapsuleChartData(),this.ringChartData(),this.digitalData()}finally{this.loading=!1}},async fetchScoreTrend(){try{const{data:t}=await Object(m["getScoreTrend"])();console.log("zhexian"+t),t&&t.length>0?this.processChartData(t):(console.warn("无评分趋势数据"),this.myChart.clear())}catch(t){console.error("获取评分趋势失败:",t),this.myChart.showLoading("default",{text:"数据加载失败"})}},processChartData(t){const a=t.map(t=>t.month),e=[{name:"综合评分",data:t.map(t=>t.globalAvg.toFixed(1)),type:"line",smooth:!0},{name:"建筑评分",data:t.map(t=>t.buildingAvg.toFixed(1)),type:"line",smooth:!0},{name:"床位评分",data:t.map(t=>t.bedAvg.toFixed(1)),type:"line",smooth:!0},{name:"室内评分",data:t.map(t=>t.indoorAvg.toFixed(1)),type:"line",smooth:!0}];this.updateChartConfig(a,e)},updateChartConfig(t,a){const e={title:{text:"宿舍卫生评分趋势",textStyle:{color:"#fff",fontSize:16},left:"center"},tooltip:{trigger:"axis",formatter:t=>{const a=t[0].axisValue;return t.map(t=>`\n          <div style="display: flex; align-items: center">\n            <span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${t.color};margin-right:5px"></span>\n            ${t.seriesName}: ${t.value}分\n          </div>\n        `).join("")+`<div>${a}</div>`}},legend:{data:a.map(t=>t.name),textStyle:{color:"#fff"},bottom:10},grid:{top:60,bottom:80,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLabel:{color:"#fff",formatter:t=>c()(t).format("YYYY-MM")},axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",min:0,max:10,axisLabel:{color:"#fff",formatter:"{value} 分"},splitLine:{lineStyle:{color:"rgba(255,255,255,0.1)"}},axisLine:{lineStyle:{color:"#fff"}}},series:a.map((t,a)=>({...t,lineStyle:{width:2,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:8},itemStyle:{color:["#4FFA6E","#FFC233","#FF6D4A","#6A8BFF"][a]},areaStyle:{color:new o["a"].LinearGradient(0,0,0,1,[{offset:0,color:this.getAreaColor(a)},{offset:1,color:"rgba(255,255,255,0)"}])}}))};this.myChart.setOption(e,!0),this.myChart.hideLoading()},getAreaColor(t){const a=["rgba(79,250,110,0.3)","rgba(255,194,51,0.3)","rgba(255,109,74,0.3)","rgba(106,139,255,0.3)"];return a[t]},async digitalData(){const{data:t}=await Object(C["totalStats"])(),a=[{label:"维修上报数",value:t[0].repairCount,color:{gradient:["#00F2FE","#4FACFE"]}},{label:"请假申请数",value:t[0].leaveCount,color:{gradient:["#FAD961","#F76B1C"]}},{label:"病因上报数",value:t[0].absenceCount,color:{gradient:["#6F86FF","#48C6EF"]}},{label:"学生总人数",value:t[0].studentNum,color:{gradient:["#42E695","#3BB2B8"]}}];this.totalStats=a},async ringChartData(){const{data:t}=await Object(m["stats"])();console.log(t[0].acount);const a=[{name:"A级",value:t[0].acount},{name:"B级",value:t[0].bcount},{name:"C级",value:t[0].ccount},{name:"D级",value:t[0].dcount}];this.ringChartConfig={...this.ringChartConfig,data:a,lineWidth:50},console.log(this.ringChartConfig),this.ringRefreshKey=Date.now()},async cCapsuleChartData(){const{data:t}=await Object(f["getAllStudentNum"])(),a=t.map(t=>({name:t.name,value:t.studentNum}));this.cCapsuleChartConfig={...this.cCapsuleChartConfig,data:a,colors:["#4FACFE","#F76B1C"],unit:"人",showValue:!0},this.capsuleRefreshKey=Date.now()},async percentPondData(){const{data:t}=await Object(u["list"])(this.listQuery),a=t.list.length,e=t.list.reduce((t,a)=>a.isLeave?t+1:t,0),i=a>0?((a-e)/a*100).toFixed(2):0;this.precentPondConfig={...this.precentPondConfig,value:parseFloat(i)}},async scrollData(){const{data:t}=await Object(g["list"])(this.listQuery),a=t.list.filter(t=>!t.isBack).map(t=>{var a;return[(null===(a=t.student)||void 0===a?void 0:a.name)||"未知",this.formatTime(t.time),this.formatTime(t.backDate)]});this.$set(this.scrollBoardConfig,"data",a),this.scrollBoardKey=Date.now()},formatTime(t){return c()(t).format("YYYY-MM-DD HH:mm")},handleImageLoad(t){const a=t.target;this.imgRatio=a.naturalHeight/a.naturalWidth,this.$nextTick(()=>{this.$forceUpdate()})},prevSlide(){this.currentIndex=0===this.currentIndex?this.images.length-1:this.currentIndex-1},nextSlide(){this.currentIndex=(this.currentIndex+1)%this.images.length}},mounted(){this.images.forEach(t=>{(new Image).src=t}),this.timer=setInterval(()=>{this.nextSlide()},2e3),this.myChart=o["b"](document.getElementById("stackedLine")),window.addEventListener("resize",()=>this.myChart.resize()),this.fetchScoreTrend()},beforeDestroy(){clearInterval(this.timer),this.myChart&&(this.myChart.dispose(),window.removeEventListener("resize",this.myChart.resize))},created(){this.listData()}},v=p,b=(e("9df5"),e("2877")),y=Object(b["a"])(v,i,s,!1,null,"64fb9b9b",null);a["default"]=y.exports}}]);
//# sourceMappingURL=chunk-f33c7efc.a47e0f76.js.map