{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\thread-loader\\dist\\cjs.js!G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js!G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\permission.js","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\permission.js","mtime":1762576666518},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\babel.config.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762576413111}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHJvdXRlciBmcm9tICIuL3JvdXRlciI7CmltcG9ydCBzdG9yZSBmcm9tICIuL3N0b3JlIjsKaW1wb3J0IHsgcmVzb2x2ZVJvdXRlciB9IGZyb20gJy4vQ29tcG9uZW50c01hcCc7CmltcG9ydCB7IGdldFRva2VuLCBzZXRUb2tlbiB9IGZyb20gIi4vdXRpbHMvYXV0aCI7CmltcG9ydCB7IGNvdW50VW5yZWFkLCBnZXRJbmZvIH0gZnJvbSAiLi9hcGkvbG9naW4iOwppbXBvcnQgeyBOb3RpZmljYXRpb24gfSBmcm9tICdlbGVtZW50LXVpJzsKcm91dGVyLmJlZm9yZUVhY2goYXN5bmMgKHRvLCBmcm9tLCBuZXh0KSA9PiB7CiAgaWYgKHRvLm1ldGEudGl0bGUpIHsKICAgIGRvY3VtZW50LnRpdGxlID0gdG8ubWV0YS50aXRsZSB8fCAn5a2m55Sf5a6/6IiN566h55CG57O757ufJzsKICB9CiAgbGV0IGhhc1Rva2UgPSBnZXRUb2tlbigpOwogIGlmIChoYXNUb2tlKSB7CiAgICBpZiAoc3RvcmUuc3RhdGUuaGFzUm9sZSkgewogICAgICBpZiAodG8ubWF0Y2hlZC5sZW5ndGggPT09IDApIHsKICAgICAgICBuZXh0KCcvNDA0Jyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX0hBU19ST0xFJywgdHJ1ZSk7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhCiAgICAgIH0gPSBhd2FpdCBnZXRJbmZvKCk7CiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBjb3VudFVucmVhZCgpOwogICAgICAgIGlmIChjb3VudCkgewogICAgICAgICAgc3RvcmUuY29tbWl0KCdTRVRfQ09VTlRfVU5SRUFEJywgY291bnQuZGF0YSk7CiAgICAgICAgfQogICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1BFUk1JU1NJT04nLCBkYXRhLnBlcm1pc3Npb25zKTsKICAgICAgICBzdG9yZS5jb21taXQoJ1NFVF9NRU5VJywgZGF0YS5mdW5jdGlvbnMpOwogICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1VTRVJfTkFNRScsIGRhdGEucmVhbE5hbWUpOwogICAgICAgIGlmIChkYXRhLmljb24pIHsKICAgICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1VTRVJfSUNPTicsIHByb2Nlc3MuZW52LlZVRV9BUFBfSU1HX1BSRUZJWCArIGRhdGEuaWNvbik7CiAgICAgICAgfQogICAgICAgIC8v6L+e5o6lc29ja2V0CiAgICAgICAgbGV0IHNvY2tldCA9IGF3YWl0IG5ldyBXZWJTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9XRUJTT0NLRVQgKyBkYXRhLmxvZ2luTmFtZSk7CiAgICAgICAgc29ja2V0Lm9ubWVzc2FnZSA9IGFzeW5jIGV2ID0+IHsKICAgICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShldi5kYXRhKTsKICAgICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgY291bnRVbnJlYWQoKTsKICAgICAgICAgIGlmIChjb3VudCkgewogICAgICAgICAgICBzdG9yZS5jb21taXQoJ1NFVF9DT1VOVF9VTlJFQUQnLCBjb3VudC5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09IDEpIHsKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSAiIjsKICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZUJvZHkubGVuZ3RoIDwgMTUpIHsKICAgICAgICAgICAgICBtZXNzYWdlID0gZGF0YS5mcm9tICsgIjoiICsgZGF0YS5tZXNzYWdlQm9keTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXNzYWdlID0gZGF0YS5mcm9tICsgIjoiICsgZGF0YS5tZXNzYWdlQm9keS5zdWJzdHIoMCwgMTUpICsgIi4uLiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICB0aXRsZTogZGF0YS50aXRsZSwKICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgICAgICAgIG9mZnNldDogNTAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gMikgewogICAgICAgICAgICBOb3RpZmljYXRpb24oewogICAgICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICLpgIDlrr/nkIbnlLHvvJoiICsgZGF0YS5tZXNzYWdlQm9keSwKICAgICAgICAgICAgICBvZmZzZXQ6IDUwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgc29ja2V0Lm9uY2xvc2UgPSAoKSA9PiB7CiAgICAgICAgICBOb3RpZmljYXRpb24oewogICAgICAgICAgICB0aXRsZTogJ+i/nuaOpeS4reaWrScsCiAgICAgICAgICAgIG1lc3NhZ2U6ICdzb2NrZXTov57mjqXkuK3mlq3vvIzlsJ3or5XliLfmlrDmtY/op4jlmagnLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1NPQ0tFVCcsIHNvY2tldCk7CiAgICAgICAgbGV0IHJvdSA9IFtdOwogICAgICAgIHJlc29sdmVSb3V0ZXIoZGF0YS5mdW5jdGlvbnMsIHJvdSk7CiAgICAgICAgYXdhaXQgcm91dGVyLmFkZFJvdXRlcyhyb3UpOwogICAgICAgIG5leHQoewogICAgICAgICAgLi4udG8sCiAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgY29uc3QgaGFzaCA9IHt9OwogICAgY29uc3QgYXJyID0gdG8ucGF0aC5zdWJzdHJpbmcoMSkuc3BsaXQoL1s9Jl0vKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSA9IGkgKyAyKSB7CiAgICAgIGlmIChhcnJbaV0pIGhhc2hbYXJyW2ldXSA9IGFycltpICsgMV07CiAgICB9CiAgICBpZiAoaGFzaFsndG9rZW4nXSkgewogICAgICBzZXRUb2tlbihoYXNoWyd0b2tlbiddKTsKICAgICAgbmV4dCgiL2luZGV4Iik7CiAgICB9IGVsc2UgewogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHByb2Nlc3MuZW52LlZVRV9BUFBfU1NPOwogICAgfQogIH0KICBuZXh0KCk7Cn0pOw=="},{"version":3,"names":["router","store","resolveRouter","getToken","setToken","countUnread","getInfo","Notification","beforeEach","to","from","next","meta","title","document","hasToke","state","hasRole","matched","length","commit","data","count","permissions","functions","realName","icon","process","env","VUE_APP_IMG_PREFIX","socket","WebSocket","VUE_APP_WEBSOCKET","loginName","onmessage","ev","JSON","parse","type","message","messageBody","substr","offset","onclose","rou","addRoutes","replace","hash","arr","path","substring","split","i","window","location","href","VUE_APP_SSO"],"sources":["G:/E/学生宿舍信息管理系统/DormitoryManagerVue/src/permission.js"],"sourcesContent":["import router from \"./router\";\nimport store from \"./store\";\nimport { resolveRouter } from './ComponentsMap'\nimport { getToken, setToken } from \"./utils/auth\";\nimport { countUnread, getInfo } from \"./api/login\";\nimport { Notification } from 'element-ui';\n\nrouter.beforeEach(async (to, from, next) => {\n    if (to.meta.title) {\n        document.title = to.meta.title || '学生宿舍管理系统'\n    }\n    let hasToke = getToken()\n\n    if (hasToke) {\n        if (store.state.hasRole) {\n            if (to.matched.length === 0) {\n                next('/404')\n            }\n        } else {\n            store.commit('SET_HAS_ROLE', true)\n            const { data } = await getInfo()\n            if (data) {\n                const count = await countUnread()\n                if (count) {\n                    store.commit('SET_COUNT_UNREAD', count.data)\n                }\n                store.commit('SET_PERMISSION', data.permissions)\n                store.commit('SET_MENU', data.functions)\n                store.commit('SET_USER_NAME', data.realName)\n                if (data.icon) {\n                    store.commit('SET_USER_ICON', process.env.VUE_APP_IMG_PREFIX + data.icon)\n                }\n                //连接socket\n                let socket = await new WebSocket(process.env.VUE_APP_WEBSOCKET + data.loginName)\n                socket.onmessage = async ev => {\n                    let data = JSON.parse(ev.data)\n                    const count = await countUnread()\n                    if (count) {\n                        store.commit('SET_COUNT_UNREAD', count.data)\n                    }\n                    if (data.type === 1) {\n                        let message = \"\"\n                        if (data.messageBody.length < 15) {\n                            message = data.from + \":\" + data.messageBody\n                        } else {\n                            message = data.from + \":\" + data.messageBody.substr(0, 15) + \"...\"\n                        }\n                        Notification({\n                            title: data.title,\n                            message: message,\n                            offset: 50\n                        });\n                    } else if (data.type === 2) {\n                        Notification({\n                            title: data.title,\n                            message: \"退宿理由：\" + data.messageBody,\n                            offset: 50\n                        });\n                    }\n                }\n                socket.onclose = () => {\n                    Notification({\n                        title: '连接中断',\n                        message: 'socket连接中断，尝试刷新浏览器',\n                        type: 'error'\n                    });\n                }\n                store.commit('SET_SOCKET', socket)\n                let rou = []\n                resolveRouter(data.functions, rou)\n                await router.addRoutes(rou)\n                next({ ...to, replace: true })\n            }\n        }\n    } else {\n        const hash = {};\n        const arr = to.path.substring(1).split(/[=&]/)\n        for (let i = 0; i < arr.length; i = i + 2) {\n            if (arr[i]) hash[arr[i]] = arr[i + 1]\n        }\n        if (hash['token']) {\n            setToken(hash['token'])\n            next(\"/index\")\n        } else {\n            window.location.href = process.env.VUE_APP_SSO\n        }\n    }\n    next()\n})\n\n"],"mappings":"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","ignoreList":[]}]}