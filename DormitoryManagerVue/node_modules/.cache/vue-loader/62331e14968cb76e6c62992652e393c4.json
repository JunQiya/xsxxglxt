{"remainingRequest":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\src\\views\\manage\\dayApplicationApproval\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\src\\views\\manage\\dayApplicationApproval\\index.vue","mtime":1743690156936},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762330415881},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyANCiAgICBnZXRDb3Vuc2Vsb3JQZW5kaW5nQXBwbGljYXRpb25zLA0KICAgIGFwcHJvdmVCeUNvdW5zZWxvciwNCiAgICBnZXRCeUNsYXNzTmFtZSwNCiAgICBnZXRCeVN0dWRlbnROYW1lLA0KICAgIGdldEJ5U3R1ZGVudE5vQW5kU3RhdHVzLA0KICAgIGdldEFwcHJvdmVkQXBwbGljYXRpb25zDQp9IGZyb20gJ0AvYXBpL2xlYXZlQXBwbGljYXRpb24nDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgICBkYXRhKCkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgYXBwbGljYXRpb25zOiBbXSwNCiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgICAgICAgc2VhcmNoQ2xhc3M6ICcnLA0KICAgICAgICAgICAgc2VhcmNoTmFtZTogJycsDQogICAgICAgICAgICBzZWFyY2hTdHVkZW50Tm86ICcnDQogICAgICAgIH0NCiAgICB9LA0KICAgIGNyZWF0ZWQoKSB7DQogICAgICAgIHRoaXMuZmV0Y2hQZW5kaW5nQXBwbGljYXRpb25zKCkNCiAgICB9LA0KICAgIG1ldGhvZHM6IHsNCiAgICAgICAgYXN5bmMgZmV0Y2hQZW5kaW5nQXBwbGljYXRpb25zKCkgew0KICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRDb3Vuc2Vsb3JQZW5kaW5nQXBwbGljYXRpb25zKCkNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5a6M5pW05ZON5bqUOicsIHJlcykNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyDkv67mlLnliKTmlq3mnaHku7blkozmlbDmja7ot6/lvoQNCiAgICAgICAgICAgICAgICBpZiAocmVzPy5zdGF0dXNDb2RlID09PSAyMDAgJiYgQXJyYXkuaXNBcnJheShyZXMuZGF0YSkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhdGlvbnMgPSByZXMuZGF0YQ0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5ZCO55qE5pWw5o2uOicsIHRoaXMuYXBwbGljYXRpb25zKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzPy5tc2cgfHwgJ+aVsOaNruagvOW8j+W8guW4uCcpICAvLyDkvb/nlKhtc2flrZfmrrUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ivt+axguW8guW4uDonLCBlcnJvci5yZXNwb25zZSB8fCBlcnJvcikNCiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ+ivt+axguWksei0pScpDQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGFzeW5jIGhhbmRsZUFwcHJvdmUocm93KSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIOS9v+eUqOWwgeijheWlveeahEFQSeaWueazlQ0KICAgICAgICAgICAgICAgIGF3YWl0IGFwcHJvdmVCeUNvdW5zZWxvcihyb3cuYXBwbHlJZCkNCiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WuoeaJueaIkOWKnycpDQogICAgICAgICAgICAgICAgLy8g5Yi35paw5YiX6KGo5pWw5o2uDQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5mZXRjaFBlbmRpbmdBcHBsaWNhdGlvbnMoKQ0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCflrqHmibnlpLHotKU6JywgZXJyb3IpDQogICAgICAgICAgICAgICAgLy8g5pi+56S65pu06K+m57uG55qE6ZSZ6K+v5L+h5oGvDQogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlcnJvci5yZXNwb25zZT8uZGF0YT8ubXNnIHx8ICflrqHmibnmk43kvZzlpLHotKUnKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGFzeW5jIHNlYXJjaEJ5Q2xhc3MoKSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuc2VhcmNoQ2xhc3MpIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+i+k+WFpeePree6p+WQjeensCcpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVNlYXJjaCgoKSA9PiBnZXRCeUNsYXNzTmFtZSh0aGlzLnNlYXJjaENsYXNzKSkNCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBzZWFyY2hCeU5hbWUoKSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuc2VhcmNoTmFtZSkgew0KICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+36L6T5YWl5a2m55Sf5aeT5ZCNJykNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU2VhcmNoKCgpID0+IGdldEJ5U3R1ZGVudE5hbWUodGhpcy5zZWFyY2hOYW1lKSkNCiAgICAgICAgfSwNCg0KICAgICAgICBhc3luYyBzZWFyY2hCeVN0dWRlbnRObygpIHsNCiAgICAgICAgICAgIGlmICghdGhpcy5zZWFyY2hTdHVkZW50Tm8pIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+i+k+WFpeWtpueUn+WtpuWPtycpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVNlYXJjaCgoKSA9PiBnZXRCeVN0dWRlbnROb0FuZFN0YXR1cyh0aGlzLnNlYXJjaFN0dWRlbnRObykpDQogICAgICAgIH0sDQogICAgICAgICAgICAgICAgLy8g6YCa55So5p+l6K+i5aSE55CGDQogICAgICAgIGFzeW5jIGhhbmRsZVNlYXJjaChhcGlDYWxsKSB7DQogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFwaUNhbGwoKQ0KICAgICAgICAgICAgICAgIGlmIChyZXM/LnN0YXR1c0NvZGUgPT09IDIwMCAmJiBBcnJheS5pc0FycmF5KHJlcy5kYXRhKSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9ucyA9IHJlcy5kYXRhDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXM/Lm1zZyB8fCAn5p+l6K+i5aSx6LSlJykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyb3IubWVzc2FnZSB8fCAn5p+l6K+i5aSx6LSlJykNCiAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICANCg0KICAgICAgICBhc3luYyBzZWFyY2hBcHByb3ZlZCgpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU2VhcmNoKGdldEFwcHJvdmVkQXBwbGljYXRpb25zKQ0KICAgICAgICB9LA0KICAgICAgICBmb3JtYXREYXRlKHJvdywgY29sdW1uLCBjZWxsVmFsdWUpIHsNCiAgICAgICAgICAgIGlmIChjZWxsVmFsdWUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoY2VsbFZhbHVlKS50b0xvY2FsZURhdGVTdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICcnDQogICAgICAgIH0NCiAgICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA8CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/dayApplicationApproval","sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <!-- 新增搜索表单 -->\r\n        <el-form :inline=\"true\" class=\"search-form\">\r\n            <el-form-item label=\"班级\">\r\n                <el-input v-model=\"searchClass\" placeholder=\"输入班级名称\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"姓名\">\r\n                <el-input v-model=\"searchName\" placeholder=\"输入学生姓名\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"学号\">\r\n                <el-input v-model=\"searchStudentNo\" placeholder=\"输入学生学号\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item>\r\n                <el-button type=\"primary\" @click=\"searchByClass\">按班级查</el-button>\r\n                <el-button type=\"success\" @click=\"searchByName\">按姓名查</el-button>\r\n                <el-button type=\"warning\" @click=\"searchByStudentNo\">按学号查</el-button>\r\n                <el-button type=\"info\" @click=\"searchApproved\">显示已通过</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n\r\n        <el-table :data=\"applications\" v-loading=\"loading\">\r\n            <el-table-column prop=\"studentName\" label=\"学生姓名\" width=\"120\"></el-table-column>\r\n            <el-table-column prop=\"className\" label=\"班级\" width=\"150\"></el-table-column>\r\n            <el-table-column prop=\"department\" label=\"院系\" width=\"150\"></el-table-column>\r\n            <el-table-column prop=\"phone\" label=\"联系电话\" width=\"120\"></el-table-column>\r\n            <el-table-column prop=\"startDate\" label=\"开始日期\" width=\"120\" :formatter=\"formatDate\"></el-table-column>\r\n            <el-table-column prop=\"endDate\" label=\"结束日期\" width=\"120\" :formatter=\"formatDate\"></el-table-column>\r\n            <el-table-column prop=\"reason\" label=\"请假原因\" min-width=\"200\"></el-table-column>\r\n            <el-table-column prop=\"counselorStatus\" label=\"审批状态\" width=\"100\">\r\n                <template #default=\"scope\">\r\n                    <el-tag :type=\"scope.row.counselorStatus === '待审核' ? 'warning' : 'success'\">\r\n                        {{ scope.row.counselorStatus }}\r\n                    </el-tag>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"操作\" width=\"120\">\r\n                <template #default=\"scope\">\r\n                    <el-button type=\"primary\" size=\"small\" @click=\"handleApprove(scope.row)\">审批通过</el-button>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { \r\n    getCounselorPendingApplications,\r\n    approveByCounselor,\r\n    getByClassName,\r\n    getByStudentName,\r\n    getByStudentNoAndStatus,\r\n    getApprovedApplications\r\n} from '@/api/leaveApplication'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            applications: [],\r\n            loading: false,\r\n            searchClass: '',\r\n            searchName: '',\r\n            searchStudentNo: ''\r\n        }\r\n    },\r\n    created() {\r\n        this.fetchPendingApplications()\r\n    },\r\n    methods: {\r\n        async fetchPendingApplications() {\r\n            this.loading = true\r\n            try {\r\n                const res = await getCounselorPendingApplications()\r\n                console.log('完整响应:', res)\r\n                \r\n                // 修改判断条件和数据路径\r\n                if (res?.statusCode === 200 && Array.isArray(res.data)) {\r\n                    this.applications = res.data\r\n                    console.log('处理后的数据:', this.applications)\r\n                } else {\r\n                    this.$message.error(res?.msg || '数据格式异常')  // 使用msg字段\r\n                }\r\n            } catch (error) {\r\n                console.error('请求异常:', error.response || error)\r\n                this.$message.error(error.message || '请求失败')\r\n            } finally {\r\n                this.loading = false\r\n            }\r\n        },\r\n        async handleApprove(row) {\r\n            try {\r\n                // 使用封装好的API方法\r\n                await approveByCounselor(row.applyId)\r\n                this.$message.success('审批成功')\r\n                // 刷新列表数据\r\n                await this.fetchPendingApplications()\r\n            } catch (error) {\r\n                console.error('审批失败:', error)\r\n                // 显示更详细的错误信息\r\n                this.$message.error(error.response?.data?.msg || '审批操作失败')\r\n            }\r\n        },\r\n                async searchByClass() {\r\n            if (!this.searchClass) {\r\n                this.$message.warning('请输入班级名称')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByClassName(this.searchClass))\r\n        },\r\n\r\n        async searchByName() {\r\n            if (!this.searchName) {\r\n                this.$message.warning('请输入学生姓名')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByStudentName(this.searchName))\r\n        },\r\n\r\n        async searchByStudentNo() {\r\n            if (!this.searchStudentNo) {\r\n                this.$message.warning('请输入学生学号')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByStudentNoAndStatus(this.searchStudentNo))\r\n        },\r\n                // 通用查询处理\r\n        async handleSearch(apiCall) {\r\n            this.loading = true\r\n            try {\r\n                const res = await apiCall()\r\n                if (res?.statusCode === 200 && Array.isArray(res.data)) {\r\n                    this.applications = res.data\r\n                } else {\r\n                    this.$message.error(res?.msg || '查询失败')\r\n                }\r\n            } catch (error) {\r\n                this.$message.error(error.message || '查询失败')\r\n            } finally {\r\n                this.loading = false\r\n            }\r\n        },\r\n    \r\n\r\n        async searchApproved() {\r\n            await this.handleSearch(getApprovedApplications)\r\n        },\r\n        formatDate(row, column, cellValue) {\r\n            if (cellValue) {\r\n                return new Date(cellValue).toLocaleDateString()\r\n            }\r\n            return ''\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.el-table {\r\n    margin-top: 20px;\r\n    min-height: 400px;\r\n}\r\n</style>"]}]}