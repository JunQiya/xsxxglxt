{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\views\\manage\\leave\\index.vue?vue&type=style&index=0&id=b3d6e544&prod&scoped=true&lang=css","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\views\\manage\\leave\\index.vue","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"G:\\E\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1712740387000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50YWJsZSB7CiAgICBwYWRkaW5nOiAzMHB4Owp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAkgBA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/leave","sourcesContent":["<template>\n    <div class=\"router-container\">\n        <div class=\"container\">\n            <div class=\"inner_container\">\n                <div class=\"table\">\n                    <el-form\n                        :inline=\"true\"\n                        ref=\"form\"\n                        label-width=\"70px\"\n                        :model=\"listQuery.entity\"\n                    >\n                        <el-form-item\n                            label=\"学生姓名\"\n                            v-has-permi=\"['student:list']\"\n                        >\n                            <el-select\n                                \n                                v-model=\"listQuery.entity.studentId\"\n                                filterable\n                                clearable\n                                remote\n                                placeholder=\"请输入关键词\"\n                                :remote-method=\"getStudentsFromRemote\"\n                                :loading=\"selectLoading\"\n                            >\n                                <el-option\n                                    v-for=\"item in students\"\n                                    :key=\"item.id\"\n                                    :label=\"item.name\"\n                                    :value=\"item.id\"\n                                >\n                                </el-option>\n                            </el-select>\n                        </el-form-item>\n                        <el-form-item label=\"是否返校\">\n                            <el-select\n                                \n                                clearable\n                                v-model=\"listQuery.entity.isBack\"\n                            >\n                                <el-option label=\"已返校\" :value=\"true\">\n                                </el-option>\n                                <el-option label=\"未返校\" :value=\"false\">\n                                </el-option>\n                            </el-select>\n                        </el-form-item>\n                        <el-form-item>\n                            <el-button\n                                style=\"font-size: 16px\"\n                                type=\"primary\"\n                                @click=\"select\"\n                            >\n                                查询</el-button\n                            >\n                            <el-button\n                                style=\"font-size: 16px\"\n                                type=\"warning\"\n                                @click=\"reset\"\n                            >\n                                重置</el-button\n                            >\n                            <el-button\n                                style=\"font-size: 16px\"\n                                type=\"success\"\n                                v-has-permi=\"['leave:save']\"\n                                @click=\"showDialog(undefined)\"\n                            >\n                                新增</el-button\n                            >\n                        </el-form-item>\n                    </el-form>\n                    <el-table\n                        :data=\"pageInfo.list\"\n                        v-loading=\"loading\"\n                        height=\"405\"\n                    >\n                        <el-table-column label=\"学生姓名\" width=\"80\">\n                            <template slot-scope=\"scope\">\n                                <el-popover\n                                    placement=\"bottom\"\n                                    width=\"200\"\n                                    trigger=\"click\"\n                                    @show=\"getStudent(scope.row.student.id)\"\n                                >\n                                    <el-form label-width=\"40px\">\n                                        <el-form-item label=\"姓名\">\n                                            <el-input\n                                                v-model=\"student.name\"\n                                                readonly\n                                                \n                                            ></el-input>\n                                        </el-form-item>\n                                        <el-form-item label=\"学号\">\n                                            <el-input\n                                                v-model=\"student.number\"\n                                                readonly\n                                                \n                                            ></el-input>\n                                        </el-form-item>\n                                        <el-form-item label=\"电话\">\n                                            <el-input\n                                                v-model=\"student.phone\"\n                                                readonly\n                                                \n                                            ></el-input>\n                                        </el-form-item>\n                                        <el-form-item\n                                            label=\"班级\"\n                                            v-if=\"student.faculty\"\n                                        >\n                                            <el-input\n                                                v-model=\"student.faculty.name\"\n                                                readonly\n                                                \n                                            ></el-input>\n                                        </el-form-item>\n                                        <el-form-item\n                                            label=\"寝室\"\n                                            v-if=\"student.room\"\n                                        >\n                                            <el-input\n                                                v-model=\"student.room.number\"\n                                                readonly\n                                                \n                                            ></el-input>\n                                        </el-form-item>\n                                    </el-form>\n                                    <span\n                                        slot=\"reference\"\n                                        style=\"color: #409eff; cursor: pointer\"\n                                        >{{ scope.row.student.name }}</span\n                                    >\n                                </el-popover>\n                            </template>\n                        </el-table-column>\n                        <el-table-column\n                            prop=\"time\"\n                            label=\"签离时间\"\n                            width=\"160\"\n                        ></el-table-column>\n                        <el-table-column\n                            label=\"原因\"\n                            width=\"150\"\n                            prop=\"reason\"\n                            :show-overflow-tooltip=\"true\"\n                        ></el-table-column>\n                        <el-table-column\n                            prop=\"target\"\n                            label=\"目的地\"\n                        ></el-table-column>\n                        <el-table-column\n                            prop=\"backDate\"\n                            width=\"100\"\n                            label=\"返校时间\"\n                        ></el-table-column>\n                        <el-table-column label=\"是否返校\" width=\"100\">\n                            <template slot-scope=\"scope\">\n                                <span\n                                    style=\"color: #67c23a\"\n                                    v-if=\"scope.row.back\"\n                                    >是</span\n                                >\n                                <span style=\"color: #909399\" v-else\n                                    >否\n                                    <span\n                                        v-if=\"\n                                            new Date() >\n                                            new Date(\n                                                scope.row.backDate + ' 23:59:59'\n                                            )\n                                        \"\n                                        style=\"color: #f56c6c\"\n                                        >(已超时)</span\n                                    >\n                                </span>\n                            </template>\n                        </el-table-column>\n                        <el-table-column label=\"操作\" width=\"400\" fixed=\"right\">\n                            <template slot-scope=\"scope\">\n                                <el-button\n                                    type=\"primary\"\n                                    style=\"font-size: 14px\"\n                                    v-has-permi=\"['leave:query']\"\n                                    @click=\"showDialog(scope.row.id)\"\n                                >\n                                    详情</el-button\n                                >\n                                <el-button\n                                    type=\"danger\"\n                                    style=\"font-size: 14px\"\n                                    v-has-permi=\"['leave:delete']\"\n                                    @click=\"del(scope.row.id)\"\n                                >\n                                    删除</el-button\n                                >\n                                <el-button\n                                    type=\"success\"\n                                    style=\"font-size: 14px\"\n                                    v-has-permi=\"['leave:update']\"\n                                    @click=\"update(scope.row.id)\"\n                                    :disabled=\"scope.row.back\"\n                                >\n                                    确定返校</el-button\n                                >\n                            </template>\n                        </el-table-column>\n                    </el-table>\n                </div>\n                <div class=\"page\">\n                    <el-pagination\n                        background\n                        :page-size=\"listQuery.rows\"\n                        :page-count=\"pageInfo.pages\"\n                        layout=\"->, prev, pager, next, jumper, total, sizes\"\n                        :total=\"pageInfo.total\"\n                        :current-page.sync=\"pageInfo.pageNum\"\n                        @current-change=\"handleCurrentChange\"\n                        @size-change=\"handleSizeChange\"\n                    >\n                    </el-pagination>\n                </div>\n                <div class=\"dialog\">\n                    <el-dialog\n                        :title=\"dialogTitle\"\n                        :visible.sync=\"dialogVisible\"\n                        width=\"45%\"\n                        @closed=\"handleClose\"\n                    >\n                        <el-form\n                            :model=\"record\"\n                            ref=\"saveOrUpdateForm\"\n                            label-width=\"80px\"\n                            :rules=\"rules\"\n                        >\n                            <template v-if=\"record && record.id !== undefined\">\n                                <el-form-item label=\"学生姓名\">\n                                    <el-input\n                                        v-model=\"record.student.name\"\n                                        readonly\n                                    ></el-input>\n                                </el-form-item>\n                            </template>\n                            <template v-else>\n                                <el-form-item label=\"学生姓名\" prop=\"studentId\">\n                                    <el-select\n                                        v-model=\"record.studentId\"\n                                        remote\n                                        filterable\n                                        placeholder=\"输入关键字\"\n                                        :remote-method=\"getStudentsFromRemote\"\n                                        :loading=\"selectLoading\"\n                                    >\n                                        <el-option\n                                            v-for=\"item in students\"\n                                            :key=\"item.id\"\n                                            :label=\"item.name\"\n                                            :value=\"item.id\"\n                                        ></el-option>\n                                    </el-select>\n                                </el-form-item>\n                            </template>\n                            <template v-if=\"record && record.id !== undefined\">\n                                <el-form-item label=\"签离时间\">\n                                    <el-date-picker\n                                        v-model=\"record.time\"\n                                        type=\"datetime\"\n                                        placeholder=\"选择日期时间\"\n                                        readonly\n                                    >\n                                    </el-date-picker>\n                                </el-form-item>\n                            </template>\n                            <el-form-item label=\"返校时间\" prop=\"backDate\">\n                                <el-date-picker\n                                    v-model=\"record.backDate\"\n                                    type=\"date\"\n                                    value-format=\"yyyy-MM-dd\"\n                                    placeholder=\"选择日期\"\n                                >\n                                </el-date-picker>\n                            </el-form-item>\n                            <el-form-item label=\"目的地\" prop=\"target\">\n                                <el-input\n                                    v-model=\"record.target\"\n                                    placeholder=\"输入目的地\"\n                                ></el-input>\n                            </el-form-item>\n                            <el-form-item label=\"原因\" prop=\"reason\">\n                                <el-input\n                                    type=\"textarea\"\n                                    :rows=\"5\"\n                                    v-model=\"record.reason\"\n                                    placeholder=\"输入原因\"\n                                ></el-input>\n                            </el-form-item>\n                        </el-form>\n                        <span slot=\"footer\" class=\"dialog-footer\">\n                            <el-button type=\"danger\" @click=\"handleClose\">\n                                取 消</el-button\n                            >\n                            <el-button\n                                type=\"primary\"\n                                @click=\"saveOrUpdate\"\n                                v-has-permi=\"['leave:save', 'leave:update']\"\n                            >\n                                保 存</el-button\n                            >\n                        </span>\n                    </el-dialog>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { list, save, update, del, query } from \"@/api/leave\";\nimport { listByName, query as queryStudent } from \"@/api/student\";\nexport default {\n    name: \"index\",\n    methods: {\n        update(id) {\n            this.$confirm(\"是否确定\", \"警告\", {\n                confirmButtonText: \"确定\",\n                cancelButtonText: \"取消\",\n                type: \"warning\",\n            }).then(() => {\n                update(id).then((res) => {\n                    if (res.statusCode === 200) {\n                        this.$message({\n                            type: \"success\",\n                            message: res.msg,\n                        });\n                        this.listData();\n                    }\n                });\n            });\n        },\n        saveOrUpdate() {\n            this.$refs[\"saveOrUpdateForm\"].validate((valid) => {\n                if (valid) {\n                    save(this.record).then((res) => {\n                        if (res.statusCode === 200) {\n                            this.$message({\n                                type: \"success\",\n                                message: res.msg,\n                            });\n                            this.listData();\n                            this.handleClose();\n                        }\n                    });\n                } else {\n                    this.$message({\n                        message: \"请正确填写参数\",\n                        type: \"error\",\n                    });\n                    return false;\n                }\n            });\n        },\n        del(id) {\n            this.$confirm(\"是否确定\", \"警告\", {\n                confirmButtonText: \"确定\",\n                cancelButtonText: \"取消\",\n                type: \"warning\",\n            }).then(() => {\n                del(id).then((res) => {\n                    if (res.statusCode === 200) {\n                        this.$message({\n                            type: \"success\",\n                            message: res.msg,\n                        });\n                        this.listData();\n                    }\n                });\n            });\n        },\n        async showDialog(id) {\n            this.dialogTitle = \"添加\";\n            if (id) {\n                const { data } = await query(id);\n                this.dialogTitle = \"详情\";\n                if (data) {\n                    this.record = data;\n                    this.dialogVisible = true;\n                }\n            } else {\n                this.dialogVisible = true;\n            }\n        },\n        handleClose() {\n            this.dialogVisible = false;\n            this.students = [];\n            this.record = {\n                id: undefined,\n                time: undefined,\n                reason: undefined,\n                isBack: undefined,\n                studentId: undefined,\n                target: undefined,\n                backDate: undefined,\n            };\n            this.$refs[\"saveOrUpdateForm\"].resetFields();\n        },\n        async getStudent(id) {\n            const { data } = await queryStudent(id);\n            this.student = data;\n        },\n        reset() {\n            this.students = [];\n            this.listQuery.entity = {};\n            this.select();\n        },\n        select() {\n            this.listQuery.page = 1;\n            this.listData();\n        },\n        async listData() {\n            this.loading = true;\n            const { data } = await list(this.listQuery);\n            this.pageInfo = data;\n            this.loading = false;\n        },\n        handleSizeChange(val) {\n            this.listQuery.rows = val;\n            this.listData();\n        },\n        handleCurrentChange(val) {\n            this.listQuery.page = val;\n            this.listData();\n        },\n        async getStudentsFromRemote(query) {\n            if (query !== \"\") {\n                this.selectLoading = true;\n                const { data } = await listByName(query);\n                this.students = data.map((item) => {\n                    return {\n                        id: item.id,\n                        name:\n                            item.room.number +\n                            \" \" +\n                            item.name +\n                            \":\" +\n                            item.number,\n                    };\n                });\n                this.selectLoading = false;\n            } else {\n                this.students = [];\n            }\n        },\n    },\n    data() {\n        return {\n            listQuery: {\n                page: 1,\n                rows: 10,\n                entity: {},\n            },\n            pageInfo: {},\n            loading: true,\n            selectLoading: true,\n            students: [],\n            student: {},\n            record: {\n                id: undefined,\n                time: undefined,\n                reason: undefined,\n                isBack: undefined,\n                studentId: undefined,\n                target: undefined,\n                backDate: undefined,\n            },\n            dialogVisible: false,\n            dialogTitle: \"\",\n            rules: {\n                studentId: [\n                    {\n                        required: true,\n                        message: \"姓名不能为空\",\n                        trigger: \"change\",\n                    },\n                ],\n                reason: [\n                    {\n                        required: true,\n                        message: \"原因不能为空\",\n                        trigger: \"blur\",\n                    },\n                ],\n                target: [\n                    {\n                        required: true,\n                        message: \"目的不能为空\",\n                        trigger: \"blur\",\n                    },\n                ],\n                backDate: [\n                    {\n                        required: true,\n                        message: \"返校日期不能为空\",\n                        trigger: \"blur\",\n                    },\n                ],\n            },\n        };\n    },\n    created() {\n        this.listData();\n    },\n};\n</script>\n\n<style scoped>\n.table {\n    padding: 30px;\n}\n</style>\n"]}]}