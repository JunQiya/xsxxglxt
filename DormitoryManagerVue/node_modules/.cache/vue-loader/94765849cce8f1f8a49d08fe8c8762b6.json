{"remainingRequest":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\src\\views\\manage\\selectAbsenceRecord\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\src\\views\\manage\\selectAbsenceRecord\\index.vue","mtime":1744208372362},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762330415881},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\2025072398-学生系统管理平台参赛总文件夹\\2025072398-02 素材与源码\\学生系统管理平台\\DormitoryManagerVue\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyANCiAgZ2V0QWxsUmVjb3JkcywNCiAgc2VhcmNoUmVjb3JkcywNCiAgZGVsZXRlUmVjb3JkLA0KICB1cGRhdGVBYnNlbmNlUmVjb3JkDQp9IGZyb20gJ0AvYXBpL2Fic2VuY2VSZWNvcmQnDQppbXBvcnQgeyBsaXN0IH0gZnJvbSAnQC9hcGkvZmFjdWx0eScNCg0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHRhYmxlRGF0YTogW10sDQogICAgICBjb25kaXRpb246IHsNCiAgICAgICAgbmFtZTogJycsDQogICAgICAgIGFic2VudERhdGU6IG51bGwsDQogICAgICAgIGNsYXNzSWQ6IG51bGwNCiAgICAgIH0sDQogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGN1cnJlbnRSZWNvcmQ6IHt9LA0KICAgICAgLy8g5paw5aKe54+t57qn6YCJ5oup55u45YWz5pWw5o2uDQogICAgICBzZWxlY3RNb2RlOiAnY2FzY2FkZScsDQogICAgICBmYWN1bHR5T3B0aW9uczogW10sDQogICAgICBmbGF0Q2xhc3NlczogW10sDQogICAgICBjYXNjYWRlclByb3BzOiB7DQogICAgICAgIHZhbHVlOiAnaWQnLA0KICAgICAgICBsYWJlbDogJ25hbWUnLA0KICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywNCiAgICAgICAgY2hlY2tTdHJpY3RseTogdHJ1ZQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgYXN5bmMgY3JlYXRlZCgpIHsNCiAgICBhd2FpdCB0aGlzLmxvYWREYXRhKCkNCiAgICAvLyDliqDovb3nj63nuqfmlbDmja4NCiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGxpc3QoKQ0KICAgIHRoaXMuZmFjdWx0eU9wdGlvbnMgPSBkYXRhDQogICAgdGhpcy5mbGF0Q2xhc3NlcyA9IHRoaXMuZmxhdHRlbkNsYXNzZXMoZGF0YSkNCiAgfSwNCiAgbWV0aG9kczogew0KDQpwcmludFRhYmxlKCkgew0KICAgICAgd2luZG93LnByaW50KCk7DQogICAgfSwNCg0KICAgICBoYW5kbGVDYXNjYWRlckNoYW5nZSh2YWx1ZUFycikgew0KICAgIC8vIOWPluacgOWQjuS4gOe6p+eahOePree6p0lEDQogICAgdGhpcy5jb25kaXRpb24uY2xhc3NJZCA9IHZhbHVlQXJyLmxlbmd0aCA+IDAgPyB2YWx1ZUFyclt2YWx1ZUFyci5sZW5ndGggLSAxXSA6IG51bGwNCiAgfSwNCg0KICAgIC8vIOWKoOi9veaVsOaNrg0KICAgIGFzeW5jIGxvYWREYXRhKCkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBnZXRBbGxSZWNvcmRzKCkNCiAgICAgICAgdGhpcy50YWJsZURhdGEgPSBkYXRhDQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmlbDmja7liqDovb3lpLHotKUnKQ0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvLyDnj63nuqfmlbDmja7miYHlubPljJYNCiAgICBmbGF0dGVuQ2xhc3Nlcyh0cmVlKSB7DQogICAgICBjb25zdCByZXN1bHQgPSBbXQ0KICAgICAgY29uc3Qgd2FsayA9IChub2RlcywgcGF0aCA9IFtdKSA9PiB7DQogICAgICAgIG5vZGVzLmZvckVhY2gobm9kZSA9PiB7DQogICAgICAgICAgY29uc3QgY3VycmVudFBhdGggPSBbLi4ucGF0aCwgbm9kZS5uYW1lXQ0KICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuPy5sZW5ndGgpIHsNCiAgICAgICAgICAgIHdhbGsobm9kZS5jaGlsZHJlbiwgY3VycmVudFBhdGgpDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsNCiAgICAgICAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgICAgICAgIGZ1bGxOYW1lOiBjdXJyZW50UGF0aC5qb2luKCcgLyAnKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9DQogICAgICB3YWxrKHRyZWUpDQogICAgICByZXR1cm4gcmVzdWx0DQogICAgfSwNCg0KICAgIC8vIOiOt+WPluePree6p+WQjeensA0KICAgIGdldENsYXNzTmFtZShjbGFzc0lkKSB7DQogICAgICBjb25zdCBjbGFzc0luZm8gPSB0aGlzLmZsYXRDbGFzc2VzLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBjbGFzc0lkKQ0KICAgICAgcmV0dXJuIGNsYXNzSW5mbyA/IGNsYXNzSW5mby5mdWxsTmFtZSA6ICfmnKrnn6Xnj63nuqcnDQogICAgfSwNCg0KICAgIC8vIOaXpeacn+agvOW8j+WMlg0KICBmb3JtYXREYXRlKGRhdGVTdHJpbmcpIHsNCiAgICBpZiAoIWRhdGVTdHJpbmcpIHJldHVybiAnJw0KICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKQ0KICAgIC8vIOWkhOeQhlNhZmFyaeWFvOWuueaAp+mXrumimA0KICAgIGNvbnN0IHBhZCA9IG4gPT4gbi50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykNCiAgICByZXR1cm4gYCR7ZGF0ZS5nZXRGdWxsWWVhcigpfS0ke3BhZChkYXRlLmdldE1vbnRoKCkgKyAxKX0tJHtwYWQoZGF0ZS5nZXREYXRlKCkpfWANCiAgfSwNCg0KICAgIC8vIOadoeS7tuafpeivog0KICAgIGFzeW5jIGhhbmRsZVNlYXJjaCgpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIC8vIOi9rOaNouWPguaVsOe7k+aehOWMuemFjeWQjuerr+aOpeWPow0KICAgICAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgICAgbmFtZTogdGhpcy5jb25kaXRpb24ubmFtZSwNCiAgICAgICAgYmVnaW5BYnNlbnREYXRlOiB0aGlzLmNvbmRpdGlvbi5hYnNlbnREYXRlLA0KICAgICAgICBlbmRBYnNlbnREYXRlOiB0aGlzLmNvbmRpdGlvbi5hYnNlbnREYXRlLA0KICAgICAgICBjbGFzc0lkOiB0aGlzLmNvbmRpdGlvbi5jbGFzc0lkIC8vIOebtOaOpeS8oOmAkuWNleS4quWAvA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHNlYXJjaFJlY29yZHMocGFyYW1zKQ0KICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IGRhdGENCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+afpeivouWksei0pScpDQogICAgICB9DQogICAgfSwNCg0KDQogICAgLy8g6YeN572u5p+l6K+iDQogICAgcmVzZXRTZWFyY2goKSB7DQogICAgICB0aGlzLmNvbmRpdGlvbiA9IHsNCiAgICAgICAgbmFtZTogJycsDQogICAgICAgIGFic2VudERhdGU6IG51bGwsDQogICAgICAgIGNsYXNzSWQ6IG51bGwNCiAgICAgIH0NCiAgICAgIHRoaXMubG9hZERhdGEoKQ0KICAgIH0sDQoNCiAgICAvLyDliKDpmaTorrDlvZUNCiAgICBhc3luYyBoYW5kbGVEZWxldGUoaW5kZXgsIHJvdykgew0KICAgICAgdHJ5IHsNCiAgICAgICAgYXdhaXQgZGVsZXRlUmVjb3JkKHJvdy5pZCkNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfliKDpmaTmiJDlip8nKQ0KICAgICAgICB0aGlzLnRhYmxlRGF0YS5zcGxpY2UoaW5kZXgsIDEpDQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfliKDpmaTlpLHotKUnKQ0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvLyDmiZPlvIDnvJbovpHlr7nor53moYYNCiAgICBoYW5kbGVFZGl0KGluZGV4LCByb3cpIHsNCiAgICAgIHRoaXMuY3VycmVudFJlY29yZCA9IHsgLi4ucm93IH0NCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUNCiAgICB9LA0KDQogICAgLy8g56Gu6K6k5pu05pawDQogICAgYXN5bmMgY29uZmlybVVwZGF0ZSgpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGF3YWl0IHVwZGF0ZUFic2VuY2VSZWNvcmQodGhpcy5jdXJyZW50UmVjb3JkKQ0KICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+abtOaWsOaIkOWKnycpDQogICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlDQogICAgICAgIHRoaXMubG9hZERhdGEoKQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5pu05paw5aSx6LSlJykNCiAgICAgIH0NCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAyHA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/selectAbsenceRecord","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 查询表单 -->\r\n    <el-form :inline=\"true\" :model=\"condition\" class=\"demo-form-inline\">\r\n      <el-form-item label=\"学生姓名\">\r\n        <el-input v-model=\"condition.name\" placeholder=\"请输入姓名\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"缺勤日期\">\r\n        <el-date-picker\r\n          v-model=\"condition.absentDate\"\r\n          type=\"date\"\r\n          value-format=\"yyyy-MM-dd\"\r\n          placeholder=\"选择日期\">\r\n        </el-date-picker>\r\n        <el-button @click=\"printTable\">打印表格</el-button>\r\n      </el-form-item>\r\n      \r\n      <!-- 新增班级选择器 -->\r\n      <el-form-item label=\"班级选择\">\r\n        <el-radio-group v-model=\"selectMode\">\r\n          <el-radio-button label=\"cascade\">层级选择</el-radio-button>\r\n          <el-radio-button label=\"search\">搜索选择</el-radio-button>\r\n        </el-radio-group>\r\n\r\n<el-cascader \r\n  v-if=\"selectMode === 'cascade'\"\r\n  v-model=\"cascaderValue\" \r\n  :options=\"facultyOptions\"\r\n  :props=\"cascaderProps\"\r\n  @change=\"handleCascaderChange\"\r\n/>\r\n\r\n\r\n        <el-select\r\n          v-else\r\n          v-model=\"condition.classId\"\r\n          filterable\r\n          placeholder=\"输入班级名称搜索\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in flatClasses\"\r\n            :key=\"item.id\"\r\n            :label=\"item.fullName\"\r\n            :value=\"item.id\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\r\n        <el-button @click=\"resetSearch\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <!-- 数据表格 -->\r\n    <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n      <el-table-column prop=\"id\" label=\"ID\" width=\"60\"></el-table-column>\r\n      <el-table-column prop=\"name\" label=\"姓名\" width=\"100\"></el-table-column>\r\n      <el-table-column label=\"性别\" width=\"80\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.gender === 1 ? '男' : '女' }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"age\" label=\"年龄\" width=\"80\"></el-table-column>\r\n      <el-table-column label=\"所属班级\" width=\"200\">\r\n        <template slot-scope=\"scope\">\r\n          {{ getClassName(scope.row.class_id) }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"symptoms\" label=\"症状\"></el-table-column>\r\n      <el-table-column prop=\"hospital\" label=\"就诊医院\"></el-table-column>\r\n      <el-table-column label=\"缺勤日期\" width=\"120\">\r\n        <template slot-scope=\"scope\">\r\n          {{ formatDate(scope.row.absent_date) }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"返校日期\" width=\"120\">\r\n        <template slot-scope=\"scope\">\r\n          {{ formatDate(scope.row.return_date) }}\r\n        </template>\r\n      </el-table-column>\r\n      \r\n      <!-- 操作列 -->\r\n      <el-table-column label=\"操作\" width=\"180\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button\r\n            size=\"mini\"\r\n            @click=\"handleEdit(scope.$index, scope.row)\">编辑</el-button>\r\n          <el-button\r\n            size=\"mini\"\r\n            type=\"danger\"\r\n            @click=\"handleDelete(scope.$index, scope.row)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 编辑对话框 -->\r\n    <el-dialog title=\"编辑记录\" :visible.sync=\"dialogVisible\">\r\n      <el-form :model=\"currentRecord\">\r\n        <el-form-item label=\"是否治愈\">\r\n          <el-radio-group v-model=\"currentRecord.is_cured\">\r\n            <el-radio :label=\"1\">是</el-radio>\r\n            <el-radio :label=\"0\">否</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"是否传染病\">\r\n          <el-radio-group v-model=\"currentRecord.is_infectious\">\r\n            <el-radio :label=\"1\">是</el-radio>\r\n            <el-radio :label=\"0\">否</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmUpdate\">确定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { \r\n  getAllRecords,\r\n  searchRecords,\r\n  deleteRecord,\r\n  updateAbsenceRecord\r\n} from '@/api/absenceRecord'\r\nimport { list } from '@/api/faculty'\r\n\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      tableData: [],\r\n      condition: {\r\n        name: '',\r\n        absentDate: null,\r\n        classId: null\r\n      },\r\n      dialogVisible: false,\r\n      currentRecord: {},\r\n      // 新增班级选择相关数据\r\n      selectMode: 'cascade',\r\n      facultyOptions: [],\r\n      flatClasses: [],\r\n      cascaderProps: {\r\n        value: 'id',\r\n        label: 'name',\r\n        children: 'children',\r\n        checkStrictly: true\r\n      }\r\n    }\r\n  },\r\n  async created() {\r\n    await this.loadData()\r\n    // 加载班级数据\r\n    const { data } = await list()\r\n    this.facultyOptions = data\r\n    this.flatClasses = this.flattenClasses(data)\r\n  },\r\n  methods: {\r\n\r\nprintTable() {\r\n      window.print();\r\n    },\r\n\r\n     handleCascaderChange(valueArr) {\r\n    // 取最后一级的班级ID\r\n    this.condition.classId = valueArr.length > 0 ? valueArr[valueArr.length - 1] : null\r\n  },\r\n\r\n    // 加载数据\r\n    async loadData() {\r\n      try {\r\n        const { data } = await getAllRecords()\r\n        this.tableData = data\r\n      } catch (error) {\r\n        this.$message.error('数据加载失败')\r\n      }\r\n    },\r\n\r\n    // 班级数据扁平化\r\n    flattenClasses(tree) {\r\n      const result = []\r\n      const walk = (nodes, path = []) => {\r\n        nodes.forEach(node => {\r\n          const currentPath = [...path, node.name]\r\n          if (node.children?.length) {\r\n            walk(node.children, currentPath)\r\n          } else {\r\n            result.push({\r\n              id: node.id,\r\n              fullName: currentPath.join(' / ')\r\n            })\r\n          }\r\n        })\r\n      }\r\n      walk(tree)\r\n      return result\r\n    },\r\n\r\n    // 获取班级名称\r\n    getClassName(classId) {\r\n      const classInfo = this.flatClasses.find(item => item.id === classId)\r\n      return classInfo ? classInfo.fullName : '未知班级'\r\n    },\r\n\r\n    // 日期格式化\r\n  formatDate(dateString) {\r\n    if (!dateString) return ''\r\n    const date = new Date(dateString)\r\n    // 处理Safari兼容性问题\r\n    const pad = n => n.toString().padStart(2, '0')\r\n    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}`\r\n  },\r\n\r\n    // 条件查询\r\n    async handleSearch() {\r\n      try {\r\n        // 转换参数结构匹配后端接口\r\n        const params = {\r\n          name: this.condition.name,\r\n        beginAbsentDate: this.condition.absentDate,\r\n        endAbsentDate: this.condition.absentDate,\r\n        classId: this.condition.classId // 直接传递单个值\r\n        }\r\n        \r\n        const { data } = await searchRecords(params)\r\n        this.tableData = data\r\n      } catch (error) {\r\n        this.$message.error('查询失败')\r\n      }\r\n    },\r\n\r\n\r\n    // 重置查询\r\n    resetSearch() {\r\n      this.condition = {\r\n        name: '',\r\n        absentDate: null,\r\n        classId: null\r\n      }\r\n      this.loadData()\r\n    },\r\n\r\n    // 删除记录\r\n    async handleDelete(index, row) {\r\n      try {\r\n        await deleteRecord(row.id)\r\n        this.$message.success('删除成功')\r\n        this.tableData.splice(index, 1)\r\n      } catch (error) {\r\n        this.$message.error('删除失败')\r\n      }\r\n    },\r\n\r\n    // 打开编辑对话框\r\n    handleEdit(index, row) {\r\n      this.currentRecord = { ...row }\r\n      this.dialogVisible = true\r\n    },\r\n\r\n    // 确认更新\r\n    async confirmUpdate() {\r\n      try {\r\n        await updateAbsenceRecord(this.currentRecord)\r\n        this.$message.success('更新成功')\r\n        this.dialogVisible = false\r\n        this.loadData()\r\n      } catch (error) {\r\n        this.$message.error('更新失败')\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}