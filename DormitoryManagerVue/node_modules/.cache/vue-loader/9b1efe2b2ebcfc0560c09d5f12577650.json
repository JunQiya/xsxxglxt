{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\manage\\absenceRecord\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\manage\\absenceRecord\\index.vue","mtime":1744112754558},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762330415881},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBsaXN0IH0gZnJvbSAnQC9hcGkvZmFjdWx0eScNCmltcG9ydCB7IGFkZEFic2VuY2VSZWNvcmQgfSBmcm9tICdAL2FwaS9hYnNlbmNlUmVjb3JkJw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNlbGVjdE1vZGU6ICdjYXNjYWRlJywNCiAgICAgIGNhc2NhZGVyVmFsdWU6IFtdLCAgLy8g5paw5aKe5Li05pe25a2Y5YKo5pWw57uEDQogICAgICBmb3JtOiB7DQogICAgICAgIGNsYXNzSWQ6IG51bGwsDQogICAgICAgIHNjaG9vbDogJ+S6keWNl+aXhea4uOiBjOS4muWtpumZoicsDQogICAgICAgIGRlcGFydG1lbnQ6ICcnLA0KICAgICAgICBuYW1lOiAnJywNCiAgICAgICAgZ2VuZGVyOiAxLA0KICAgICAgICBhZ2U6IG51bGwsDQogICAgICAgIGFic2VudERhdGU6ICcnLA0KICAgICAgICByZWdpc3RyYXI6ICcnLA0KICAgICAgICByZWdpc3RyYXJQaG9uZTogJycsDQogICAgICAgIHJlcG9ydERhdGU6ICcnLA0KICAgICAgICBwaG9uZTogJycsDQogICAgICAgIHN5bXB0b21zOiAnJywNCiAgICAgICAgdmlzaXREYXRlOiAnJywNCiAgICAgICAgaG9zcGl0YWw6ICcnLA0KICAgICAgICBkaWFnbm9zaXM6ICcnLA0KICAgICAgICByZXR1cm5EYXRlOiAnJywNCiAgICAgICAgaXNDdXJlZDogMCwNCiAgICAgICAgaXNJbmZlY3Rpb3VzOiAwDQogICAgICB9LA0KICAgICAgY2FzY2FkZXJQcm9wczogew0KICAgICAgICB2YWx1ZTogJ2lkJywNCiAgICAgICAgbGFiZWw6ICduYW1lJywNCiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsDQogICAgICAgIGNoZWNrU3RyaWN0bHk6IHRydWUNCiAgICAgIH0sDQogICAgICBmYWN1bHR5T3B0aW9uczogW10sDQogICAgICBmbGF0Q2xhc3NlczogW10NCiAgICB9DQogIH0sDQogIGFzeW5jIGNyZWF0ZWQoKSB7DQogICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBsaXN0KCkNCiAgICB0aGlzLmZhY3VsdHlPcHRpb25zID0gZGF0YQ0KICAgIHRoaXMuZmxhdENsYXNzZXMgPSB0aGlzLmZsYXR0ZW5DbGFzc2VzKGRhdGEpDQogIH0sDQogIG1ldGhvZHM6IHsNCg0KICAgIGhhbmRsZUNhc2NhZGVyQ2hhbmdlKHZhbHVlQXJyKSB7DQogICAgLy8g5Y+W6Lev5b6E5pWw57uE55qE5pyA5ZCO5LiA5Liq5YWD57Sg77yI54+t57qnSUTvvIkNCiAgICB0aGlzLmZvcm0uY2xhc3NJZCA9IHZhbHVlQXJyW3ZhbHVlQXJyLmxlbmd0aCAtIDFdDQogICAgfSwNCg0KICAgIGFzeW5jIHN1Ym1pdEZvcm0oKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAvLyDovazmjaLpqbzls7DlrZfmrrXkuLrom4flvaLlkb3lkI0NCiAgICAgICAgY29uc3QgcG9zdERhdGEgPSB7DQogICAgICAgIC4uLnRoaXMuZm9ybSwNCiAgICAgICAgY2xhc3NfaWQ6IHRoaXMuZm9ybS5jbGFzc0lkLA0KICAgICAgICByZWdpc3RyYXJfcGhvbmU6IHRoaXMuZm9ybS5yZWdpc3RyYXJQaG9uZSwNCiAgICAgICAgdmlzaXRfZGF0ZTogdGhpcy5mb3JtLnZpc2l0RGF0ZSwNCiAgICAgICAgcmVwb3J0X2RhdGU6IHRoaXMuZm9ybS5yZXBvcnREYXRlLA0KICAgICAgICBhYnNlbnRfZGF0ZTogdGhpcy5mb3JtLmFic2VudERhdGUsDQogICAgICAgIHJldHVybl9kYXRlOiB0aGlzLmZvcm0ucmV0dXJuRGF0ZSwNCiAgICAgICAgaXNfY3VyZWQ6IHRoaXMuZm9ybS5pc0N1cmVkLA0KICAgICAgICBpc19pbmZlY3Rpb3VzOiB0aGlzLmZvcm0uaXNJbmZlY3Rpb3VzDQogICAgfQ0KICAgICAgICBkZWxldGUgcG9zdERhdGEuY2xhc3NJZCAgICAgICAgICAvLyDlr7nlupRjbGFzc19pZA0KICAgICAgICBkZWxldGUgcG9zdERhdGEucmVnaXN0cmFyUGhvbmUgICAvLyDlr7nlupRyZWdpc3RyYXJfcGhvbmUNCiAgICAgICAgZGVsZXRlIHBvc3REYXRhLnJlcG9ydERhdGUgICAgICAgLy8g5a+55bqUcmVwb3J0X2RhdGUNCiAgICAgICAgZGVsZXRlIHBvc3REYXRhLmFic2VudERhdGUgICAgICAgLy8g5a+55bqUYWJzZW50X2RhdGUNCiAgICAgICAgZGVsZXRlIHBvc3REYXRhLnJldHVybkRhdGUgICAgICAgLy8g5a+55bqUcmV0dXJuX2RhdGUNCiAgICAgICAgZGVsZXRlIHBvc3REYXRhLmlzQ3VyZWQgICAgICAgICAgIC8vIOWvueW6lGlzX2N1cmVkDQogICAgICAgIGRlbGV0ZSBwb3N0RGF0YS5pc0luZmVjdGlvdXMgICAgIC8vIOWvueW6lGlzX2luZmVjdGlvdXMNCiAgICAgICAgLy8g5Zyo5o+Q5Lqk5YmN56Gu5L+dY2xhc3NJZOaYr+WNleS4quWAvA0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmZvcm0uY2xhc3NJZCkpIHsNCiAgICAgICAgdGhpcy5mb3JtLmNsYXNzSWQgPSB0aGlzLmZvcm0uY2xhc3NJZFt0aGlzLmZvcm0uY2xhc3NJZC5sZW5ndGggLSAxXQ0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCfmnIDnu4jmj5DkuqTmlbDmja46JywgcG9zdERhdGEpIC8vIOehruS/nei/memHjOaJk+WNsOeahOaYr+i9rOaNouWQjueahOaVsOaNrg0KICAgICAgICAgICAgYXdhaXQgYWRkQWJzZW5jZVJlY29yZChwb3N0RGF0YSkgIC8vIOWFs+mUruS/ruaUue+8muaPkOS6pHBvc3REYXRh6ICM5LiN5pivdGhpcy5mb3JtDQogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn6K6w5b2V5re75Yqg5oiQ5YqfJykNCiAgICAgICAgdGhpcy5yZXNldEZvcm0oKQ0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmj5DkuqTlpLHotKUnKQ0KICAgICAgICB9DQogICAgfSwNCiAgICByZXNldEZvcm0oKSB7DQogICAgICAgIHRoaXMuZm9ybSA9IHsNCiAgICAgICAgLy8g6YeN572u5omA5pyJ5a2X5q61Li4uDQogICAgICAgIGNsYXNzX2lkOiBudWxsLA0KICAgICAgICBzY2hvb2w6ICfkupHljZfml4XmuLjogYzkuJrlrabpmaInLA0KICAgICAgICBkZXBhcnRtZW50OiAnJywNCiAgICAgICAgbmFtZTogJycsDQogICAgICAgIGdlbmRlcjogMSwNCiAgICAgICAgYWdlOiBudWxsLA0KICAgICAgICBhYnNlbnRfZGF0ZTogJycsDQogICAgICAgIHJlZ2lzdHJhcjogJycsDQogICAgICAgIHJlZ2lzdHJhcl9waG9uZTogJycsDQogICAgICAgIHJlcG9ydF9kYXRlOiAnJywNCiAgICAgICAgcGhvbmU6ICcnLA0KICAgICAgICBzeW1wdG9tczogJycsDQogICAgICAgIHZpc2l0X2RhdGU6ICcnLA0KICAgICAgICBob3NwaXRhbDogJycsDQogICAgICAgIGRpYWdub3NpczogJycsDQogICAgICAgIHJldHVybl9kYXRlOiAnJywNCiAgICAgICAgaXNfY3VyZWQ6IDAsDQogICAgICAgIGlzX2luZmVjdGlvdXM6IDANCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBmbGF0dGVuQ2xhc3Nlcyh0cmVlKSB7DQogICAgICBjb25zdCByZXN1bHQgPSBbXQ0KICAgICAgY29uc3Qgd2FsayA9IChub2RlcywgcGF0aCA9IFtdKSA9PiB7DQogICAgICAgIG5vZGVzLmZvckVhY2gobm9kZSA9PiB7DQogICAgICAgICAgY29uc3QgY3VycmVudFBhdGggPSBbLi4ucGF0aCwgbm9kZS5uYW1lXQ0KICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgd2Fsayhub2RlLmNoaWxkcmVuLCBjdXJyZW50UGF0aCkNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmVzdWx0LnB1c2goew0KICAgICAgICAgICAgICBpZDogbm9kZS5pZCwNCiAgICAgICAgICAgICAgZnVsbE5hbWU6IGN1cnJlbnRQYXRoLmpvaW4oJyAvICcpDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIHdhbGsodHJlZSkNCiAgICAgIHJldHVybiByZXN1bHQNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiKA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/absenceRecord","sourcesContent":["<template>\r\n  <el-form :model=\"form\" label-width=\"120px\">\r\n    <!-- 学院部门信息 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"学校\" prop=\"school\">\r\n          <el-input v-model=\"form.school\" placeholder=\"自动填充\" :disabled=\"true\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"二级学院\" prop=\"department\">\r\n          <el-input v-model=\"form.department\" />\r\n        </el-form-item>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 班级选择器 -->\r\n    <el-form-item label=\"班级选择\">\r\n      <el-radio-group v-model=\"selectMode\">\r\n        <el-radio-button label=\"cascade\">层级选择</el-radio-button>\r\n        <el-radio-button label=\"search\">搜索选择</el-radio-button>\r\n      </el-radio-group>\r\n\r\n\r\n    <el-cascader\r\n    v-if=\"selectMode === 'cascade'\"\r\n    v-model=\"cascaderValue\" \r\n    :options=\"facultyOptions\"\r\n    :props=\"cascaderProps\"\r\n    placeholder=\"请选择学校/学院/专业/班级\"\r\n    filterable\r\n    @change=\"handleCascaderChange\" \r\n    />\r\n\r\n      <!-- 搜索选择 -->\r\n      <el-select\r\n        v-else\r\n        v-model=\"form.classId\"\r\n        filterable\r\n        placeholder=\"输入班级名称搜索\"\r\n      >\r\n        <el-option\r\n          v-for=\"item in flatClasses\"\r\n          :key=\"item.id\"\r\n          :label=\"item.fullName\"\r\n          :value=\"item.id\"\r\n        />\r\n      </el-select>\r\n    </el-form-item>\r\n\r\n    <!-- 其他表单字段 -->\r\n    <el-form-item label=\"缺勤日期\" prop=\"absentDate\">\r\n      <el-date-picker\r\n        v-model=\"form.absentDate\"\r\n        type=\"date\"\r\n        value-format=\"yyyy-MM-dd\"\r\n      />\r\n    </el-form-item>\r\n    \r\n    <el-form-item label=\"学生信息\">\r\n      <el-input v-model=\"form.name\" placeholder=\"姓名\" />\r\n      <el-radio-group v-model=\"form.gender\">\r\n        <el-radio :label=\"1\">男</el-radio>\r\n        <el-radio :label=\"0\">女</el-radio>\r\n      </el-radio-group>\r\n      <br>年龄：\r\n      <el-input-number v-model=\"form.age\" :min=\"0\" />\r\n    </el-form-item>\r\n\r\n        <!-- 登记人信息 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"登记人\" prop=\"registrar\">\r\n          <el-input v-model=\"form.registrar\" placeholder=\"请输入登记人姓名\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"登记电话\" prop=\"registrarPhone\">\r\n          <el-input v-model=\"form.registrarPhone\" placeholder=\"请输入联系电话\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"报送日期\" prop=\"reportDate\">\r\n          <el-date-picker\r\n            v-model=\"form.reportDate\"\r\n            type=\"date\"\r\n            value-format=\"yyyy-MM-dd\"\r\n          />\r\n        </el-form-item>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 就诊信息 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"就诊日期\" prop=\"visitDate\">\r\n          <el-date-picker\r\n            v-model=\"form.visitDate\"\r\n            type=\"date\"\r\n            value-format=\"yyyy-MM-dd\"\r\n          />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"就诊医院\" prop=\"hospital\">\r\n          <el-input v-model=\"form.hospital\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"诊断结果\" prop=\"diagnosis\">\r\n          <el-input v-model=\"form.diagnosis\" />\r\n        </el-form-item>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 其他补充字段 -->\r\n    <el-form-item label=\"学生电话\" prop=\"phone\">\r\n      <el-input v-model=\"form.phone\" />\r\n    </el-form-item>\r\n\r\n    <el-form-item label=\"主要症状\" prop=\"symptoms\">\r\n      <el-input type=\"textarea\" v-model=\"form.symptoms\" />\r\n    </el-form-item>\r\n\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"返校时间\" prop=\"returnDate\">\r\n          <el-date-picker\r\n            v-model=\"form.returnDate\"\r\n            type=\"date\"\r\n            value-format=\"yyyy-MM-dd\"\r\n          />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"是否治愈\">\r\n          <el-radio-group v-model=\"form.isCured\">\r\n            <el-radio :label=\"1\">是</el-radio>\r\n            <el-radio :label=\"0\">否</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-form-item label=\"是否传染病\">\r\n          <el-radio-group v-model=\"form.isInfectious\">\r\n            <el-radio :label=\"1\">是</el-radio>\r\n            <el-radio :label=\"0\">否</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 提交按钮 -->\r\n    <el-form-item>\r\n      <el-button type=\"primary\" @click=\"submitForm\">提交</el-button>\r\n    </el-form-item>\r\n\r\n  </el-form>\r\n</template>\r\n\r\n<script>\r\nimport { list } from '@/api/faculty'\r\nimport { addAbsenceRecord } from '@/api/absenceRecord'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      selectMode: 'cascade',\r\n      cascaderValue: [],  // 新增临时存储数组\r\n      form: {\r\n        classId: null,\r\n        school: '云南旅游职业学院',\r\n        department: '',\r\n        name: '',\r\n        gender: 1,\r\n        age: null,\r\n        absentDate: '',\r\n        registrar: '',\r\n        registrarPhone: '',\r\n        reportDate: '',\r\n        phone: '',\r\n        symptoms: '',\r\n        visitDate: '',\r\n        hospital: '',\r\n        diagnosis: '',\r\n        returnDate: '',\r\n        isCured: 0,\r\n        isInfectious: 0\r\n      },\r\n      cascaderProps: {\r\n        value: 'id',\r\n        label: 'name',\r\n        children: 'children',\r\n        checkStrictly: true\r\n      },\r\n      facultyOptions: [],\r\n      flatClasses: []\r\n    }\r\n  },\r\n  async created() {\r\n    const { data } = await list()\r\n    this.facultyOptions = data\r\n    this.flatClasses = this.flattenClasses(data)\r\n  },\r\n  methods: {\r\n\r\n    handleCascaderChange(valueArr) {\r\n    // 取路径数组的最后一个元素（班级ID）\r\n    this.form.classId = valueArr[valueArr.length - 1]\r\n    },\r\n\r\n    async submitForm() {\r\n        try {\r\n         // 转换驼峰字段为蛇形命名\r\n        const postData = {\r\n        ...this.form,\r\n        class_id: this.form.classId,\r\n        registrar_phone: this.form.registrarPhone,\r\n        visit_date: this.form.visitDate,\r\n        report_date: this.form.reportDate,\r\n        absent_date: this.form.absentDate,\r\n        return_date: this.form.returnDate,\r\n        is_cured: this.form.isCured,\r\n        is_infectious: this.form.isInfectious\r\n    }\r\n        delete postData.classId          // 对应class_id\r\n        delete postData.registrarPhone   // 对应registrar_phone\r\n        delete postData.reportDate       // 对应report_date\r\n        delete postData.absentDate       // 对应absent_date\r\n        delete postData.returnDate       // 对应return_date\r\n        delete postData.isCured           // 对应is_cured\r\n        delete postData.isInfectious     // 对应is_infectious\r\n        // 在提交前确保classId是单个值\r\n        if (Array.isArray(this.form.classId)) {\r\n        this.form.classId = this.form.classId[this.form.classId.length - 1]\r\n        }\r\n        console.log('最终提交数据:', postData) // 确保这里打印的是转换后的数据\r\n            await addAbsenceRecord(postData)  // 关键修改：提交postData而不是this.form\r\n        this.$message.success('记录添加成功')\r\n        this.resetForm()\r\n        } catch (error) {\r\n        this.$message.error('提交失败')\r\n        }\r\n    },\r\n    resetForm() {\r\n        this.form = {\r\n        // 重置所有字段...\r\n        class_id: null,\r\n        school: '云南旅游职业学院',\r\n        department: '',\r\n        name: '',\r\n        gender: 1,\r\n        age: null,\r\n        absent_date: '',\r\n        registrar: '',\r\n        registrar_phone: '',\r\n        report_date: '',\r\n        phone: '',\r\n        symptoms: '',\r\n        visit_date: '',\r\n        hospital: '',\r\n        diagnosis: '',\r\n        return_date: '',\r\n        is_cured: 0,\r\n        is_infectious: 0\r\n        }\r\n    },\r\n\r\n    flattenClasses(tree) {\r\n      const result = []\r\n      const walk = (nodes, path = []) => {\r\n        nodes.forEach(node => {\r\n          const currentPath = [...path, node.name]\r\n          if (node.children && node.children.length > 0) {\r\n            walk(node.children, currentPath)\r\n          } else {\r\n            result.push({\r\n              id: node.id,\r\n              fullName: currentPath.join(' / ')\r\n            })\r\n          }\r\n        })\r\n      }\r\n      walk(tree)\r\n      return result\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}