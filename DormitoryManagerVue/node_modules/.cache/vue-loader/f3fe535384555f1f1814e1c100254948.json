{"remainingRequest":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\views\\manage\\back\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\src\\views\\manage\\back\\index.vue","mtime":1712740387000},{"path":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1712740387000},{"path":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1712740387000},{"path":"E:\\学生宿舍信息管理系统\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1712740387000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7bGlzdCwgcXVlcnksIGRlbCwgc2F2ZU9yVXBkYXRlfSBmcm9tICdAL2FwaS9iYWNrJwppbXBvcnQge2xpc3RCeU5hbWUscXVlcnkgYXMgcXVlcnlTdHVkZW50fSBmcm9tICJAL2FwaS9zdHVkZW50IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiaW5kZXgiLAogIG1ldGhvZHM6IHsKICAgIHNhdmVPclVwZGF0ZSgpIHsKICAgICAgdGhpcy4kcmVmc1snc2F2ZU9yVXBkYXRlRm9ybSddLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgc2F2ZU9yVXBkYXRlKHRoaXMucmVjb3JkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXMubXNnLAogICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDbG9zZSgpCiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CgogICAgICAgICAgICAgICAgdGhpcy5saXN0RGF0YSgpCiAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fmraPnoa7loavlhpnlj4LmlbAnLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlQ2xvc2UoKSB7CiAgICAgIHRoaXMucmVjb3JkID0gewogICAgICAgIGlkOiB1bmRlZmluZWQsCiAgICAgICAgc3R1ZGVudElkOiB1bmRlZmluZWQsCiAgICAgICAgcmVhc29uOiB1bmRlZmluZWQsCiAgICAgICAgYmFja0RhdGU6IHVuZGVmaW5lZAogICAgICB9CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgIHRoaXMuJHJlZnNbJ3NhdmVPclVwZGF0ZUZvcm0nXS5yZXNldEZpZWxkcygpCiAgICB9LAogICAgYXN5bmMgc2hvd0RpYWxvZyhpZCkgewogICAgICB0aGlzLmRpYWxvZ1RpdGxlID0gJ+a3u+WKoCcKICAgICAgaWYgKGlkKSB7CiAgICAgICAgdGhpcy5kaWFsb2dUaXRsZSA9ICfkv67mlLknCiAgICAgICAgY29uc3Qge2RhdGF9ID0gYXdhaXQgcXVlcnkoaWQpCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIHRoaXMucmVjb3JkID0gZGF0YQogICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsaXN0RGF0YSgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICBjb25zdCB7ZGF0YX0gPSBhd2FpdCBsaXN0KHRoaXMubGlzdFF1ZXJ5KQogICAgICB0aGlzLnBhZ2VJbmZvID0gZGF0YQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgfSwKICAgIGRlbChpZCkgewogICAgICB0aGlzLiRjb25maXJtKCLmmK/lkKbnoa7lrpoiLCAi6K2m5ZGKIiwgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgZGVsKGlkKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgICBtZXNzYWdlOiByZXMubXNnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmxpc3REYXRhKCkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGFzeW5jIGdldFN0dWRlbnRzRnJvbVJlbW90ZShxdWVyeSkgewogICAgICBpZiAocXVlcnkgIT09ICcnKSB7CiAgICAgICAgdGhpcy5zZWxlY3RMb2FkaW5nID0gdHJ1ZQogICAgICAgIGNvbnN0IHtkYXRhfSA9IGF3YWl0IGxpc3RCeU5hbWUocXVlcnkpCiAgICAgICAgdGhpcy5zdHVkZW50cyA9IGRhdGEubWFwKGl0ZW0gPT4gewogICAgICAgICAgcmV0dXJuIHtpZDogaXRlbS5pZCwgbmFtZTppdGVtLnJvb20ubnVtYmVyICsgIiAiICsgaXRlbS5uYW1lICsgIjoiICsgaXRlbS5udW1iZXJ9CiAgICAgICAgfSkKICAgICAgICB0aGlzLnNlbGVjdExvYWRpbmcgPSBmYWxzZQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc3R1ZGVudHMgPSBbXQogICAgICB9CiAgICB9LAogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMuc3R1ZGVudHMgPSBbXQogICAgICB0aGlzLmxpc3RRdWVyeS5lbnRpdHkgPSB7fQogICAgICB0aGlzLnNlbGVjdCgpCiAgICB9LAogICAgc2VsZWN0KCkgewogICAgICB0aGlzLmxpc3RRdWVyeS5wYWdlID0gMQogICAgICB0aGlzLmxpc3REYXRhKCkKICAgIH0sCiAgICBoYW5kbGVTaXplQ2hhbmdlKHZhbCkgewogICAgICB0aGlzLmxpc3RRdWVyeS5yb3dzID0gdmFsCiAgICAgIHRoaXMubGlzdERhdGEoKQogICAgfSwKICAgIGhhbmRsZUN1cnJlbnRDaGFuZ2UodmFsKSB7CiAgICAgIHRoaXMubGlzdFF1ZXJ5LnBhZ2UgPSB2YWwKICAgICAgdGhpcy5saXN0RGF0YSgpCiAgICB9LAogICAgYXN5bmMgZ2V0U3R1ZGVudChpZCkgewogICAgICBjb25zdCB7ZGF0YX0gPSBhd2FpdCBxdWVyeVN0dWRlbnQoaWQpCiAgICAgIHRoaXMuc3R1ZGVudCA9IGRhdGEKICAgIH0sCiAgICBoaWRlUG9wb3ZlcigpIHsKICAgICAgdGhpcy5zdHVkZW50ID0ge30KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsaXN0UXVlcnk6ewogICAgICAgIHBhZ2U6IDEsCiAgICAgICAgcm93czogMTAsCiAgICAgICAgZW50aXR5OiB7fQogICAgICB9LAogICAgICBwYWdlSW5mbzoge30sCiAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgIHN0dWRlbnRzOiBbXSwKICAgICAgc3R1ZGVudDp7fSwKICAgICAgcmVjb3JkOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBzdHVkZW50SWQ6IHVuZGVmaW5lZCwKICAgICAgICByZWFzb246IHVuZGVmaW5lZCwKICAgICAgICBiYWNrRGF0ZTogdW5kZWZpbmVkCiAgICAgIH0sCiAgICAgIHNlbGVjdExvYWRpbmc6IHRydWUsCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBkaWFsb2dUaXRsZTogJycsCiAgICAgIHJ1bGVzIDp7CiAgICAgICAgc3R1ZGVudElkIDogWwogICAgICAgICAge3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn5aeT5ZCN5LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2JsdXInfQogICAgICAgIF0sCiAgICAgICAgcmVhc29uOiBbCiAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfljp/lm6DkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cid9CiAgICAgICAgXQogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5saXN0RGF0YSgpCiAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiIA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/back","sourcesContent":["<template>\n  <div class=\"router-container\">\n    <div class=\"container\">\n      <div class=\"inner_container\">\n        <div class=\"table\">\n          <el-form :inline=\"true\" ref=\"form\" label-width=\"70px\" :model=\"listQuery.entity\">\n            <el-form-item label=\"学生姓名\" v-has-permi=\"['student:list']\">\n              <el-select \n                  v-model=\"listQuery.entity.studentId\"\n                  filterable clearable\n                  remote\n                  placeholder=\"请输入关键词\"\n                  :remote-method=\"getStudentsFromRemote\"\n                  :loading=\"selectLoading\">\n                <el-option\n                    v-for=\"item in students\"\n                    :key=\"item.id\"\n                    :label=\"item.name\"\n                    :value=\"item.id\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"primary\" @click=\"select\" style=\"font-size: 16px;\" >\n                 查询\n              </el-button>\n              <el-button type=\"danger\" @click=\"reset\"  style=\"font-size: 16px;\" > 重置</el-button>\n              <el-button type=\"success\" v-has-permi=\"['back:save']\" @click=\"showDialog(undefined)\" style=\"font-size: 16px;\" > 新增</el-button>\n            </el-form-item>\n          </el-form>\n          <el-table :data=\"pageInfo.list\" v-loading=\"loading\" height=\"405\">\n            <el-table-column label=\"学生姓名\">\n              <template slot-scope=\"scope\">\n                <el-popover\n                    placement=\"bottom\"\n                    width=\"200\"\n                    trigger=\"click\" @show=\"getStudent(scope.row.student.id)\" @hide=\"hidePopover\">\n                  <el-form label-width=\"40px\">\n                    <el-form-item label=\"姓名\">\n                      <el-input v-model=\"student.name\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"学号\">\n                      <el-input v-model=\"student.number\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"电话\">\n                      <el-input v-model=\"student.phone\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"班级\" v-if=\"student.faculty\">\n                      <el-input v-model=\"student.faculty.name\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"寝室\" v-if=\"student.room\">\n                      <el-input v-model=\"student.room.number\" readonly ></el-input>\n                    </el-form-item>\n                  </el-form>\n                  <span slot=\"reference\" style=\"color: #409EFF;cursor: pointer\">{{scope.row.student.name}}</span>\n                </el-popover>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"原因\" prop=\"reason\" width=\"400\" :show-overflow-tooltip=\"true\"></el-table-column>\n            <el-table-column label=\"时间\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <span v-if=\"scope.row.backDate !== undefined\">{{scope.row.backDate}}</span>\n                <span v-else style=\"color: red\">未归</span>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"240\" fixed=\"right\">\n              <template slot-scope=\"scope\">\n                <el-button type=\"primary\" style=\"font-size: 14px;\"  v-has-permi=\"['back:query']\" @click=\"showDialog(scope.row.id)\">详情</el-button>\n                <el-button type=\"danger\" style=\"font-size: 14px;\"  v-has-permi=\"['back:delete']\" @click=\"del(scope.row.id)\">删除</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div class=\"page\">\n          <el-pagination\n              background\n              :page-size=\"listQuery.rows\"\n              :page-count=\"pageInfo.pages\"\n              layout=\"->, prev, pager, next, jumper, total, sizes\"\n              :total=\"pageInfo.total\"\n              :current-page.sync=\"pageInfo.pageNum\"\n              @current-change=\"handleCurrentChange\"\n              @size-change=\"handleSizeChange\"\n          >\n          </el-pagination>\n        </div>\n        <div class=\"dialog\">\n          <el-dialog :title=\"dialogTitle\"\n                     :visible.sync=\"dialogVisible\"\n                     width=\"45%\"\n                     @closed=\"handleClose\">\n            <el-form :model=\"record\" ref=\"saveOrUpdateForm\" label-width=\"80px\" :rules=\"rules\">\n              <template v-if=\"record && record.id !== undefined\">\n                <el-form-item label=\"学生姓名\">\n                  <el-input v-model=\"record.student.name\" readonly></el-input>\n                </el-form-item>\n              </template>\n              <template v-else>\n                <el-form-item label=\"学生姓名\" prop=\"studentId\">\n                  <el-select v-model=\"record.studentId\" remote filterable placeholder=\"输入关键字\"\n                             :remote-method=\"getStudentsFromRemote\" :loading=\"selectLoading\">\n                    <el-option v-for=\"item in students\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\n                  </el-select>\n                </el-form-item>\n              </template>\n              <el-form-item label=\"回寝时间\">\n                <el-date-picker value-format=\"yyyy-MM-dd HH:mm:ss\"\n                    v-model=\"record.backDate\"\n                    type=\"datetime\"\n                    placeholder=\"选择日期时间\">\n                </el-date-picker>\n              </el-form-item>\n              <el-form-item label=\"原因\" prop=\"reason\">\n                <el-input v-model=\"record.reason\" type=\"textarea\"\n                          placeholder=\"输入原因\" rows=\"10\"></el-input>\n              </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                            <el-button type=\"danger\" @click=\"handleClose\"> 取 消</el-button>\n                            <el-button type=\"primary\" @click=\"saveOrUpdate\" v-has-permi=\"['back:update','back:save']\"> 保 存</el-button>\n                          </span>\n          </el-dialog>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {list, query, del, saveOrUpdate} from '@/api/back'\nimport {listByName,query as queryStudent} from \"@/api/student\";\n\nexport default {\n  name: \"index\",\n  methods: {\n    saveOrUpdate() {\n      this.$refs['saveOrUpdateForm'].validate((valid) => {\n        if (valid) {\n          saveOrUpdate(this.record).then(res => {\n            if (res.statusCode === 200) {\n              this.$message({\n                message: res.msg,\n                type: 'success'\n              });\n              this.handleClose()\n              setTimeout(() => {\n\n                this.listData()\n              }, 100);\n            }\n          })\n        } else {\n          this.$message({\n            message: '请正确填写参数',\n            type: 'error'\n          });\n          return false;\n        }\n      })\n    },\n    handleClose() {\n      this.record = {\n        id: undefined,\n        studentId: undefined,\n        reason: undefined,\n        backDate: undefined\n      }\n      this.dialogVisible = false\n      this.$refs['saveOrUpdateForm'].resetFields()\n    },\n    async showDialog(id) {\n      this.dialogTitle = '添加'\n      if (id) {\n        this.dialogTitle = '修改'\n        const {data} = await query(id)\n        if (data) {\n          this.record = data\n          this.dialogVisible = true\n        }\n      } else {\n        this.dialogVisible = true\n      }\n    },\n    async listData() {\n      this.loading = true\n      const {data} = await list(this.listQuery)\n      this.pageInfo = data\n      this.loading = false\n    },\n    del(id) {\n      this.$confirm(\"是否确定\", \"警告\", {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        del(id).then((res) => {\n          if (res.statusCode === 200) {\n            this.$message({\n              type: 'success',\n              message: res.msg\n            });\n            this.listData()\n          }\n        })\n      })\n    },\n    async getStudentsFromRemote(query) {\n      if (query !== '') {\n        this.selectLoading = true\n        const {data} = await listByName(query)\n        this.students = data.map(item => {\n          return {id: item.id, name:item.room.number + \" \" + item.name + \":\" + item.number}\n        })\n        this.selectLoading = false\n      } else {\n        this.students = []\n      }\n    },\n    reset() {\n      this.students = []\n      this.listQuery.entity = {}\n      this.select()\n    },\n    select() {\n      this.listQuery.page = 1\n      this.listData()\n    },\n    handleSizeChange(val) {\n      this.listQuery.rows = val\n      this.listData()\n    },\n    handleCurrentChange(val) {\n      this.listQuery.page = val\n      this.listData()\n    },\n    async getStudent(id) {\n      const {data} = await queryStudent(id)\n      this.student = data\n    },\n    hidePopover() {\n      this.student = {}\n    }\n  },\n  data() {\n    return {\n      listQuery:{\n        page: 1,\n        rows: 10,\n        entity: {}\n      },\n      pageInfo: {},\n      loading: true,\n      students: [],\n      student:{},\n      record: {\n        id: undefined,\n        studentId: undefined,\n        reason: undefined,\n        backDate: undefined\n      },\n      selectLoading: true,\n      dialogVisible: false,\n      dialogTitle: '',\n      rules :{\n        studentId : [\n          {required: true, message: '姓名不能为空', trigger: 'blur'}\n        ],\n        reason: [\n          {required: true, message: '原因不能为空', trigger: 'blur'}\n        ]\n      }\n    }\n  },\n  created() {\n    this.listData()\n  }\n}\n</script>\n\n<style scoped>\n.table {\n  padding: 30px;\n}\n</style>\n"]}]}