{"remainingRequest":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\src\\views\\manage\\back\\index.vue?vue&type=style&index=0&id=65bb4bea&scoped=true&lang=css&","dependencies":[{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\src\\views\\manage\\back\\index.vue","mtime":1698937672000},{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1678020086000},{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1678020088000},{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1678020086000},{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678020084000},{"path":"G:\\学生宿舍信息综合管理与服务平台\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1678020088000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50YWJsZSB7CiAgcGFkZGluZzogMzBweDsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAwRA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/back","sourcesContent":["<template>\n  <div class=\"router-container\">\n    <div class=\"container\">\n      <div class=\"inner_container\">\n        <div class=\"table\">\n          <el-form :inline=\"true\" ref=\"form\" label-width=\"70px\" :model=\"listQuery.entity\">\n            <el-form-item label=\"学生姓名\" v-has-permi=\"['student:list']\">\n              <el-select \n                  v-model=\"listQuery.entity.studentId\"\n                  filterable clearable\n                  remote\n                  placeholder=\"请输入关键词\"\n                  :remote-method=\"getStudentsFromRemote\"\n                  :loading=\"selectLoading\">\n                <el-option\n                    v-for=\"item in students\"\n                    :key=\"item.id\"\n                    :label=\"item.name\"\n                    :value=\"item.id\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"primary\" @click=\"select\" style=\"font-size: 16px;\" >\n                 查询\n              </el-button>\n              <el-button type=\"danger\" @click=\"reset\"  style=\"font-size: 16px;\" > 重置</el-button>\n              <el-button type=\"success\" v-has-permi=\"['back:save']\" @click=\"showDialog(undefined)\" style=\"font-size: 16px;\" > 新增</el-button>\n            </el-form-item>\n          </el-form>\n          <el-table :data=\"pageInfo.list\" v-loading=\"loading\" height=\"405\">\n            <el-table-column label=\"学生姓名\">\n              <template slot-scope=\"scope\">\n                <el-popover\n                    placement=\"bottom\"\n                    width=\"200\"\n                    trigger=\"click\" @show=\"getStudent(scope.row.student.id)\" @hide=\"hidePopover\">\n                  <el-form label-width=\"40px\">\n                    <el-form-item label=\"姓名\">\n                      <el-input v-model=\"student.name\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"学号\">\n                      <el-input v-model=\"student.number\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"电话\">\n                      <el-input v-model=\"student.phone\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"班级\" v-if=\"student.faculty\">\n                      <el-input v-model=\"student.faculty.name\" readonly ></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"寝室\" v-if=\"student.room\">\n                      <el-input v-model=\"student.room.number\" readonly ></el-input>\n                    </el-form-item>\n                  </el-form>\n                  <span slot=\"reference\" style=\"color: #409EFF;cursor: pointer\">{{scope.row.student.name}}</span>\n                </el-popover>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"原因\" prop=\"reason\" width=\"400\" :show-overflow-tooltip=\"true\"></el-table-column>\n            <el-table-column label=\"时间\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <span v-if=\"scope.row.backDate !== undefined\">{{scope.row.backDate}}</span>\n                <span v-else style=\"color: red\">未归</span>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"240\" fixed=\"right\">\n              <template slot-scope=\"scope\">\n                <el-button type=\"primary\" style=\"font-size: 14px;\"  v-has-permi=\"['back:query']\" @click=\"showDialog(scope.row.id)\">详情</el-button>\n                <el-button type=\"danger\" style=\"font-size: 14px;\"  v-has-permi=\"['back:delete']\" @click=\"del(scope.row.id)\">删除</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div class=\"page\">\n          <el-pagination\n              background\n              :page-size=\"listQuery.rows\"\n              :page-count=\"pageInfo.pages\"\n              layout=\"->, prev, pager, next, jumper, total, sizes\"\n              :total=\"pageInfo.total\"\n              :current-page.sync=\"pageInfo.pageNum\"\n              @current-change=\"handleCurrentChange\"\n              @size-change=\"handleSizeChange\"\n          >\n          </el-pagination>\n        </div>\n        <div class=\"dialog\">\n          <el-dialog :title=\"dialogTitle\"\n                     :visible.sync=\"dialogVisible\"\n                     width=\"45%\"\n                     @closed=\"handleClose\">\n            <el-form :model=\"record\" ref=\"saveOrUpdateForm\" label-width=\"80px\" :rules=\"rules\">\n              <template v-if=\"record && record.id !== undefined\">\n                <el-form-item label=\"学生姓名\">\n                  <el-input v-model=\"record.student.name\" readonly></el-input>\n                </el-form-item>\n              </template>\n              <template v-else>\n                <el-form-item label=\"学生姓名\" prop=\"studentId\">\n                  <el-select v-model=\"record.studentId\" remote filterable placeholder=\"输入关键字\"\n                             :remote-method=\"getStudentsFromRemote\" :loading=\"selectLoading\">\n                    <el-option v-for=\"item in students\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\n                  </el-select>\n                </el-form-item>\n              </template>\n              <el-form-item label=\"回寝时间\">\n                <el-date-picker value-format=\"yyyy-MM-dd HH:mm:ss\"\n                    v-model=\"record.backDate\"\n                    type=\"datetime\"\n                    placeholder=\"选择日期时间\">\n                </el-date-picker>\n              </el-form-item>\n              <el-form-item label=\"原因\" prop=\"reason\">\n                <el-input v-model=\"record.reason\" type=\"textarea\"\n                          placeholder=\"输入原因\" rows=\"10\"></el-input>\n              </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                            <el-button type=\"danger\" @click=\"handleClose\"> 取 消</el-button>\n                            <el-button type=\"primary\" @click=\"saveOrUpdate\" v-has-permi=\"['back:update','back:save']\"> 保 存</el-button>\n                          </span>\n          </el-dialog>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {list, query, del, saveOrUpdate} from '@/api/back'\nimport {listByName,query as queryStudent} from \"@/api/student\";\n\nexport default {\n  name: \"index\",\n  methods: {\n    saveOrUpdate() {\n      this.$refs['saveOrUpdateForm'].validate((valid) => {\n        if (valid) {\n          saveOrUpdate(this.record).then(res => {\n            if (res.statusCode === 200) {\n              this.$message({\n                message: res.msg,\n                type: 'success'\n              });\n              this.handleClose()\n              setTimeout(() => {\n\n                this.listData()\n              }, 100);\n            }\n          })\n        } else {\n          this.$message({\n            message: '请正确填写参数',\n            type: 'error'\n          });\n          return false;\n        }\n      })\n    },\n    handleClose() {\n      this.record = {\n        id: undefined,\n        studentId: undefined,\n        reason: undefined,\n        backDate: undefined\n      }\n      this.dialogVisible = false\n      this.$refs['saveOrUpdateForm'].resetFields()\n    },\n    async showDialog(id) {\n      this.dialogTitle = '添加'\n      if (id) {\n        this.dialogTitle = '修改'\n        const {data} = await query(id)\n        if (data) {\n          this.record = data\n          this.dialogVisible = true\n        }\n      } else {\n        this.dialogVisible = true\n      }\n    },\n    async listData() {\n      this.loading = true\n      const {data} = await list(this.listQuery)\n      this.pageInfo = data\n      this.loading = false\n    },\n    del(id) {\n      this.$confirm(\"是否确定\", \"警告\", {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        del(id).then((res) => {\n          if (res.statusCode === 200) {\n            this.$message({\n              type: 'success',\n              message: res.msg\n            });\n            this.listData()\n          }\n        })\n      })\n    },\n    async getStudentsFromRemote(query) {\n      if (query !== '') {\n        this.selectLoading = true\n        const {data} = await listByName(query)\n        this.students = data.map(item => {\n          return {id: item.id, name:item.room.number + \" \" + item.name + \":\" + item.number}\n        })\n        this.selectLoading = false\n      } else {\n        this.students = []\n      }\n    },\n    reset() {\n      this.students = []\n      this.listQuery.entity = {}\n      this.select()\n    },\n    select() {\n      this.listQuery.page = 1\n      this.listData()\n    },\n    handleSizeChange(val) {\n      this.listQuery.rows = val\n      this.listData()\n    },\n    handleCurrentChange(val) {\n      this.listQuery.page = val\n      this.listData()\n    },\n    async getStudent(id) {\n      const {data} = await queryStudent(id)\n      this.student = data\n    },\n    hidePopover() {\n      this.student = {}\n    }\n  },\n  data() {\n    return {\n      listQuery:{\n        page: 1,\n        rows: 10,\n        entity: {}\n      },\n      pageInfo: {},\n      loading: true,\n      students: [],\n      student:{},\n      record: {\n        id: undefined,\n        studentId: undefined,\n        reason: undefined,\n        backDate: undefined\n      },\n      selectLoading: true,\n      dialogVisible: false,\n      dialogTitle: '',\n      rules :{\n        studentId : [\n          {required: true, message: '姓名不能为空', trigger: 'blur'}\n        ],\n        reason: [\n          {required: true, message: '原因不能为空', trigger: 'blur'}\n        ]\n      }\n    }\n  },\n  created() {\n    this.listData()\n  }\n}\n</script>\n\n<style scoped>\n.table {\n  padding: 30px;\n}\n</style>\n"]}]}