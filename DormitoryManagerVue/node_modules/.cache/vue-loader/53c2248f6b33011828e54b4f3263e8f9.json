{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\personal\\info\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\personal\\info\\index.vue","mtime":1698660386000},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762330415881},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7Z2V0VXNlckluZm8sIHVwZGF0ZSwgY2hhbmdlSWNvbn0gZnJvbSAiQC9hcGkvdXNlciI7CmltcG9ydCB7Z2V0VG9rZW59IGZyb20gIkAvdXRpbHMvYXV0aCI7CmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3JlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiaW5kZXgiLAogIGRhdGEoKSB7CiAgICBsZXQgdmFsaWRhdG9yMSA9IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNhbGxiYWNrKCkKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBsZXQgcmVnID0gL14xWzM0NTY3ODldXGR7OX0kLwogICAgICBpZiAoIXJlZy50ZXN0KHZhbHVlKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigpKQogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCkKICAgICAgfQogICAgfQogICAgbGV0IHZhbGlkYXRvcjIgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICBjYWxsYmFjaygpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgbGV0IHJlZyA9IC9eWzAtOWEtekEtWl8uLV0rW0BdWzAtOWEtekEtWl8uLV0rKFsuXVthLXpBLVpdKyl7MSwyfSQvOwogICAgICBpZiAoIXJlZy50ZXN0KHZhbHVlKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigpKQogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCkKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgaGVhZGVyOiB7CiAgICAgICAgIl91dCI6IGdldFRva2VuKCkKICAgICAgfSwKICAgICAgYWN0aW9uOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJICsgIi9wZXJtaXNzaW9uL3VwbG9hZCIsCiAgICAgIHVzZXI6IHsKICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgIHJlYWxOYW1lOiAnJywKICAgICAgICBpY29uOiB1bmRlZmluZWQsCiAgICAgICAgY2VsbHBob25lOiAnJywKICAgICAgICBlbWFpbDogJycKICAgICAgfSwKICAgICAgcnVsZXM6IHsKICAgICAgICByZWFsTmFtZTogWwogICAgICAgICAge3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn5ZCN56ew5LiN6IO95Li656m6JywgdHJpZ2dlcjogJ2NoYW5nZSd9LAogICAgICAgICAge21pbjogMiwgbWF4OiAyMCwgbWVzc2FnZTogJ+mVv+W6puWcqCAyIOWIsCAyMCDkuKrlrZfnrKYnLCB0cmlnZ2VyOiAnY2hhbmdlJ30KICAgICAgICBdLAogICAgICAgIGNlbGxwaG9uZTogWwogICAgICAgICAge3ZhbGlkYXRvcjogdmFsaWRhdG9yMSwgbWVzc2FnZTogIuivt+i+k+WFpeato+ehrueahOaJi+acuuWPtyIsIHRyaWdnZXI6ICdjaGFuZ2UnfQogICAgICAgIF0sCiAgICAgICAgZW1haWw6IFsKICAgICAgICAgIHt2YWxpZGF0b3I6IHZhbGlkYXRvcjIsIG1lc3NhZ2U6ICLor7fovpPlhaXmraPnoa7nmoTpgq7nrrEiLCB0cmlnZ2VyOiAnY2hhbmdlJ30KICAgICAgICBdCiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGhhbmRsZUF2YXRhclN1Y2Nlc3MocmVzKSB7CiAgICAgIGF3YWl0IHRoaXMuY2hhbmdlSWNvbihyZXMuZGF0YSkKICAgIH0sCiAgICBiZWZvcmVBdmF0YXJVcGxvYWQoZmlsZSkgewogICAgICBjb25zdCBpc0pQRyA9IGZpbGUudHlwZS5pbmRleE9mKCdpbWFnZS8nKSAhPT0gLTE7CiAgICAgIGNvbnN0IGlzTHQyTSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgMjsKCiAgICAgIGlmICghaXNKUEcpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCflj6rog73kuIrkvKDlm77niYcnKTsKICAgICAgfQogICAgICBpZiAoIWlzTHQyTSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOWktOWDj+WbvueJh+Wkp+Wwj+S4jeiDvei2hei/hyAyTUIhJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGlzSlBHICYmIGlzTHQyTTsKICAgIH0sCiAgICBhc3luYyBjaGFuZ2VJY29uKGljb24pIHsKICAgICAgY2hhbmdlSWNvbihpY29uKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiByZXMubXNnLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5yZXNldCgpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHVwZGF0ZShmb3JtKSB7CiAgICAgIHRoaXMuJHJlZnNbZm9ybV0udmFsaWRhdGUoKHZhbGlkKSA9PiB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICB1cGRhdGUodGhpcy51c2VyKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1VTRVJfTkFNRScsIHJlcy5kYXRhLnJlYWxOYW1lKQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICBtZXNzYWdlOiByZXMubXNnLAogICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn6K+35q2j56Gu5aGr5YaZ5Y+C5pWwJywKICAgICAgICAgICAgdHlwZTogJ2Vycm9yJwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyByZXNldCgpIHsKICAgICAgY29uc3Qge2RhdGF9ID0gYXdhaXQgZ2V0VXNlckluZm8oKQogICAgICBpZiAoZGF0YS5pY29uKSB7CiAgICAgICAgZGF0YS5pY29uID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9JTUdfUFJFRklYICsgZGF0YS5pY29uCiAgICAgIH0KICAgICAgdGhpcy51c2VyID0gZGF0YQogICAgICBzdG9yZS5jb21taXQoJ1NFVF9VU0VSX0lDT04nLCB0aGlzLnVzZXIuaWNvbikKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnJlc2V0KCkKICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAwCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/personal/info","sourcesContent":["<template>\n  <div>\n    <div class=\"container\">\n      <div class=\"inner_container\">\n        <div class=\"user-form\">\n          <div class=\"avatar\" title=\"点击更换头像\">\n            <el-upload\n                class=\"avatar-uploader\"\n                :action=\"action\"\n                :show-file-list=\"false\"\n                :headers=\"header\"\n                :on-success=\"handleAvatarSuccess\"\n                :before-upload=\"beforeAvatarUpload\">\n              <img v-if=\"user.icon\" :src=\"user.icon\" class=\"avatar\" alt=\"\">\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n            </el-upload>\n          </div>\n          <br>\n          <el-form ref=\"form\" :rules=\"rules\" :model=\"user\" label-width=\"100px\">\n            <el-form-item label=\"用户名称:\" prop=\"realName\">\n              <el-input v-model=\"user.realName\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"电话:\" prop=\"cellphone\">\n              <el-input v-model=\"user.cellphone\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"邮箱:\" prop=\"email\">\n              <el-input v-model=\"user.email\"></el-input>\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"success\" style=\"font-size: 16px;\"  @click=\"update('form')\"> 修改</el-button>\n              <el-button type=\"warning\" style=\"font-size: 16px;\"  @click=\"reset\"> 重置</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {getUserInfo, update, changeIcon} from \"@/api/user\";\nimport {getToken} from \"@/utils/auth\";\nimport store from \"@/store\";\n\nexport default {\n  name: \"index\",\n  data() {\n    let validator1 = (rule, value, callback) => {\n      if (value.length === 0) {\n        callback()\n        return\n      }\n      let reg = /^1[3456789]\\d{9}$/\n      if (!reg.test(value)) {\n        callback(new Error())\n      } else {\n        callback()\n      }\n    }\n    let validator2 = (rule, value, callback) => {\n      if (value.length === 0) {\n        callback()\n        return\n      }\n      let reg = /^[0-9a-zA-Z_.-]+[@][0-9a-zA-Z_.-]+([.][a-zA-Z]+){1,2}$/;\n      if (!reg.test(value)) {\n        callback(new Error())\n      } else {\n        callback()\n      }\n    }\n    return {\n      header: {\n        \"_ut\": getToken()\n      },\n      action: process.env.VUE_APP_BASE_API + \"/permission/upload\",\n      user: {\n        id: undefined,\n        realName: '',\n        icon: undefined,\n        cellphone: '',\n        email: ''\n      },\n      rules: {\n        realName: [\n          {required: true, message: '名称不能为空', trigger: 'change'},\n          {min: 2, max: 20, message: '长度在 2 到 20 个字符', trigger: 'change'}\n        ],\n        cellphone: [\n          {validator: validator1, message: \"请输入正确的手机号\", trigger: 'change'}\n        ],\n        email: [\n          {validator: validator2, message: \"请输入正确的邮箱\", trigger: 'change'}\n        ]\n      }\n    }\n  },\n  methods: {\n    async handleAvatarSuccess(res) {\n      await this.changeIcon(res.data)\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type.indexOf('image/') !== -1;\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('只能上传图片');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },\n    async changeIcon(icon) {\n      changeIcon(icon).then(res => {\n        if (res.statusCode === 200) {\n          this.$message({\n            message: res.msg,\n            type: 'success'\n          });\n          this.reset()\n        }\n      })\n    },\n    update(form) {\n      this.$refs[form].validate((valid) => {\n        if (valid) {\n          update(this.user).then(res => {\n            store.commit('SET_USER_NAME', res.data.realName)\n            this.$message({\n              message: res.msg,\n              type: 'success'\n            });\n          })\n        } else {\n          this.$message({\n            message: '请正确填写参数',\n            type: 'error'\n          });\n          return false;\n        }\n      });\n    },\n    async reset() {\n      const {data} = await getUserInfo()\n      if (data.icon) {\n        data.icon = process.env.VUE_APP_IMG_PREFIX + data.icon\n      }\n      this.user = data\n      store.commit('SET_USER_ICON', this.user.icon)\n    }\n  },\n  created() {\n    this.reset()\n  }\n}\n</script>\n\n<style scoped>\n.user-form {\n  width: 400px;\n  margin: 0 auto;\n}\n\n.avatar, .avatar-uploader {\n  width: 80px;\n  height: 80px;\n  margin: 0 auto;\n}\n\n.avatar-uploader i {\n  line-height: 80px;\n  text-align: center;\n  margin: 0 32px;\n}\n\n.avatar-uploader {\n  border: 1px dashed #d9d9d9;\n}\n\n.avatar-uploader:hover {\n  border-color: #409EFF;\n}\n</style>\n"]}]}