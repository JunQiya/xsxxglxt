{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\service\\AI\\index.vue?vue&type=style&index=0&id=0c447fdf&scoped=true&lang=css","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\service\\AI\\index.vue","mtime":1762856416988},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1762330399953},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1762330418934},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1762330405156},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgouY2hhdC1jb250YWluZXIgewogIG1heC13aWR0aDogMTQwMHB4OwogIG1hcmdpbjogMjBweCBhdXRvOwogIGJvcmRlcjogMXB4IHNvbGlkICNlNGU3ZWQ7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5jaGF0LW1lc3NhZ2VzIHsKICBoZWlnaHQ6IDYwMHB4OwogIG92ZXJmbG93LXk6IGF1dG87CiAgcGFkZGluZzogMjBweDsKICBiYWNrZ3JvdW5kOiAjZjhmOWZhOwp9CgoubWVzc2FnZSB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDE1cHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoKLm1lc3NhZ2UudXNlciB7CiAgZmxleC1kaXJlY3Rpb246IHJvdy1yZXZlcnNlOwp9CgouYXZhdGFyIGltZyB7CiAgd2lkdGg6IDQwcHg7CiAgaGVpZ2h0OiA0MHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKfQoKLmNvbnRlbnQgewogIG1heC13aWR0aDogNzAlOwogIHBhZGRpbmc6IDEycHggMTZweDsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIGJhY2tncm91bmQ6IHdoaXRlOwogIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMSk7Cn0KCi5tZXNzYWdlLmFzc2lzdGFudCAuY29udGVudCB7CiAgYmFja2dyb3VuZDogIzE0NjRFNDsKICBjb2xvcjogd2hpdGU7Cn0KCi5pbnB1dC1hcmVhIHsKICBkaXNwbGF5OiBmbGV4OwogIHBhZGRpbmc6IDIwcHg7CiAgYmFja2dyb3VuZDogd2hpdGU7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNGU3ZWQ7Cn0KCmlucHV0IHsKICBmbGV4OiAxOwogIHBhZGRpbmc6IDEycHg7CiAgYm9yZGVyOiAxcHggc29saWQgI2U0ZTdlZDsKICBib3JkZXItcmFkaXVzOiA2cHg7CiAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9CgpidXR0b24gewogIHBhZGRpbmc6IDEycHggMjRweDsKICBiYWNrZ3JvdW5kOiAjMTQ2NEU0OwogIGNvbG9yOiB3aGl0ZTsKICBib3JkZXI6IG5vbmU7CiAgYm9yZGVyLXJhZGl1czogNnB4OwogIGN1cnNvcjogcG9pbnRlcjsKfQoKYnV0dG9uOmRpc2FibGVkIHsKICBiYWNrZ3JvdW5kOiAjYTBjMGYwOwogIGN1cnNvcjogbm90LWFsbG93ZWQ7Cn0KCi5sb2FkaW5nLWluZGljYXRvciB7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGNvbG9yOiAjNjY2OwogIHBhZGRpbmc6IDEwcHg7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;AAyPA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/service/AI","sourcesContent":["<template>\r\n  <!-- src/view/AI/index.vue -->\r\n\r\n      <div class=\"chat-container\">\r\n        <div>\r\n          <h2 style=\"text-align: center; margin: 20px 0;\">AI智能问答助手</h2>\r\n        </div>\r\n  \r\n        <!-- 聊天消息 -->\r\n        <div class=\"chat-messages\">\r\n          <div v-for=\"(msg, index) in messages\" :key=\"index\" :class=\"['message', msg.role]\">\r\n            <div class=\"avatar\">\r\n              <img :src=\"msg.role === 'user' ? userAvatar : aiAvatar\" alt=\"avatar\">\r\n            </div>\r\n            <div class=\"content\">{{ msg.content }}</div>\r\n          </div>\r\n          <div v-if=\"loading\" class=\"loading-indicator\">思考中...</div>\r\n        </div>\r\n    \r\n  \r\n        <!-- 少用点，测试一下，免费额度用完得扣钱 -->\r\n  \r\n  \r\n        <!-- 用户输入 -->\r\n        <div class=\"input-area\">\r\n          <input\r\n            v-model=\"inputMessage\"\r\n            @keyup.enter=\"sendMessage\"\r\n            placeholder=\"输入您的问题...\"\r\n            :disabled=\"loading\"\r\n          />\r\n          <button @click=\"sendMessage\" :disabled=\"!loading && !inputMessage\">\r\n            {{ loading ? '取消' : '发送' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n  </template>\r\n  \r\n  <!-- 支持多轮对话，目前模型DeepseekV3，联网搜索，单个页面可完成AI调用,无需后端-->\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        messages: [],\r\n        inputMessage: '',\r\n        loading: false,\r\n        // userAvatar: require('@/assets/image/user.png'), // 这个地方在控制台报错，用CDN地址搞一个用户头像也许可以解决\r\n        aiAvatar: 'http://xsxx.lxxno.cn/2025xszhwz/O1CN01Pda9nq1YDV0mnZ31H_!!6000000003025-54-tps-120-120.apng',\r\n        sessionId: null,\r\n        abortController: null,\r\n        isAborted: false,\r\n        currentReader: null\r\n      }\r\n    },\r\n    methods: {\r\n      async sendMessage() {\r\n        if (this.loading) {\r\n          this.abortController?.abort();\r\n          this.isAborted = true;\r\n          if (this.currentReader) {\r\n            await this.currentReader.cancel();\r\n          }\r\n          return;\r\n        }\r\n  \r\n        if (!this.inputMessage.trim()) return;\r\n  \r\n        try {\r\n          this.loading = true;\r\n          this.isAborted = false;\r\n          this.messages.push({ role: 'user', content: this.inputMessage });\r\n  \r\n          const apiKey = 'sk-8dcb7c7b8a054cb8904ca7eca58dae62';\r\n          const appId = '7991bf8e5def42c1b2f78f21b7378553';\r\n          const url = `https://dashscope.aliyuncs.com/api/v1/apps/${appId}/completion`;\r\n  \r\n          this.abortController = new AbortController();\r\n          const response = await fetch(url, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Authorization': `Bearer ${apiKey}`,\r\n              'Content-Type': 'application/json',\r\n              'X-DashScope-SSE': 'enable'\r\n            },\r\n            body: JSON.stringify({\r\n              input: {\r\n                prompt: this.inputMessage.trim(),\r\n                session_id: this.sessionId,\r\n              },\r\n              parameters: {\r\n                'incremental_output': 'true'\r\n              },\r\n              debug: {}\r\n            }),\r\n            signal: this.abortController.signal\r\n          });\r\n  \r\n          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n  \r\n          let fullResponse = '';\r\n          let buffer = '';\r\n          const assistantMessageIndex = this.messages.push({\r\n            role: 'assistant',\r\n            content: ''\r\n          }) - 1;\r\n  \r\n          const reader = response.body.getReader();\r\n          this.currentReader = reader;\r\n          const decoder = new TextDecoder('utf-8');\r\n  \r\n          const processStream = async ({ done, value }) => {\r\n            if (done || this.isAborted) {\r\n              this.loading = false;\r\n              return;\r\n            }\r\n  \r\n            buffer += decoder.decode(value);\r\n            const lines = buffer.split('\\n');\r\n            buffer = lines.pop() || '';\r\n  \r\n            for (const line of lines) {\r\n              if (line.startsWith('data:')) {\r\n                try {\r\n                  const eventData = JSON.parse(line.slice(5).trim());\r\n                  if (eventData.output?.text) {\r\n                    fullResponse += eventData.output.text;\r\n                    this.$set(this.messages, assistantMessageIndex, {\r\n                      ...this.messages[assistantMessageIndex],\r\n                      content: fullResponse\r\n                    });\r\n                    this.sessionId = eventData.output.session_id;\r\n                  }\r\n                } catch (e) {\r\n                  console.error('解析错误:', e);\r\n                }\r\n              }\r\n            }\r\n  \r\n            reader.read().then(processStream);\r\n          };\r\n  \r\n          reader.read().then(processStream).catch(error => {\r\n            if (error.name !== 'AbortError') {\r\n              console.error('流读取错误:', error);\r\n            }\r\n          });\r\n  \r\n        } catch (error) {\r\n          this.loading = false;\r\n          if (error.name === 'AbortError' && this.isAborted) {\r\n            this.messages.push({ role: 'system', content: '已取消生成' });\r\n          } else {\r\n            console.error(`Error calling DashScope: ${error.message}`);\r\n            this.messages.push({ role: 'system', content: '请求出错，请稍后重试' });\r\n          }\r\n        } finally {\r\n          this.abortController = null;\r\n          if (!this.isAborted) {\r\n            this.inputMessage = '';\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n\r\n    .chat-container {\r\n      max-width: 1400px;\r\n      margin: 20px auto;\r\n      border: 1px solid #e4e7ed;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n    }\r\n    \r\n    .chat-messages {\r\n      height: 600px;\r\n      overflow-y: auto;\r\n      padding: 20px;\r\n      background: #f8f9fa;\r\n    }\r\n    \r\n    .message {\r\n      display: flex;\r\n      gap: 15px;\r\n      margin-bottom: 20px;\r\n    }\r\n    \r\n    .message.user {\r\n      flex-direction: row-reverse;\r\n    }\r\n    \r\n    .avatar img {\r\n      width: 40px;\r\n      height: 40px;\r\n      border-radius: 50%;\r\n    }\r\n    \r\n    .content {\r\n      max-width: 70%;\r\n      padding: 12px 16px;\r\n      border-radius: 12px;\r\n      background: white;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .message.assistant .content {\r\n      background: #1464E4;\r\n      color: white;\r\n    }\r\n    \r\n    .input-area {\r\n      display: flex;\r\n      padding: 20px;\r\n      background: white;\r\n      border-top: 1px solid #e4e7ed;\r\n    }\r\n    \r\n    input {\r\n      flex: 1;\r\n      padding: 12px;\r\n      border: 1px solid #e4e7ed;\r\n      border-radius: 6px;\r\n      margin-right: 10px;\r\n    }\r\n    \r\n    button {\r\n      padding: 12px 24px;\r\n      background: #1464E4;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n    }\r\n    \r\n    button:disabled {\r\n      background: #a0c0f0;\r\n      cursor: not-allowed;\r\n    }\r\n    \r\n    .loading-indicator {\r\n      text-align: center;\r\n      color: #666;\r\n      padding: 10px;\r\n    }\r\n  </style>"]}]}