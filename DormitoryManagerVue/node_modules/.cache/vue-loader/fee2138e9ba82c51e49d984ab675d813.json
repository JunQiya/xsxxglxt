{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\service\\AI\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\service\\AI\\index.vue","mtime":1763033407922},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1762330415881},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIGV4cG9ydCBkZWZhdWx0IHsNCiAgICBkYXRhKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgbWVzc2FnZXM6IFtdLA0KICAgICAgICBpbnB1dE1lc3NhZ2U6ICcnLA0KICAgICAgICBsb2FkaW5nOiBmYWxzZSwNCiAgICAgICAgLy8gdXNlckF2YXRhcjogcmVxdWlyZSgnQC9hc3NldHMvaW1hZ2UvdXNlci5wbmcnKSwgLy8g6L+Z5Liq5Zyw5pa55Zyo5o6n5Yi25Y+w5oql6ZSZ77yM55SoQ0RO5Zyw5Z2A5pCe5LiA5Liq55So5oi35aS05YOP5Lmf6K645Y+v5Lul6Kej5YazDQogICAgICAgIGFpQXZhdGFyOiAnaHR0cDovL2ZpbGUubHh4bm8uY24vMjAyNXhzemh3ei9PMUNOMDFQZGE5bnExWURWMG1uWjMxSF8hITYwMDAwMDAwMDMwMjUtNTQtdHBzLTEyMC0xMjAuYXBuZycsDQogICAgICAgIHNlc3Npb25JZDogbnVsbCwNCiAgICAgICAgYWJvcnRDb250cm9sbGVyOiBudWxsLA0KICAgICAgICBpc0Fib3J0ZWQ6IGZhbHNlLA0KICAgICAgICBjdXJyZW50UmVhZGVyOiBudWxsDQogICAgICB9DQogICAgfSwNCiAgICBtZXRob2RzOiB7DQogICAgICBhc3luYyBzZW5kTWVzc2FnZSgpIHsNCiAgICAgICAgaWYgKHRoaXMubG9hZGluZykgew0KICAgICAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOw0KICAgICAgICAgIHRoaXMuaXNBYm9ydGVkID0gdHJ1ZTsNCiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UmVhZGVyKSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLmN1cnJlbnRSZWFkZXIuY2FuY2VsKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICANCiAgICAgICAgaWYgKCF0aGlzLmlucHV0TWVzc2FnZS50cmltKCkpIHJldHVybjsNCiAgDQogICAgICAgIHRyeSB7DQogICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsNCiAgICAgICAgICB0aGlzLmlzQWJvcnRlZCA9IGZhbHNlOw0KICAgICAgICAgIHRoaXMubWVzc2FnZXMucHVzaCh7IHJvbGU6ICd1c2VyJywgY29udGVudDogdGhpcy5pbnB1dE1lc3NhZ2UgfSk7DQogIA0KICAgICAgICAgIGNvbnN0IGFwaUtleSA9ICdzay04ZGNiN2M3YjhhMDU0Y2I4OTA0Y2E3ZWNhNThkYWU2Mic7DQogICAgICAgICAgY29uc3QgYXBwSWQgPSAnNzk5MWJmOGU1ZGVmNDJjMWIyZjc4ZjIxYjczNzg1NTMnOw0KICAgICAgICAgIGNvbnN0IHVybCA9IGBodHRwczovL2Rhc2hzY29wZS5hbGl5dW5jcy5jb20vYXBpL3YxL2FwcHMvJHthcHBJZH0vY29tcGxldGlvbmA7DQogIA0KICAgICAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOw0KICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7DQogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YXBpS2V5fWAsDQogICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsDQogICAgICAgICAgICAgICdYLURhc2hTY29wZS1TU0UnOiAnZW5hYmxlJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgICAgaW5wdXQ6IHsNCiAgICAgICAgICAgICAgICBwcm9tcHQ6IHRoaXMuaW5wdXRNZXNzYWdlLnRyaW0oKSwNCiAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgcGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICdpbmNyZW1lbnRhbF9vdXRwdXQnOiAndHJ1ZScNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgZGVidWc6IHt9DQogICAgICAgICAgICB9KSwNCiAgICAgICAgICAgIHNpZ25hbDogdGhpcy5hYm9ydENvbnRyb2xsZXIuc2lnbmFsDQogICAgICAgICAgfSk7DQogIA0KICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsNCiAgDQogICAgICAgICAgbGV0IGZ1bGxSZXNwb25zZSA9ICcnOw0KICAgICAgICAgIGxldCBidWZmZXIgPSAnJzsNCiAgICAgICAgICBjb25zdCBhc3Npc3RhbnRNZXNzYWdlSW5kZXggPSB0aGlzLm1lc3NhZ2VzLnB1c2goew0KICAgICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsDQogICAgICAgICAgICBjb250ZW50OiAnJw0KICAgICAgICAgIH0pIC0gMTsNCiAgDQogICAgICAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsNCiAgICAgICAgICB0aGlzLmN1cnJlbnRSZWFkZXIgPSByZWFkZXI7DQogICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnKTsNCiAgDQogICAgICAgICAgY29uc3QgcHJvY2Vzc1N0cmVhbSA9IGFzeW5jICh7IGRvbmUsIHZhbHVlIH0pID0+IHsNCiAgICAgICAgICAgIGlmIChkb25lIHx8IHRoaXMuaXNBYm9ydGVkKSB7DQogICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogIA0KICAgICAgICAgICAgYnVmZmVyICs9IGRlY29kZXIuZGVjb2RlKHZhbHVlKTsNCiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gYnVmZmVyLnNwbGl0KCdcbicpOw0KICAgICAgICAgICAgYnVmZmVyID0gbGluZXMucG9wKCkgfHwgJyc7DQogIA0KICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7DQogICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ2RhdGE6JykpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnREYXRhID0gSlNPTi5wYXJzZShsaW5lLnNsaWNlKDUpLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgICBpZiAoZXZlbnREYXRhLm91dHB1dD8udGV4dCkgew0KICAgICAgICAgICAgICAgICAgICBmdWxsUmVzcG9uc2UgKz0gZXZlbnREYXRhLm91dHB1dC50ZXh0Ow0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5tZXNzYWdlcywgYXNzaXN0YW50TWVzc2FnZUluZGV4LCB7DQogICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5tZXNzYWdlc1thc3Npc3RhbnRNZXNzYWdlSW5kZXhdLA0KICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bGxSZXNwb25zZQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSBldmVudERhdGEub3V0cHV0LnNlc3Npb25faWQ7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign6Kej5p6Q6ZSZ6K+vOicsIGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICANCiAgICAgICAgICAgIHJlYWRlci5yZWFkKCkudGhlbihwcm9jZXNzU3RyZWFtKTsNCiAgICAgICAgICB9Ow0KICANCiAgICAgICAgICByZWFkZXIucmVhZCgpLnRoZW4ocHJvY2Vzc1N0cmVhbSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yLm5hbWUgIT09ICdBYm9ydEVycm9yJykgew0KICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmtYHor7vlj5bplJnor686JywgZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICANCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InICYmIHRoaXMuaXNBYm9ydGVkKSB7DQogICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogJ+W3suWPlua2iOeUn+aIkCcgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNhbGxpbmcgRGFzaFNjb3BlOiAke2Vycm9yLm1lc3NhZ2V9YCk7DQogICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogJ+ivt+axguWHuumUme+8jOivt+eojeWQjumHjeivlScgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyID0gbnVsbDsNCiAgICAgICAgICBpZiAoIXRoaXMuaXNBYm9ydGVkKSB7DQogICAgICAgICAgICB0aGlzLmlucHV0TWVzc2FnZSA9ICcnOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICA="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/service/AI","sourcesContent":["<template>\r\n  <!-- src/view/AI/index.vue -->\r\n\r\n      <div class=\"chat-container\">\r\n        <div>\r\n          <h2 style=\"text-align: center; margin: 20px 0;\">AI智能问答助手</h2>\r\n        </div>\r\n  \r\n        <!-- 聊天消息 -->\r\n        <div class=\"chat-messages\">\r\n          <div v-for=\"(msg, index) in messages\" :key=\"index\" :class=\"['message', msg.role]\">\r\n            <div class=\"avatar\">\r\n              <img :src=\"msg.role === 'user' ? userAvatar : aiAvatar\" alt=\"avatar\">\r\n            </div>\r\n            <div class=\"content\">{{ msg.content }}</div>\r\n          </div>\r\n          <div v-if=\"loading\" class=\"loading-indicator\">思考中...</div>\r\n        </div>\r\n    \r\n  \r\n        <!-- 少用点，测试一下，免费额度用完得扣钱 -->\r\n  \r\n  \r\n        <!-- 用户输入 -->\r\n        <div class=\"input-area\">\r\n          <input\r\n            v-model=\"inputMessage\"\r\n            @keyup.enter=\"sendMessage\"\r\n            placeholder=\"输入您的问题...\"\r\n            :disabled=\"loading\"\r\n          />\r\n          <button @click=\"sendMessage\" :disabled=\"!loading && !inputMessage\">\r\n            {{ loading ? '取消' : '发送' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n  </template>\r\n  \r\n  <!-- 支持多轮对话，目前模型DeepseekV3，联网搜索，单个页面可完成AI调用,无需后端-->\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        messages: [],\r\n        inputMessage: '',\r\n        loading: false,\r\n        // userAvatar: require('@/assets/image/user.png'), // 这个地方在控制台报错，用CDN地址搞一个用户头像也许可以解决\r\n        aiAvatar: 'http://file.lxxno.cn/2025xszhwz/O1CN01Pda9nq1YDV0mnZ31H_!!6000000003025-54-tps-120-120.apng',\r\n        sessionId: null,\r\n        abortController: null,\r\n        isAborted: false,\r\n        currentReader: null\r\n      }\r\n    },\r\n    methods: {\r\n      async sendMessage() {\r\n        if (this.loading) {\r\n          this.abortController?.abort();\r\n          this.isAborted = true;\r\n          if (this.currentReader) {\r\n            await this.currentReader.cancel();\r\n          }\r\n          return;\r\n        }\r\n  \r\n        if (!this.inputMessage.trim()) return;\r\n  \r\n        try {\r\n          this.loading = true;\r\n          this.isAborted = false;\r\n          this.messages.push({ role: 'user', content: this.inputMessage });\r\n  \r\n          const apiKey = 'sk-8dcb7c7b8a054cb8904ca7eca58dae62';\r\n          const appId = '7991bf8e5def42c1b2f78f21b7378553';\r\n          const url = `https://dashscope.aliyuncs.com/api/v1/apps/${appId}/completion`;\r\n  \r\n          this.abortController = new AbortController();\r\n          const response = await fetch(url, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Authorization': `Bearer ${apiKey}`,\r\n              'Content-Type': 'application/json',\r\n              'X-DashScope-SSE': 'enable'\r\n            },\r\n            body: JSON.stringify({\r\n              input: {\r\n                prompt: this.inputMessage.trim(),\r\n                session_id: this.sessionId,\r\n              },\r\n              parameters: {\r\n                'incremental_output': 'true'\r\n              },\r\n              debug: {}\r\n            }),\r\n            signal: this.abortController.signal\r\n          });\r\n  \r\n          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n  \r\n          let fullResponse = '';\r\n          let buffer = '';\r\n          const assistantMessageIndex = this.messages.push({\r\n            role: 'assistant',\r\n            content: ''\r\n          }) - 1;\r\n  \r\n          const reader = response.body.getReader();\r\n          this.currentReader = reader;\r\n          const decoder = new TextDecoder('utf-8');\r\n  \r\n          const processStream = async ({ done, value }) => {\r\n            if (done || this.isAborted) {\r\n              this.loading = false;\r\n              return;\r\n            }\r\n  \r\n            buffer += decoder.decode(value);\r\n            const lines = buffer.split('\\n');\r\n            buffer = lines.pop() || '';\r\n  \r\n            for (const line of lines) {\r\n              if (line.startsWith('data:')) {\r\n                try {\r\n                  const eventData = JSON.parse(line.slice(5).trim());\r\n                  if (eventData.output?.text) {\r\n                    fullResponse += eventData.output.text;\r\n                    this.$set(this.messages, assistantMessageIndex, {\r\n                      ...this.messages[assistantMessageIndex],\r\n                      content: fullResponse\r\n                    });\r\n                    this.sessionId = eventData.output.session_id;\r\n                  }\r\n                } catch (e) {\r\n                  console.error('解析错误:', e);\r\n                }\r\n              }\r\n            }\r\n  \r\n            reader.read().then(processStream);\r\n          };\r\n  \r\n          reader.read().then(processStream).catch(error => {\r\n            if (error.name !== 'AbortError') {\r\n              console.error('流读取错误:', error);\r\n            }\r\n          });\r\n  \r\n        } catch (error) {\r\n          this.loading = false;\r\n          if (error.name === 'AbortError' && this.isAborted) {\r\n            this.messages.push({ role: 'system', content: '已取消生成' });\r\n          } else {\r\n            console.error(`Error calling DashScope: ${error.message}`);\r\n            this.messages.push({ role: 'system', content: '请求出错，请稍后重试' });\r\n          }\r\n        } finally {\r\n          this.abortController = null;\r\n          if (!this.isAborted) {\r\n            this.inputMessage = '';\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n\r\n    .chat-container {\r\n      max-width: 1400px;\r\n      margin: 20px auto;\r\n      border: 1px solid #e4e7ed;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n    }\r\n    \r\n    .chat-messages {\r\n      height: 600px;\r\n      overflow-y: auto;\r\n      padding: 20px;\r\n      background: #f8f9fa;\r\n    }\r\n    \r\n    .message {\r\n      display: flex;\r\n      gap: 15px;\r\n      margin-bottom: 20px;\r\n    }\r\n    \r\n    .message.user {\r\n      flex-direction: row-reverse;\r\n    }\r\n    \r\n    .avatar img {\r\n      width: 40px;\r\n      height: 40px;\r\n      border-radius: 50%;\r\n    }\r\n    \r\n    .content {\r\n      max-width: 70%;\r\n      padding: 12px 16px;\r\n      border-radius: 12px;\r\n      background: white;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .message.assistant .content {\r\n      background: #1464E4;\r\n      color: white;\r\n    }\r\n    \r\n    .input-area {\r\n      display: flex;\r\n      padding: 20px;\r\n      background: white;\r\n      border-top: 1px solid #e4e7ed;\r\n    }\r\n    \r\n    input {\r\n      flex: 1;\r\n      padding: 12px;\r\n      border: 1px solid #e4e7ed;\r\n      border-radius: 6px;\r\n      margin-right: 10px;\r\n    }\r\n    \r\n    button {\r\n      padding: 12px 24px;\r\n      background: #1464E4;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n    }\r\n    \r\n    button:disabled {\r\n      background: #a0c0f0;\r\n      cursor: not-allowed;\r\n    }\r\n    \r\n    .loading-indicator {\r\n      text-align: center;\r\n      color: #666;\r\n      padding: 10px;\r\n    }\r\n  </style>"]}]}