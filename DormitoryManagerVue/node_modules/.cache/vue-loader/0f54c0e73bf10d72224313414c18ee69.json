{"remainingRequest":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\manage\\dayApplicationApproval\\index.vue?vue&type=style&index=0&id=2d4cd55f&prod&lang=css","dependencies":[{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\src\\views\\manage\\dayApplicationApproval\\index.vue","mtime":1743690156936},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1762330399953},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1762330418934},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1762330405156},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762330398085},{"path":"G:\\E\\学生宿舍信息管理系统\\xsxxpt\\DormitoryManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1762330415853}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtdGFibGUgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgbWluLWhlaWdodDogNDAwcHg7DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA6JA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/manage/dayApplicationApproval","sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <!-- 新增搜索表单 -->\r\n        <el-form :inline=\"true\" class=\"search-form\">\r\n            <el-form-item label=\"班级\">\r\n                <el-input v-model=\"searchClass\" placeholder=\"输入班级名称\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"姓名\">\r\n                <el-input v-model=\"searchName\" placeholder=\"输入学生姓名\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"学号\">\r\n                <el-input v-model=\"searchStudentNo\" placeholder=\"输入学生学号\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item>\r\n                <el-button type=\"primary\" @click=\"searchByClass\">按班级查</el-button>\r\n                <el-button type=\"success\" @click=\"searchByName\">按姓名查</el-button>\r\n                <el-button type=\"warning\" @click=\"searchByStudentNo\">按学号查</el-button>\r\n                <el-button type=\"info\" @click=\"searchApproved\">显示已通过</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n\r\n        <el-table :data=\"applications\" v-loading=\"loading\">\r\n            <el-table-column prop=\"studentName\" label=\"学生姓名\" width=\"120\"></el-table-column>\r\n            <el-table-column prop=\"className\" label=\"班级\" width=\"150\"></el-table-column>\r\n            <el-table-column prop=\"department\" label=\"院系\" width=\"150\"></el-table-column>\r\n            <el-table-column prop=\"phone\" label=\"联系电话\" width=\"120\"></el-table-column>\r\n            <el-table-column prop=\"startDate\" label=\"开始日期\" width=\"120\" :formatter=\"formatDate\"></el-table-column>\r\n            <el-table-column prop=\"endDate\" label=\"结束日期\" width=\"120\" :formatter=\"formatDate\"></el-table-column>\r\n            <el-table-column prop=\"reason\" label=\"请假原因\" min-width=\"200\"></el-table-column>\r\n            <el-table-column prop=\"counselorStatus\" label=\"审批状态\" width=\"100\">\r\n                <template #default=\"scope\">\r\n                    <el-tag :type=\"scope.row.counselorStatus === '待审核' ? 'warning' : 'success'\">\r\n                        {{ scope.row.counselorStatus }}\r\n                    </el-tag>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"操作\" width=\"120\">\r\n                <template #default=\"scope\">\r\n                    <el-button type=\"primary\" size=\"small\" @click=\"handleApprove(scope.row)\">审批通过</el-button>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { \r\n    getCounselorPendingApplications,\r\n    approveByCounselor,\r\n    getByClassName,\r\n    getByStudentName,\r\n    getByStudentNoAndStatus,\r\n    getApprovedApplications\r\n} from '@/api/leaveApplication'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            applications: [],\r\n            loading: false,\r\n            searchClass: '',\r\n            searchName: '',\r\n            searchStudentNo: ''\r\n        }\r\n    },\r\n    created() {\r\n        this.fetchPendingApplications()\r\n    },\r\n    methods: {\r\n        async fetchPendingApplications() {\r\n            this.loading = true\r\n            try {\r\n                const res = await getCounselorPendingApplications()\r\n                console.log('完整响应:', res)\r\n                \r\n                // 修改判断条件和数据路径\r\n                if (res?.statusCode === 200 && Array.isArray(res.data)) {\r\n                    this.applications = res.data\r\n                    console.log('处理后的数据:', this.applications)\r\n                } else {\r\n                    this.$message.error(res?.msg || '数据格式异常')  // 使用msg字段\r\n                }\r\n            } catch (error) {\r\n                console.error('请求异常:', error.response || error)\r\n                this.$message.error(error.message || '请求失败')\r\n            } finally {\r\n                this.loading = false\r\n            }\r\n        },\r\n        async handleApprove(row) {\r\n            try {\r\n                // 使用封装好的API方法\r\n                await approveByCounselor(row.applyId)\r\n                this.$message.success('审批成功')\r\n                // 刷新列表数据\r\n                await this.fetchPendingApplications()\r\n            } catch (error) {\r\n                console.error('审批失败:', error)\r\n                // 显示更详细的错误信息\r\n                this.$message.error(error.response?.data?.msg || '审批操作失败')\r\n            }\r\n        },\r\n                async searchByClass() {\r\n            if (!this.searchClass) {\r\n                this.$message.warning('请输入班级名称')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByClassName(this.searchClass))\r\n        },\r\n\r\n        async searchByName() {\r\n            if (!this.searchName) {\r\n                this.$message.warning('请输入学生姓名')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByStudentName(this.searchName))\r\n        },\r\n\r\n        async searchByStudentNo() {\r\n            if (!this.searchStudentNo) {\r\n                this.$message.warning('请输入学生学号')\r\n                return\r\n            }\r\n            await this.handleSearch(() => getByStudentNoAndStatus(this.searchStudentNo))\r\n        },\r\n                // 通用查询处理\r\n        async handleSearch(apiCall) {\r\n            this.loading = true\r\n            try {\r\n                const res = await apiCall()\r\n                if (res?.statusCode === 200 && Array.isArray(res.data)) {\r\n                    this.applications = res.data\r\n                } else {\r\n                    this.$message.error(res?.msg || '查询失败')\r\n                }\r\n            } catch (error) {\r\n                this.$message.error(error.message || '查询失败')\r\n            } finally {\r\n                this.loading = false\r\n            }\r\n        },\r\n    \r\n\r\n        async searchApproved() {\r\n            await this.handleSearch(getApprovedApplications)\r\n        },\r\n        formatDate(row, column, cellValue) {\r\n            if (cellValue) {\r\n                return new Date(cellValue).toLocaleDateString()\r\n            }\r\n            return ''\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.el-table {\r\n    margin-top: 20px;\r\n    min-height: 400px;\r\n}\r\n</style>"]}]}