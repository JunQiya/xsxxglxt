<<<<<<< HEAD
{"version":3,"file":"index.browser.mjs","sources":["../src/utils.ts","../src/imports-injector.ts","../src/debug-utils.ts","../src/normalize-options.ts","../src/visitors/usage.ts","../src/visitors/entry.ts","../src/browser/dependencies.ts","../src/meta-resolver.ts","../src/index.ts"],"sourcesContent":["import { types as t, template } from \"@babel/core\";\nimport type { NodePath } from \"@babel/traverse\";\nimport type { Utils } from \"./types\";\nimport type ImportsCachedInjector from \"./imports-injector\";\n\nexport function intersection<T>(a: Set<T>, b: Set<T>): Set<T> {\n  const result = new Set<T>();\n  a.forEach(v => b.has(v) && result.add(v));\n  return result;\n}\n\nexport function has(object: any, key: string) {\n  return Object.prototype.hasOwnProperty.call(object, key);\n}\n\nfunction resolve(\n  path: NodePath,\n  resolved: Set<NodePath> = new Set(),\n): NodePath | undefined {\n  if (resolved.has(path)) return;\n  resolved.add(path);\n\n  if (path.isVariableDeclarator()) {\n    if (path.get(\"id\").isIdentifier()) {\n      return resolve(path.get(\"init\"), resolved);\n    }\n  } else if (path.isReferencedIdentifier()) {\n    const binding = path.scope.getBinding(path.node.name);\n    if (!binding) return path;\n    if (!binding.constant) return;\n    return resolve(binding.path, resolved);\n  }\n  return path;\n}\n\nfunction resolveId(path: NodePath): string {\n  if (\n    path.isIdentifier() &&\n    !path.scope.hasBinding(path.node.name, /* noGlobals */ true)\n  ) {\n    return path.node.name;\n  }\n\n  const resolved = resolve(path);\n  if (resolved?.isIdentifier()) {\n    return resolved.node.name;\n  }\n}\n\nexport function resolveKey(\n  path: NodePath<t.Expression | t.PrivateName>,\n  computed: boolean = false,\n) {\n  const { scope } = path;\n  if (path.isStringLiteral()) return path.node.value;\n  const isIdentifier = path.isIdentifier();\n  if (\n    isIdentifier &&\n    !(computed || (path.parent as t.MemberExpression).computed)\n  ) {\n    return path.node.name;\n  }\n\n  if (\n    computed &&\n    path.isMemberExpression() &&\n    path.get(\"object\").isIdentifier({ name: \"Symbol\" }) &&\n    !scope.hasBinding(\"Symbol\", /* noGlobals */ true)\n  ) {\n    const sym = resolveKey(path.get(\"property\"), path.node.computed);\n    if (sym) return \"Symbol.\" + sym;\n  }\n\n  if (\n    isIdentifier\n      ? scope.hasBinding(path.node.name, /* noGlobals */ true)\n      : path.isPure()\n  ) {\n    const { value } = path.evaluate();\n    if (typeof value === \"string\") return value;\n  }\n}\n\nexport function resolveSource(obj: NodePath): {\n  id: string | null;\n  placement: \"prototype\" | \"static\" | null;\n} {\n  if (\n    obj.isMemberExpression() &&\n    obj.get(\"property\").isIdentifier({ name: \"prototype\" })\n  ) {\n    const id = resolveId(obj.get(\"object\"));\n\n    if (id) {\n      return { id, placement: \"prototype\" };\n    }\n    return { id: null, placement: null };\n  }\n\n  const id = resolveId(obj);\n  if (id) {\n    return { id, placement: \"static\" };\n  }\n\n  const path = resolve(obj);\n  switch (path?.type) {\n    case \"RegExpLiteral\":\n      return { id: \"RegExp\", placement: \"prototype\" };\n    case \"FunctionExpression\":\n      return { id: \"Function\", placement: \"prototype\" };\n    case \"StringLiteral\":\n      return { id: \"String\", placement: \"prototype\" };\n    case \"NumberLiteral\":\n      return { id: \"Number\", placement: \"prototype\" };\n    case \"BooleanLiteral\":\n      return { id: \"Boolean\", placement: \"prototype\" };\n    case \"ObjectExpression\":\n      return { id: \"Object\", placement: \"prototype\" };\n    case \"ArrayExpression\":\n      return { id: \"Array\", placement: \"prototype\" };\n  }\n\n  return { id: null, placement: null };\n}\n\nexport function getImportSource({ node }: NodePath<t.ImportDeclaration>) {\n  if (node.specifiers.length === 0) return node.source.value;\n}\n\nexport function getRequireSource({ node }: NodePath<t.Statement>) {\n  if (!t.isExpressionStatement(node)) return;\n  const { expression } = node;\n  if (\n    t.isCallExpression(expression) &&\n    t.isIdentifier(expression.callee) &&\n    expression.callee.name === \"require\" &&\n    expression.arguments.length === 1 &&\n    t.isStringLiteral(expression.arguments[0])\n  ) {\n    return expression.arguments[0].value;\n  }\n}\n\nfunction hoist<T extends t.Node>(node: T): T {\n  // @ts-expect-error\n  node._blockHoist = 3;\n  return node;\n}\n\nexport function createUtilsGetter(cache: ImportsCachedInjector) {\n  return (path: NodePath): Utils => {\n    const prog = path.findParent(p => p.isProgram()) as NodePath<t.Program>;\n\n    return {\n      injectGlobalImport(url, moduleName) {\n        cache.storeAnonymous(prog, url, moduleName, (isScript, source) => {\n          return isScript\n            ? template.statement.ast`require(${source})`\n            : t.importDeclaration([], source);\n        });\n      },\n      injectNamedImport(url, name, hint = name, moduleName) {\n        return cache.storeNamed(\n          prog,\n          url,\n          name,\n          moduleName,\n          (isScript, source, name) => {\n            const id = prog.scope.generateUidIdentifier(hint);\n            return {\n              node: isScript\n                ? hoist(template.statement.ast`\n                  var ${id} = require(${source}).${name}\n                `)\n                : t.importDeclaration([t.importSpecifier(id, name)], source),\n              name: id.name,\n            };\n          },\n        );\n      },\n      injectDefaultImport(url, hint = url, moduleName) {\n        return cache.storeNamed(\n          prog,\n          url,\n          \"default\",\n          moduleName,\n          (isScript, source) => {\n            const id = prog.scope.generateUidIdentifier(hint);\n            return {\n              node: isScript\n                ? hoist(template.statement.ast`var ${id} = require(${source})`)\n                : t.importDeclaration([t.importDefaultSpecifier(id)], source),\n              name: id.name,\n            };\n          },\n        );\n      },\n    };\n  };\n}\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\n\ntype StrMap<K> = Map<string, K>;\n\nexport default class ImportsCachedInjector {\n  _imports: WeakMap<NodePath<t.Program>, StrMap<string>>;\n  _anonymousImports: WeakMap<NodePath<t.Program>, Set<string>>;\n  _lastImports: WeakMap<\n    NodePath<t.Program>,\n    Array<{ path: NodePath<t.Node>; index: number }>\n  >;\n  _resolver: (url: string) => string;\n  _getPreferredIndex: (url: string) => number;\n\n  constructor(\n    resolver: (url: string) => string,\n    getPreferredIndex: (url: string) => number,\n  ) {\n    this._imports = new WeakMap();\n    this._anonymousImports = new WeakMap();\n    this._lastImports = new WeakMap();\n    this._resolver = resolver;\n    this._getPreferredIndex = getPreferredIndex;\n  }\n\n  storeAnonymous(\n    programPath: NodePath<t.Program>,\n    url: string,\n    moduleName: string,\n    getVal: (\n      isScript: boolean,\n      source: t.StringLiteral,\n    ) => t.Statement | t.Declaration,\n  ) {\n    const key = this._normalizeKey(programPath, url);\n    const imports = this._ensure<Set<string>>(\n      this._anonymousImports,\n      programPath,\n      Set,\n    );\n\n    if (imports.has(key)) return;\n\n    const node = getVal(\n      programPath.node.sourceType === \"script\",\n      t.stringLiteral(this._resolver(url)),\n    );\n    imports.add(key);\n    this._injectImport(programPath, node, moduleName);\n  }\n\n  storeNamed(\n    programPath: NodePath<t.Program>,\n    url: string,\n    name: string,\n    moduleName: string,\n    getVal: (\n      isScript: boolean,\n      // eslint-disable-next-line no-undef\n      source: t.StringLiteral,\n      // eslint-disable-next-line no-undef\n      name: t.Identifier,\n    ) => { node: t.Statement | t.Declaration; name: string },\n  ) {\n    const key = this._normalizeKey(programPath, url, name);\n    const imports = this._ensure<Map<string, any>>(\n      this._imports,\n      programPath,\n      Map,\n    );\n\n    if (!imports.has(key)) {\n      const { node, name: id } = getVal(\n        programPath.node.sourceType === \"script\",\n        t.stringLiteral(this._resolver(url)),\n        t.identifier(name),\n      );\n      imports.set(key, id);\n      this._injectImport(programPath, node, moduleName);\n    }\n\n    return t.identifier(imports.get(key));\n  }\n\n  _injectImport(\n    programPath: NodePath<t.Program>,\n    node: t.Statement | t.Declaration,\n    moduleName: string,\n  ) {\n    const newIndex = this._getPreferredIndex(moduleName);\n    const lastImports = this._lastImports.get(programPath) ?? [];\n\n    const isPathStillValid = (path: NodePath) =>\n      path.node &&\n      // Sometimes the AST is modified and the \"last import\"\n      // we have has been replaced\n      path.parent === programPath.node &&\n      path.container === programPath.node.body;\n\n    let last: NodePath;\n\n    if (newIndex === Infinity) {\n      // Fast path: we can always just insert at the end if newIndex is `Infinity`\n      if (lastImports.length > 0) {\n        last = lastImports[lastImports.length - 1].path;\n        if (!isPathStillValid(last)) last = undefined;\n      }\n    } else {\n      for (const [i, data] of lastImports.entries()) {\n        const { path, index } = data;\n        if (isPathStillValid(path)) {\n          if (newIndex < index) {\n            const [newPath] = path.insertBefore(node);\n            lastImports.splice(i, 0, { path: newPath, index: newIndex });\n            return;\n          }\n          last = path;\n        }\n      }\n    }\n\n    if (last) {\n      const [newPath] = last.insertAfter(node);\n      lastImports.push({ path: newPath, index: newIndex });\n    } else {\n      const [newPath] = programPath.unshiftContainer(\"body\", [node]);\n      this._lastImports.set(programPath, [{ path: newPath, index: newIndex }]);\n    }\n  }\n\n  _ensure<C extends Map<string, any> | Set<string>>(\n    map: WeakMap<NodePath<t.Program>, C>,\n    programPath: NodePath<t.Program>,\n    Collection: { new (...args: any): C },\n  ): C {\n    let collection = map.get(programPath);\n    if (!collection) {\n      collection = new Collection();\n      map.set(programPath, collection);\n    }\n    return collection;\n  }\n\n  _normalizeKey(\n    programPath: NodePath<t.Program>,\n    url: string,\n    name: string = \"\",\n  ): string {\n    const { sourceType } = programPath.node;\n\n    // If we rely on the imported binding (the \"name\" parameter), we also need to cache\n    // based on the sourceType. This is because the module transforms change the names\n    // of the import variables.\n    return `${name && sourceType}::${url}::${name}`;\n  }\n}\n","import { prettifyTargets } from \"@babel/helper-compilation-targets\";\n\nimport type { Targets } from \"./types\";\n\nexport const presetEnvSilentDebugHeader =\n  \"#__secret_key__@babel/preset-env__don't_log_debug_header_and_resolved_targets\";\n\nexport function stringifyTargetsMultiline(targets: Targets): string {\n  return JSON.stringify(prettifyTargets(targets), null, 2);\n}\n\nexport function stringifyTargets(targets: Targets): string {\n  return JSON.stringify(targets)\n    .replace(/,/g, \", \")\n    .replace(/^\\{\"/, '{ \"')\n    .replace(/\"\\}$/, '\" }');\n}\n","import { intersection } from \"./utils\";\nimport type {\n  Pattern,\n  PluginOptions,\n  MissingDependenciesOption,\n} from \"./types\";\n\nfunction patternToRegExp(pattern: Pattern): RegExp | null {\n  if (pattern instanceof RegExp) return pattern;\n\n  try {\n    return new RegExp(`^${pattern}$`);\n  } catch {\n    return null;\n  }\n}\n\nfunction buildUnusedError(label, unused) {\n  if (!unused.length) return \"\";\n  return (\n    `  - The following \"${label}\" patterns didn't match any polyfill:\\n` +\n    unused.map(original => `    ${String(original)}\\n`).join(\"\")\n  );\n}\n\nfunction buldDuplicatesError(duplicates) {\n  if (!duplicates.size) return \"\";\n  return (\n    `  - The following polyfills were matched both by \"include\" and \"exclude\" patterns:\\n` +\n    Array.from(duplicates, name => `    ${name}\\n`).join(\"\")\n  );\n}\n\nexport function validateIncludeExclude(\n  provider: string,\n  polyfills: Map<string, unknown>,\n  includePatterns: Pattern[],\n  excludePatterns: Pattern[],\n) {\n  let current;\n  const filter = pattern => {\n    const regexp = patternToRegExp(pattern);\n    if (!regexp) return false;\n\n    let matched = false;\n    for (const polyfill of polyfills.keys()) {\n      if (regexp.test(polyfill)) {\n        matched = true;\n        current.add(polyfill);\n      }\n    }\n    return !matched;\n  };\n\n  // prettier-ignore\n  const include = current = new Set<string> ();\n  const unusedInclude = Array.from(includePatterns).filter(filter);\n\n  // prettier-ignore\n  const exclude = current = new Set<string> ();\n  const unusedExclude = Array.from(excludePatterns).filter(filter);\n\n  const duplicates = intersection(include, exclude);\n\n  if (\n    duplicates.size > 0 ||\n    unusedInclude.length > 0 ||\n    unusedExclude.length > 0\n  ) {\n    throw new Error(\n      `Error while validating the \"${provider}\" provider options:\\n` +\n        buildUnusedError(\"include\", unusedInclude) +\n        buildUnusedError(\"exclude\", unusedExclude) +\n        buldDuplicatesError(duplicates),\n    );\n  }\n\n  return { include, exclude };\n}\n\nexport function applyMissingDependenciesDefaults(\n  options: PluginOptions,\n  babelApi: any,\n): MissingDependenciesOption {\n  const { missingDependencies = {} } = options;\n  if (missingDependencies === false) return false;\n\n  const caller = babelApi.caller(caller => caller?.name);\n\n  const {\n    log = \"deferred\",\n    inject = caller === \"rollup-plugin-babel\" ? \"throw\" : \"import\",\n    all = false,\n  } = missingDependencies;\n\n  return { log, inject, all };\n}\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\nimport type { CallProvider } from \"./index\";\n\nimport { resolveKey, resolveSource } from \"../utils\";\n\nfunction isRemoved(path: NodePath) {\n  if (path.removed) return true;\n  if (!path.parentPath) return false;\n  if (path.listKey) {\n    if (!path.parentPath.node?.[path.listKey]?.includes(path.node)) return true;\n  } else {\n    if (path.parentPath.node?.[path.key] !== path.node) return true;\n  }\n  return isRemoved(path.parentPath);\n}\n\nexport default (callProvider: CallProvider) => {\n  function property(object, key, placement, path) {\n    return callProvider({ kind: \"property\", object, key, placement }, path);\n  }\n\n  function handleReferencedIdentifier(path) {\n    const {\n      node: { name },\n      scope,\n    } = path;\n    if (scope.getBindingIdentifier(name)) return;\n\n    callProvider({ kind: \"global\", name }, path);\n  }\n\n  function analyzeMemberExpression(\n    path: NodePath<t.MemberExpression | t.OptionalMemberExpression>,\n  ) {\n    const key = resolveKey(path.get(\"property\"), path.node.computed);\n    return { key, handleAsMemberExpression: !!key && key !== \"prototype\" };\n  }\n\n  return {\n    // Symbol(), new Promise\n    ReferencedIdentifier(path: NodePath<t.Identifier>) {\n      const { parentPath } = path;\n      if (\n        parentPath.isMemberExpression({ object: path.node }) &&\n        analyzeMemberExpression(parentPath).handleAsMemberExpression\n      ) {\n        return;\n      }\n      handleReferencedIdentifier(path);\n    },\n\n    \"MemberExpression|OptionalMemberExpression\"(\n      path: NodePath<t.MemberExpression | t.OptionalMemberExpression>,\n    ) {\n      const { key, handleAsMemberExpression } = analyzeMemberExpression(path);\n      if (!handleAsMemberExpression) return;\n\n      const object = path.get(\"object\");\n      let objectIsGlobalIdentifier = object.isIdentifier();\n      if (objectIsGlobalIdentifier) {\n        const binding = object.scope.getBinding(\n          (object.node as t.Identifier).name,\n        );\n        if (binding) {\n          if (binding.path.isImportNamespaceSpecifier()) return;\n          objectIsGlobalIdentifier = false;\n        }\n      }\n\n      const source = resolveSource(object);\n      let skipObject = property(source.id, key, source.placement, path);\n      skipObject ||=\n        !objectIsGlobalIdentifier ||\n        path.shouldSkip ||\n        object.shouldSkip ||\n        isRemoved(object);\n\n      if (!skipObject) handleReferencedIdentifier(object);\n    },\n\n    ObjectPattern(path: NodePath<t.ObjectPattern>) {\n      const { parentPath, parent } = path;\n      let obj;\n\n      // const { keys, values } = Object\n      if (parentPath.isVariableDeclarator()) {\n        obj = parentPath.get(\"init\");\n        // ({ keys, values } = Object)\n      } else if (parentPath.isAssignmentExpression()) {\n        obj = parentPath.get(\"right\");\n        // !function ({ keys, values }) {...} (Object)\n        // resolution does not work after properties transform :-(\n      } else if (parentPath.isFunction()) {\n        const grand = parentPath.parentPath;\n        if (grand.isCallExpression() || grand.isNewExpression()) {\n          if (grand.node.callee === parent) {\n            obj = grand.get(\"arguments\")[path.key];\n          }\n        }\n      }\n\n      let id = null;\n      let placement = null;\n      if (obj) ({ id, placement } = resolveSource(obj));\n\n      for (const prop of path.get(\"properties\")) {\n        if (prop.isObjectProperty()) {\n          const key = resolveKey(prop.get(\"key\"));\n          if (key) property(id, key, placement, prop);\n        }\n      }\n    },\n\n    BinaryExpression(path: NodePath<t.BinaryExpression>) {\n      if (path.node.operator !== \"in\") return;\n\n      const source = resolveSource(path.get(\"right\"));\n      const key = resolveKey(path.get(\"left\"), true);\n\n      if (!key) return;\n\n      callProvider(\n        {\n          kind: \"in\",\n          object: source.id,\n          key,\n          placement: source.placement,\n        },\n        path,\n      );\n    },\n  };\n};\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\nimport type { CallProvider } from \"./index\";\n\nimport { getImportSource, getRequireSource } from \"../utils\";\n\nexport default (callProvider: CallProvider) => ({\n  ImportDeclaration(path: NodePath<t.ImportDeclaration>) {\n    const source = getImportSource(path);\n    if (!source) return;\n    callProvider({ kind: \"import\", source }, path);\n  },\n  Program(path: NodePath<t.Program>) {\n    path.get(\"body\").forEach(bodyPath => {\n      const source = getRequireSource(bodyPath);\n      if (!source) return;\n      callProvider({ kind: \"import\", source }, bodyPath);\n    });\n  },\n});\n","export function resolve(\n  dirname: string,\n  moduleName: string,\n  absoluteImports: boolean | string,\n): string {\n  if (absoluteImports === false) return moduleName;\n\n  throw new Error(\n    `\"absoluteImports\" is not supported in bundles prepared for the browser.`,\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function has(basedir: string, name: string) {\n  return true;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function logMissing(missingDeps: Set<string>) {}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function laterLogMissing(missingDeps: Set<string>) {}\n","import type {\n  MetaDescriptor,\n  ResolverPolyfills,\n  ResolvedPolyfill,\n} from \"./types\";\n\nimport { has } from \"./utils\";\n\ntype ResolverFn<T> = (meta: MetaDescriptor) => void | ResolvedPolyfill<T>;\n\nconst PossibleGlobalObjects = new Set<string>([\n  \"global\",\n  \"globalThis\",\n  \"self\",\n  \"window\",\n]);\n\nexport default function createMetaResolver<T>(\n  polyfills: ResolverPolyfills<T>,\n): ResolverFn<T> {\n  const { static: staticP, instance: instanceP, global: globalP } = polyfills;\n\n  return meta => {\n    if (meta.kind === \"global\" && globalP && has(globalP, meta.name)) {\n      return { kind: \"global\", desc: globalP[meta.name], name: meta.name };\n    }\n\n    if (meta.kind === \"property\" || meta.kind === \"in\") {\n      const { placement, object, key } = meta;\n\n      if (object && placement === \"static\") {\n        if (globalP && PossibleGlobalObjects.has(object) && has(globalP, key)) {\n          return { kind: \"global\", desc: globalP[key], name: key };\n        }\n\n        if (staticP && has(staticP, object) && has(staticP[object], key)) {\n          return {\n            kind: \"static\",\n            desc: staticP[object][key],\n            name: `${object}$${key}`,\n          };\n        }\n      }\n\n      if (instanceP && has(instanceP, key)) {\n        return { kind: \"instance\", desc: instanceP[key], name: `${key}` };\n      }\n    }\n  };\n}\n","import { declare } from \"@babel/helper-plugin-utils\";\nimport type { NodePath } from \"@babel/traverse\";\n\nimport _getTargets, {\n  isRequired,\n  getInclusionReasons,\n} from \"@babel/helper-compilation-targets\";\nconst getTargets = _getTargets.default || _getTargets;\n\nimport { createUtilsGetter } from \"./utils\";\nimport ImportsCachedInjector from \"./imports-injector\";\nimport {\n  stringifyTargetsMultiline,\n  presetEnvSilentDebugHeader,\n} from \"./debug-utils\";\nimport {\n  validateIncludeExclude,\n  applyMissingDependenciesDefaults,\n} from \"./normalize-options\";\n\nimport type {\n  ProviderApi,\n  MethodString,\n  Targets,\n  MetaDescriptor,\n  PolyfillProvider,\n  PluginOptions,\n  ProviderOptions,\n} from \"./types\";\n\nimport * as v from \"./visitors\";\nimport * as deps from \"./node/dependencies\";\n\nimport createMetaResolver from \"./meta-resolver\";\n\nexport type { PolyfillProvider, MetaDescriptor, Utils, Targets } from \"./types\";\n\nfunction resolveOptions<Options>(\n  options: PluginOptions,\n  babelApi,\n): {\n  method: MethodString;\n  methodName: \"usageGlobal\" | \"entryGlobal\" | \"usagePure\";\n  targets: Targets;\n  debug: boolean | typeof presetEnvSilentDebugHeader;\n  shouldInjectPolyfill:\n    | ((name: string, shouldInject: boolean) => boolean)\n    | undefined;\n  providerOptions: ProviderOptions<Options>;\n  absoluteImports: string | boolean;\n} {\n  const {\n    method,\n    targets: targetsOption,\n    ignoreBrowserslistConfig,\n    configPath,\n    debug,\n    shouldInjectPolyfill,\n    absoluteImports,\n    ...providerOptions\n  } = options;\n\n  if (isEmpty(options)) {\n    throw new Error(\n      `\\\nThis plugin requires options, for example:\n    {\n      \"plugins\": [\n        [\"<plugin name>\", { method: \"usage-pure\" }]\n      ]\n    }\n\nSee more options at https://github.com/babel/babel-polyfills/blob/main/docs/usage.md`,\n    );\n  }\n\n  let methodName;\n  if (method === \"usage-global\") methodName = \"usageGlobal\";\n  else if (method === \"entry-global\") methodName = \"entryGlobal\";\n  else if (method === \"usage-pure\") methodName = \"usagePure\";\n  else if (typeof method !== \"string\") {\n    throw new Error(\".method must be a string\");\n  } else {\n    throw new Error(\n      `.method must be one of \"entry-global\", \"usage-global\"` +\n        ` or \"usage-pure\" (received ${JSON.stringify(method)})`,\n    );\n  }\n\n  if (typeof shouldInjectPolyfill === \"function\") {\n    if (options.include || options.exclude) {\n      throw new Error(\n        `.include and .exclude are not supported when using the` +\n          ` .shouldInjectPolyfill function.`,\n      );\n    }\n  } else if (shouldInjectPolyfill != null) {\n    throw new Error(\n      `.shouldInjectPolyfill must be a function, or undefined` +\n        ` (received ${JSON.stringify(shouldInjectPolyfill)})`,\n    );\n  }\n\n  if (\n    absoluteImports != null &&\n    typeof absoluteImports !== \"boolean\" &&\n    typeof absoluteImports !== \"string\"\n  ) {\n    throw new Error(\n      `.absoluteImports must be a boolean, a string, or undefined` +\n        ` (received ${JSON.stringify(absoluteImports)})`,\n    );\n  }\n\n  let targets;\n\n  if (\n    // If any browserslist-related option is specified, fallback to the old\n    // behavior of not using the targets specified in the top-level options.\n    targetsOption ||\n    configPath ||\n    ignoreBrowserslistConfig\n  ) {\n    const targetsObj =\n      typeof targetsOption === \"string\" || Array.isArray(targetsOption)\n        ? { browsers: targetsOption }\n        : targetsOption;\n\n    targets = getTargets(targetsObj, {\n      ignoreBrowserslistConfig,\n      configPath,\n    });\n  } else {\n    targets = babelApi.targets();\n  }\n\n  return {\n    method,\n    methodName,\n    targets,\n    absoluteImports: absoluteImports ?? false,\n    shouldInjectPolyfill,\n    debug: !!debug,\n    providerOptions: providerOptions as any as ProviderOptions<Options>,\n  };\n}\n\nfunction instantiateProvider<Options>(\n  factory: PolyfillProvider<Options>,\n  options: PluginOptions,\n  missingDependencies,\n  dirname,\n  debugLog,\n  babelApi,\n) {\n  const {\n    method,\n    methodName,\n    targets,\n    debug,\n    shouldInjectPolyfill,\n    providerOptions,\n    absoluteImports,\n  } = resolveOptions<Options>(options, babelApi);\n\n  // eslint-disable-next-line prefer-const\n  let include, exclude;\n  let polyfillsSupport;\n  let polyfillsNames: Map<string, number> | undefined;\n  let filterPolyfills;\n\n  const getUtils = createUtilsGetter(\n    new ImportsCachedInjector(\n      moduleName => deps.resolve(dirname, moduleName, absoluteImports),\n      (name: string) => polyfillsNames?.get(name) ?? Infinity,\n    ),\n  );\n\n  const depsCache = new Map();\n\n  const api: ProviderApi = {\n    babel: babelApi,\n    getUtils,\n    method: options.method,\n    targets,\n    createMetaResolver,\n    shouldInjectPolyfill(name) {\n      if (polyfillsNames === undefined) {\n        throw new Error(\n          `Internal error in the ${factory.name} provider: ` +\n            `shouldInjectPolyfill() can't be called during initialization.`,\n        );\n      }\n      if (!polyfillsNames.has(name)) {\n        console.warn(\n          `Internal error in the ${providerName} provider: ` +\n            `unknown polyfill \"${name}\".`,\n        );\n      }\n\n      if (filterPolyfills && !filterPolyfills(name)) return false;\n\n      let shouldInject = isRequired(name, targets, {\n        compatData: polyfillsSupport,\n        includes: include,\n        excludes: exclude,\n      });\n\n      if (shouldInjectPolyfill) {\n        shouldInject = shouldInjectPolyfill(name, shouldInject);\n        if (typeof shouldInject !== \"boolean\") {\n          throw new Error(`.shouldInjectPolyfill must return a boolean.`);\n        }\n      }\n\n      return shouldInject;\n    },\n    debug(name) {\n      debugLog().found = true;\n\n      if (!debug || !name) return;\n\n      if (debugLog().polyfills.has(providerName)) return;\n      debugLog().polyfills.add(name);\n      debugLog().polyfillsSupport ??= polyfillsSupport;\n    },\n    assertDependency(name, version = \"*\") {\n      if (missingDependencies === false) return;\n      if (absoluteImports) {\n        // If absoluteImports is not false, we will try resolving\n        // the dependency and throw if it's not possible. We can\n        // skip the check here.\n        return;\n      }\n\n      const dep = version === \"*\" ? name : `${name}@^${version}`;\n\n      const found = missingDependencies.all\n        ? false\n        : mapGetOr(depsCache, `${name} :: ${dirname}`, () =>\n            deps.has(dirname, name),\n          );\n\n      if (!found) {\n        debugLog().missingDeps.add(dep);\n      }\n    },\n  };\n\n  const provider = factory(api, providerOptions, dirname);\n  const providerName = provider.name || factory.name;\n\n  if (typeof provider[methodName] !== \"function\") {\n    throw new Error(\n      `The \"${providerName}\" provider doesn't support the \"${method}\" polyfilling method.`,\n    );\n  }\n\n  if (Array.isArray(provider.polyfills)) {\n    polyfillsNames = new Map(\n      provider.polyfills.map((name, index) => [name, index]),\n    );\n    filterPolyfills = provider.filterPolyfills;\n  } else if (provider.polyfills) {\n    polyfillsNames = new Map(\n      Object.keys(provider.polyfills).map((name, index) => [name, index]),\n    );\n    polyfillsSupport = provider.polyfills;\n    filterPolyfills = provider.filterPolyfills;\n  } else {\n    polyfillsNames = new Map();\n  }\n\n  ({ include, exclude } = validateIncludeExclude(\n    providerName,\n    polyfillsNames,\n    providerOptions.include || [],\n    providerOptions.exclude || [],\n  ));\n\n  let callProvider: (payload: MetaDescriptor, path: NodePath) => boolean;\n  if (methodName === \"usageGlobal\") {\n    callProvider = (payload, path) => {\n      const utils = getUtils(path);\n      return (\n        (provider[methodName](payload, utils, path) satisfies boolean) ?? false\n      );\n    };\n  } else {\n    callProvider = (payload, path) => {\n      const utils = getUtils(path);\n      provider[methodName](payload, utils, path) satisfies void;\n      return false;\n    };\n  }\n\n  return {\n    debug,\n    method,\n    targets,\n    provider,\n    providerName,\n    callProvider,\n  };\n}\n\nexport default function definePolyfillProvider<Options>(\n  factory: PolyfillProvider<Options>,\n) {\n  return declare((babelApi, options: PluginOptions, dirname: string) => {\n    babelApi.assertVersion(\"^7.0.0 || ^8.0.0-alpha.0\");\n    const { traverse } = babelApi;\n\n    let debugLog;\n\n    const missingDependencies = applyMissingDependenciesDefaults(\n      options,\n      babelApi,\n    );\n\n    const { debug, method, targets, provider, providerName, callProvider } =\n      instantiateProvider<Options>(\n        factory,\n        options,\n        missingDependencies,\n        dirname,\n        () => debugLog,\n        babelApi,\n      );\n\n    const createVisitor = method === \"entry-global\" ? v.entry : v.usage;\n\n    const visitor = provider.visitor\n      ? traverse.visitors.merge([createVisitor(callProvider), provider.visitor])\n      : createVisitor(callProvider);\n\n    if (debug && debug !== presetEnvSilentDebugHeader) {\n      console.log(`${providerName}: \\`DEBUG\\` option`);\n      console.log(`\\nUsing targets: ${stringifyTargetsMultiline(targets)}`);\n      console.log(`\\nUsing polyfills with \\`${method}\\` method:`);\n    }\n\n    const { runtimeName } = provider;\n\n    return {\n      name: \"inject-polyfills\",\n      visitor,\n\n      pre(file) {\n        if (runtimeName) {\n          if (\n            file.get(\"runtimeHelpersModuleName\") &&\n            file.get(\"runtimeHelpersModuleName\") !== runtimeName\n          ) {\n            console.warn(\n              `Two different polyfill providers` +\n                ` (${file.get(\"runtimeHelpersModuleProvider\")}` +\n                ` and ${providerName}) are trying to define two` +\n                ` conflicting @babel/runtime alternatives:` +\n                ` ${file.get(\"runtimeHelpersModuleName\")} and ${runtimeName}.` +\n                ` The second one will be ignored.`,\n            );\n          } else {\n            file.set(\"runtimeHelpersModuleName\", runtimeName);\n            file.set(\"runtimeHelpersModuleProvider\", providerName);\n          }\n        }\n\n        debugLog = {\n          polyfills: new Set(),\n          polyfillsSupport: undefined,\n          found: false,\n          providers: new Set(),\n          missingDeps: new Set(),\n        };\n\n        provider.pre?.apply(this, arguments);\n      },\n      post() {\n        provider.post?.apply(this, arguments);\n\n        if (missingDependencies !== false) {\n          if (missingDependencies.log === \"per-file\") {\n            deps.logMissing(debugLog.missingDeps);\n          } else {\n            deps.laterLogMissing(debugLog.missingDeps);\n          }\n        }\n\n        if (!debug) return;\n\n        if (this.filename) console.log(`\\n[${this.filename}]`);\n\n        if (debugLog.polyfills.size === 0) {\n          console.log(\n            method === \"entry-global\"\n              ? debugLog.found\n                ? `Based on your targets, the ${providerName} polyfill did not add any polyfill.`\n                : `The entry point for the ${providerName} polyfill has not been found.`\n              : `Based on your code and targets, the ${providerName} polyfill did not add any polyfill.`,\n          );\n\n          return;\n        }\n\n        if (method === \"entry-global\") {\n          console.log(\n            `The ${providerName} polyfill entry has been replaced with ` +\n              `the following polyfills:`,\n          );\n        } else {\n          console.log(\n            `The ${providerName} polyfill added the following polyfills:`,\n          );\n        }\n\n        for (const name of debugLog.polyfills) {\n          if (debugLog.polyfillsSupport?.[name]) {\n            const filteredTargets = getInclusionReasons(\n              name,\n              targets,\n              debugLog.polyfillsSupport,\n            );\n\n            const formattedTargets = JSON.stringify(filteredTargets)\n              .replace(/,/g, \", \")\n              .replace(/^\\{\"/, '{ \"')\n              .replace(/\"\\}$/, '\" }');\n\n            console.log(`  ${name} ${formattedTargets}`);\n          } else {\n            console.log(`  ${name}`);\n          }\n        }\n      },\n    };\n  });\n}\n\nfunction mapGetOr(map, key, getDefault) {\n  let val = map.get(key);\n  if (val === undefined) {\n    val = getDefault();\n    map.set(key, val);\n  }\n  return val;\n}\n\nfunction isEmpty(obj) {\n  return Object.keys(obj).length === 0;\n}\n"],"names":["types","t","template","_babel","default","intersection","a","b","result","Set","forEach","v","has","add","object","key","Object","prototype","hasOwnProperty","call","resolve","path","resolved","isVariableDeclarator","get","isIdentifier","isReferencedIdentifier","binding","scope","getBinding","node","name","constant","resolveId","hasBinding","resolveKey","computed","isStringLiteral","value","parent","isMemberExpression","sym","isPure","evaluate","resolveSource","obj","id","placement","type","getImportSource","specifiers","length","source","getRequireSource","isExpressionStatement","expression","isCallExpression","callee","arguments","hoist","_blockHoist","createUtilsGetter","cache","prog","findParent","p","isProgram","injectGlobalImport","url","moduleName","storeAnonymous","isScript","statement","ast","importDeclaration","injectNamedImport","hint","storeNamed","generateUidIdentifier","importSpecifier","injectDefaultImport","importDefaultSpecifier","ImportsCachedInjector","constructor","resolver","getPreferredIndex","_imports","WeakMap","_anonymousImports","_lastImports","_resolver","_getPreferredIndex","programPath","getVal","_normalizeKey","imports","_ensure","sourceType","stringLiteral","_injectImport","Map","identifier","set","_this$_lastImports$ge","newIndex","lastImports","isPathStillValid","container","body","last","Infinity","undefined","i","data","entries","index","newPath","insertBefore","splice","insertAfter","push","unshiftContainer","map","Collection","collection","presetEnvSilentDebugHeader","stringifyTargetsMultiline","targets","JSON","stringify","prettifyTargets","patternToRegExp","pattern","RegExp","buildUnusedError","label","unused","original","String","join","buldDuplicatesError","duplicates","size","Array","from","validateIncludeExclude","provider","polyfills","includePatterns","excludePatterns","current","filter","regexp","matched","polyfill","keys","test","include","unusedInclude","exclude","unusedExclude","Error","applyMissingDependenciesDefaults","options","babelApi","missingDependencies","caller","log","inject","all","isRemoved","removed","parentPath","listKey","_path$parentPath$node","includes","_path$parentPath$node2","callProvider","property","kind","handleReferencedIdentifier","getBindingIdentifier","analyzeMemberExpression","handleAsMemberExpression","ReferencedIdentifier","MemberExpression|OptionalMemberExpression","objectIsGlobalIdentifier","isImportNamespaceSpecifier","skipObject","shouldSkip","ObjectPattern","isAssignmentExpression","isFunction","grand","isNewExpression","prop","isObjectProperty","BinaryExpression","operator","ImportDeclaration","Program","bodyPath","dirname","absoluteImports","basedir","logMissing","missingDeps","laterLogMissing","PossibleGlobalObjects","createMetaResolver","static","staticP","instance","instanceP","global","globalP","meta","desc","getTargets","_getTargets","resolveOptions","method","targetsOption","ignoreBrowserslistConfig","configPath","debug","shouldInjectPolyfill","providerOptions","isEmpty","methodName","targetsObj","isArray","browsers","instantiateProvider","factory","debugLog","polyfillsSupport","polyfillsNames","filterPolyfills","getUtils","deps","_polyfillsNames$get","_polyfillsNames","depsCache","api","babel","console","warn","providerName","shouldInject","isRequired","compatData","excludes","_debugLog","_debugLog$polyfillsSu","found","assertDependency","version","dep","mapGetOr","payload","_ref","utils","definePolyfillProvider","declare","assertVersion","traverse","createVisitor","visitor","visitors","merge","runtimeName","pre","file","_provider$pre","providers","apply","post","_provider$post","filename","_debugLog$polyfillsSu2","filteredTargets","getInclusionReasons","formattedTargets","replace","getDefault","val"],"mappings":"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"}
=======
{"version":3,"file":"index.browser.mjs","sources":["../src/utils.ts","../src/imports-cache.ts","../src/debug-utils.ts","../src/normalize-options.ts","../src/visitors/usage.ts","../src/visitors/entry.ts","../src/browser/dependencies.ts","../src/meta-resolver.ts","../src/index.ts"],"sourcesContent":["import { types as t, template } from \"@babel/core\";\nimport type { NodePath } from \"@babel/traverse\";\nimport type { Utils } from \"./types\";\nimport type ImportsCache from \"./imports-cache\";\n\nexport function intersection<T>(a: Set<T>, b: Set<T>): Set<T> {\n  const result = new Set<T>();\n  a.forEach(v => b.has(v) && result.add(v));\n  return result;\n}\n\nexport function has(object: any, key: string) {\n  return Object.prototype.hasOwnProperty.call(object, key);\n}\n\nfunction getType(target: any): string {\n  return Object.prototype.toString.call(target).slice(8, -1);\n}\n\nfunction resolveId(path): string {\n  if (\n    path.isIdentifier() &&\n    !path.scope.hasBinding(path.node.name, /* noGlobals */ true)\n  ) {\n    return path.node.name;\n  }\n\n  const { deopt } = path.evaluate();\n  if (deopt && deopt.isIdentifier()) {\n    return deopt.node.name;\n  }\n}\n\nexport function resolveKey(\n  path: NodePath<t.Expression | t.PrivateName>,\n  computed: boolean = false,\n) {\n  const { scope } = path;\n  if (path.isStringLiteral()) return path.node.value;\n  const isIdentifier = path.isIdentifier();\n  if (\n    isIdentifier &&\n    !(computed || (path.parent as t.MemberExpression).computed)\n  ) {\n    return path.node.name;\n  }\n\n  if (\n    computed &&\n    path.isMemberExpression() &&\n    path.get(\"object\").isIdentifier({ name: \"Symbol\" }) &&\n    !scope.hasBinding(\"Symbol\", /* noGlobals */ true)\n  ) {\n    const sym = resolveKey(path.get(\"property\"), path.node.computed);\n    if (sym) return \"Symbol.\" + sym;\n  }\n\n  if (!isIdentifier || scope.hasBinding(path.node.name, /* noGlobals */ true)) {\n    const { value } = path.evaluate();\n    if (typeof value === \"string\") return value;\n  }\n}\n\nexport function resolveSource(obj: NodePath): {\n  id: string | null;\n  placement: \"prototype\" | \"static\" | null;\n} {\n  if (\n    obj.isMemberExpression() &&\n    obj.get(\"property\").isIdentifier({ name: \"prototype\" })\n  ) {\n    const id = resolveId(obj.get(\"object\"));\n\n    if (id) {\n      return { id, placement: \"prototype\" };\n    }\n    return { id: null, placement: null };\n  }\n\n  const id = resolveId(obj);\n  if (id) {\n    return { id, placement: \"static\" };\n  }\n\n  const { value } = obj.evaluate();\n  if (value !== undefined) {\n    return { id: getType(value), placement: \"prototype\" };\n  } else if (obj.isRegExpLiteral()) {\n    return { id: \"RegExp\", placement: \"prototype\" };\n  } else if (obj.isFunction()) {\n    return { id: \"Function\", placement: \"prototype\" };\n  }\n\n  return { id: null, placement: null };\n}\n\nexport function getImportSource({ node }: NodePath<t.ImportDeclaration>) {\n  if (node.specifiers.length === 0) return node.source.value;\n}\n\nexport function getRequireSource({ node }: NodePath<t.Statement>) {\n  if (!t.isExpressionStatement(node)) return;\n  const { expression } = node;\n  if (\n    t.isCallExpression(expression) &&\n    t.isIdentifier(expression.callee) &&\n    expression.callee.name === \"require\" &&\n    expression.arguments.length === 1 &&\n    t.isStringLiteral(expression.arguments[0])\n  ) {\n    return expression.arguments[0].value;\n  }\n}\n\nfunction hoist(node: t.Node) {\n  // @ts-expect-error\n  node._blockHoist = 3;\n  return node;\n}\n\nexport function createUtilsGetter(cache: ImportsCache) {\n  return (path: NodePath): Utils => {\n    const prog = path.findParent(p => p.isProgram()) as NodePath<t.Program>;\n\n    return {\n      injectGlobalImport(url) {\n        cache.storeAnonymous(prog, url, (isScript, source) => {\n          return isScript\n            ? template.statement.ast`require(${source})`\n            : t.importDeclaration([], source);\n        });\n      },\n      injectNamedImport(url, name, hint = name) {\n        return cache.storeNamed(prog, url, name, (isScript, source, name) => {\n          const id = prog.scope.generateUidIdentifier(hint);\n          return {\n            node: isScript\n              ? hoist(template.statement.ast`\n                  var ${id} = require(${source}).${name}\n                `)\n              : t.importDeclaration([t.importSpecifier(id, name)], source),\n            name: id.name,\n          };\n        });\n      },\n      injectDefaultImport(url, hint = url) {\n        return cache.storeNamed(prog, url, \"default\", (isScript, source) => {\n          const id = prog.scope.generateUidIdentifier(hint);\n          return {\n            node: isScript\n              ? hoist(template.statement.ast`var ${id} = require(${source})`)\n              : t.importDeclaration([t.importDefaultSpecifier(id)], source),\n            name: id.name,\n          };\n        });\n      },\n    };\n  };\n}\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\n\ntype StrMap<K> = Map<string, K>;\n\nexport default class ImportsCache {\n  _imports: WeakMap<NodePath<t.Program>, StrMap<string>>;\n  _anonymousImports: WeakMap<NodePath<t.Program>, Set<string>>;\n  _lastImports: WeakMap<NodePath<t.Program>, NodePath<t.Node>>;\n  _resolver: (url: string) => string;\n\n  constructor(resolver: (url: string) => string) {\n    this._imports = new WeakMap();\n    this._anonymousImports = new WeakMap();\n    this._lastImports = new WeakMap();\n    this._resolver = resolver;\n  }\n\n  storeAnonymous(\n    programPath: NodePath<t.Program>,\n    url: string,\n    // eslint-disable-next-line no-undef\n    getVal: (isScript: boolean, source: t.StringLiteral) => t.Node,\n  ) {\n    const key = this._normalizeKey(programPath, url);\n    const imports = this._ensure<Set<string>>(\n      this._anonymousImports,\n      programPath,\n      Set,\n    );\n\n    if (imports.has(key)) return;\n\n    const node = getVal(\n      programPath.node.sourceType === \"script\",\n      t.stringLiteral(this._resolver(url)),\n    );\n    imports.add(key);\n    this._injectImport(programPath, node);\n  }\n\n  storeNamed(\n    programPath: NodePath<t.Program>,\n    url: string,\n    name: string,\n    getVal: (\n      isScript: boolean,\n      // eslint-disable-next-line no-undef\n      source: t.StringLiteral,\n      // eslint-disable-next-line no-undef\n      name: t.Identifier,\n    ) => { node: t.Node; name: string },\n  ) {\n    const key = this._normalizeKey(programPath, url, name);\n    const imports = this._ensure<Map<string, any>>(\n      this._imports,\n      programPath,\n      Map,\n    );\n\n    if (!imports.has(key)) {\n      const { node, name: id } = getVal(\n        programPath.node.sourceType === \"script\",\n        t.stringLiteral(this._resolver(url)),\n        t.identifier(name),\n      );\n      imports.set(key, id);\n      this._injectImport(programPath, node);\n    }\n\n    return t.identifier(imports.get(key));\n  }\n\n  _injectImport(programPath: NodePath<t.Program>, node: t.Node) {\n    const lastImport = this._lastImports.get(programPath);\n    let newNodes: [NodePath];\n    if (\n      lastImport &&\n      lastImport.node &&\n      // Sometimes the AST is modified and the \"last import\"\n      // we have has been replaced\n      lastImport.parent === programPath.node &&\n      lastImport.container === programPath.node.body\n    ) {\n      newNodes = lastImport.insertAfter(node);\n    } else {\n      newNodes = programPath.unshiftContainer(\"body\", node);\n    }\n    const newNode = newNodes[newNodes.length - 1];\n    this._lastImports.set(programPath, newNode);\n\n    /*\n    let lastImport;\n\n    programPath.get(\"body\").forEach(path => {\n      if (path.isImportDeclaration()) lastImport = path;\n      if (\n        path.isExpressionStatement() &&\n        isRequireCall(path.get(\"expression\"))\n      ) {\n        lastImport = path;\n      }\n      if (\n        path.isVariableDeclaration() &&\n        path.get(\"declarations\").length === 1 &&\n        (isRequireCall(path.get(\"declarations.0.init\")) ||\n          (path.get(\"declarations.0.init\").isMemberExpression() &&\n            isRequireCall(path.get(\"declarations.0.init.object\"))))\n      ) {\n        lastImport = path;\n      }\n    });*/\n  }\n\n  _ensure<C extends Map<string, any> | Set<string>>(\n    map: WeakMap<NodePath<t.Program>, C>,\n    programPath: NodePath<t.Program>,\n    Collection: { new (...args: any): C },\n  ): C {\n    let collection = map.get(programPath);\n    if (!collection) {\n      collection = new Collection();\n      map.set(programPath, collection);\n    }\n    return collection;\n  }\n\n  _normalizeKey(\n    programPath: NodePath<t.Program>,\n    url: string,\n    name: string = \"\",\n  ): string {\n    const { sourceType } = programPath.node;\n\n    // If we rely on the imported binding (the \"name\" parameter), we also need to cache\n    // based on the sourceType. This is because the module transforms change the names\n    // of the import variables.\n    return `${name && sourceType}::${url}::${name}`;\n  }\n}\n","import { prettifyTargets } from \"@babel/helper-compilation-targets\";\n\nimport type { Targets } from \"./types\";\n\nexport const presetEnvSilentDebugHeader =\n  \"#__secret_key__@babel/preset-env__don't_log_debug_header_and_resolved_targets\";\n\nexport function stringifyTargetsMultiline(targets: Targets): string {\n  return JSON.stringify(prettifyTargets(targets), null, 2);\n}\n\nexport function stringifyTargets(targets: Targets): string {\n  return JSON.stringify(targets)\n    .replace(/,/g, \", \")\n    .replace(/^\\{\"/, '{ \"')\n    .replace(/\"\\}$/, '\" }');\n}\n","import { intersection } from \"./utils\";\nimport type {\n  Pattern,\n  PluginOptions,\n  MissingDependenciesOption,\n} from \"./types\";\n\nfunction patternToRegExp(pattern: Pattern): RegExp | null {\n  if (pattern instanceof RegExp) return pattern;\n\n  try {\n    return new RegExp(`^${pattern}$`);\n  } catch {\n    return null;\n  }\n}\n\nfunction buildUnusedError(label, unused) {\n  if (!unused.length) return \"\";\n  return (\n    `  - The following \"${label}\" patterns didn't match any polyfill:\\n` +\n    unused.map(original => `    ${String(original)}\\n`).join(\"\")\n  );\n}\n\nfunction buldDuplicatesError(duplicates) {\n  if (!duplicates.size) return \"\";\n  return (\n    `  - The following polyfills were matched both by \"include\" and \"exclude\" patterns:\\n` +\n    Array.from(duplicates, name => `    ${name}\\n`).join(\"\")\n  );\n}\n\nexport function validateIncludeExclude(\n  provider: string,\n  polyfills: Set<string>,\n  includePatterns: Pattern[],\n  excludePatterns: Pattern[],\n) {\n  let current;\n  const filter = pattern => {\n    const regexp = patternToRegExp(pattern);\n    if (!regexp) return false;\n\n    let matched = false;\n    for (const polyfill of polyfills) {\n      if (regexp.test(polyfill)) {\n        matched = true;\n        current.add(polyfill);\n      }\n    }\n    return !matched;\n  };\n\n  // prettier-ignore\n  const include = current = new Set<string> ();\n  const unusedInclude = Array.from(includePatterns).filter(filter);\n\n  // prettier-ignore\n  const exclude = current = new Set<string> ();\n  const unusedExclude = Array.from(excludePatterns).filter(filter);\n\n  const duplicates = intersection(include, exclude);\n\n  if (\n    duplicates.size > 0 ||\n    unusedInclude.length > 0 ||\n    unusedExclude.length > 0\n  ) {\n    throw new Error(\n      `Error while validating the \"${provider}\" provider options:\\n` +\n        buildUnusedError(\"include\", unusedInclude) +\n        buildUnusedError(\"exclude\", unusedExclude) +\n        buldDuplicatesError(duplicates),\n    );\n  }\n\n  return { include, exclude };\n}\n\nexport function applyMissingDependenciesDefaults(\n  options: PluginOptions,\n  babelApi: any,\n): MissingDependenciesOption {\n  const { missingDependencies = {} } = options;\n  if (missingDependencies === false) return false;\n\n  const caller = babelApi.caller(caller => caller?.name);\n\n  const {\n    log = \"deferred\",\n    inject = caller === \"rollup-plugin-babel\" ? \"throw\" : \"import\",\n    all = false,\n  } = missingDependencies;\n\n  return { log, inject, all };\n}\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\nimport type { MetaDescriptor } from \"../types\";\n\nimport { resolveKey, resolveSource } from \"../utils\";\n\nexport default (\n  callProvider: (payload: MetaDescriptor, path: NodePath) => void,\n) => {\n  function property(object, key, placement, path) {\n    return callProvider({ kind: \"property\", object, key, placement }, path);\n  }\n\n  return {\n    // Symbol(), new Promise\n    ReferencedIdentifier(path: NodePath<t.Identifier>) {\n      const {\n        node: { name },\n        scope,\n      } = path;\n      if (scope.getBindingIdentifier(name)) return;\n\n      callProvider({ kind: \"global\", name }, path);\n    },\n\n    MemberExpression(path: NodePath<t.MemberExpression>) {\n      const key = resolveKey(path.get(\"property\"), path.node.computed);\n      if (!key || key === \"prototype\") return;\n\n      const object = path.get(\"object\");\n      if (object.isIdentifier()) {\n        const binding = object.scope.getBinding(object.node.name);\n        if (binding && binding.path.isImportNamespaceSpecifier()) return;\n      }\n\n      const source = resolveSource(object);\n      return property(source.id, key, source.placement, path);\n    },\n\n    ObjectPattern(path: NodePath<t.ObjectPattern>) {\n      const { parentPath, parent } = path;\n      let obj;\n\n      // const { keys, values } = Object\n      if (parentPath.isVariableDeclarator()) {\n        obj = parentPath.get(\"init\");\n        // ({ keys, values } = Object)\n      } else if (parentPath.isAssignmentExpression()) {\n        obj = parentPath.get(\"right\");\n        // !function ({ keys, values }) {...} (Object)\n        // resolution does not work after properties transform :-(\n      } else if (parentPath.isFunction()) {\n        const grand = parentPath.parentPath;\n        if (grand.isCallExpression() || grand.isNewExpression()) {\n          if (grand.node.callee === parent) {\n            obj = grand.get(\"arguments\")[path.key];\n          }\n        }\n      }\n\n      let id = null;\n      let placement = null;\n      if (obj) ({ id, placement } = resolveSource(obj));\n\n      for (const prop of path.get(\"properties\")) {\n        if (prop.isObjectProperty()) {\n          const key = resolveKey(prop.get(\"key\"));\n          if (key) property(id, key, placement, prop);\n        }\n      }\n    },\n\n    BinaryExpression(path: NodePath<t.BinaryExpression>) {\n      if (path.node.operator !== \"in\") return;\n\n      const source = resolveSource(path.get(\"right\"));\n      const key = resolveKey(path.get(\"left\"), true);\n\n      if (!key) return;\n\n      callProvider(\n        {\n          kind: \"in\",\n          object: source.id,\n          key,\n          placement: source.placement,\n        },\n        path,\n      );\n    },\n  };\n};\n","import type { NodePath } from \"@babel/traverse\";\nimport { types as t } from \"@babel/core\";\nimport type { MetaDescriptor } from \"../types\";\n\nimport { getImportSource, getRequireSource } from \"../utils\";\n\nexport default (\n  callProvider: (payload: MetaDescriptor, path: NodePath) => void,\n) => ({\n  ImportDeclaration(path: NodePath<t.ImportDeclaration>) {\n    const source = getImportSource(path);\n    if (!source) return;\n    callProvider({ kind: \"import\", source }, path);\n  },\n  Program(path: NodePath<t.Program>) {\n    path.get(\"body\").forEach(bodyPath => {\n      const source = getRequireSource(bodyPath);\n      if (!source) return;\n      callProvider({ kind: \"import\", source }, bodyPath);\n    });\n  },\n});\n","export function resolve(\n  dirname: string,\n  moduleName: string,\n  absoluteImports: boolean | string,\n): string {\n  if (absoluteImports === false) return moduleName;\n\n  throw new Error(\n    `\"absoluteImports\" is not supported in bundles prepared for the browser.`,\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function has(basedir: string, name: string) {\n  return true;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function logMissing(missingDeps: Set<string>) {}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function laterLogMissing(missingDeps: Set<string>) {}\n","import type {\n  MetaDescriptor,\n  ResolverPolyfills,\n  ResolvedPolyfill,\n} from \"./types\";\n\nimport { has } from \"./utils\";\n\ntype ResolverFn<T> = (meta: MetaDescriptor) => void | ResolvedPolyfill<T>;\n\nconst PossibleGlobalObjects = new Set<string>([\n  \"global\",\n  \"globalThis\",\n  \"self\",\n  \"window\",\n]);\n\nexport default function createMetaResolver<T>(\n  polyfills: ResolverPolyfills<T>,\n): ResolverFn<T> {\n  const { static: staticP, instance: instanceP, global: globalP } = polyfills;\n\n  return meta => {\n    if (meta.kind === \"global\" && globalP && has(globalP, meta.name)) {\n      return { kind: \"global\", desc: globalP[meta.name], name: meta.name };\n    }\n\n    if (meta.kind === \"property\" || meta.kind === \"in\") {\n      const { placement, object, key } = meta;\n\n      if (object && placement === \"static\") {\n        if (globalP && PossibleGlobalObjects.has(object) && has(globalP, key)) {\n          return { kind: \"global\", desc: globalP[key], name: key };\n        }\n\n        if (staticP && has(staticP, object) && has(staticP[object], key)) {\n          return {\n            kind: \"static\",\n            desc: staticP[object][key],\n            name: `${object}$${key}`,\n          };\n        }\n      }\n\n      if (instanceP && has(instanceP, key)) {\n        return { kind: \"instance\", desc: instanceP[key], name: `${key}` };\n      }\n    }\n  };\n}\n","import { declare } from \"@babel/helper-plugin-utils\";\nimport type { NodePath } from \"@babel/traverse\";\n\nimport _getTargets, {\n  isRequired,\n  getInclusionReasons,\n} from \"@babel/helper-compilation-targets\";\nconst getTargets = _getTargets.default || _getTargets;\n\nimport { createUtilsGetter } from \"./utils\";\nimport ImportsCache from \"./imports-cache\";\nimport {\n  stringifyTargetsMultiline,\n  presetEnvSilentDebugHeader,\n} from \"./debug-utils\";\nimport {\n  validateIncludeExclude,\n  applyMissingDependenciesDefaults,\n} from \"./normalize-options\";\n\nimport type {\n  ProviderApi,\n  MethodString,\n  Targets,\n  MetaDescriptor,\n  PolyfillProvider,\n  PluginOptions,\n  ProviderOptions,\n} from \"./types\";\n\nimport * as v from \"./visitors\";\nimport * as deps from \"./node/dependencies\";\n\nimport createMetaResolver from \"./meta-resolver\";\n\nexport type { PolyfillProvider, MetaDescriptor, Utils, Targets } from \"./types\";\n\nfunction resolveOptions<Options>(\n  options: PluginOptions,\n  babelApi,\n): {\n  method: MethodString;\n  methodName: \"usageGlobal\" | \"entryGlobal\" | \"usagePure\";\n  targets: Targets;\n  debug: boolean | typeof presetEnvSilentDebugHeader;\n  shouldInjectPolyfill:\n    | ((name: string, shouldInject: boolean) => boolean)\n    | undefined;\n  providerOptions: ProviderOptions<Options>;\n  absoluteImports: string | boolean;\n} {\n  const {\n    method,\n    targets: targetsOption,\n    ignoreBrowserslistConfig,\n    configPath,\n    debug,\n    shouldInjectPolyfill,\n    absoluteImports,\n    ...providerOptions\n  } = options;\n\n  if (isEmpty(options)) {\n    throw new Error(\n      `\\\nThis plugin requires options, for example:\n    {\n      \"plugins\": [\n        [\"<plugin name>\", { method: \"usage-pure\" }]\n      ]\n    }\n\nSee more options at https://github.com/babel/babel-polyfills/blob/main/docs/usage.md`,\n    );\n  }\n\n  let methodName;\n  if (method === \"usage-global\") methodName = \"usageGlobal\";\n  else if (method === \"entry-global\") methodName = \"entryGlobal\";\n  else if (method === \"usage-pure\") methodName = \"usagePure\";\n  else if (typeof method !== \"string\") {\n    throw new Error(\".method must be a string\");\n  } else {\n    throw new Error(\n      `.method must be one of \"entry-global\", \"usage-global\"` +\n        ` or \"usage-pure\" (received ${JSON.stringify(method)})`,\n    );\n  }\n\n  if (typeof shouldInjectPolyfill === \"function\") {\n    if (options.include || options.exclude) {\n      throw new Error(\n        `.include and .exclude are not supported when using the` +\n          ` .shouldInjectPolyfill function.`,\n      );\n    }\n  } else if (shouldInjectPolyfill != null) {\n    throw new Error(\n      `.shouldInjectPolyfill must be a function, or undefined` +\n        ` (received ${JSON.stringify(shouldInjectPolyfill)})`,\n    );\n  }\n\n  if (\n    absoluteImports != null &&\n    typeof absoluteImports !== \"boolean\" &&\n    typeof absoluteImports !== \"string\"\n  ) {\n    throw new Error(\n      `.absoluteImports must be a boolean, a string, or undefined` +\n        ` (received ${JSON.stringify(absoluteImports)})`,\n    );\n  }\n\n  let targets;\n\n  if (\n    // If any browserslist-related option is specified, fallback to the old\n    // behavior of not using the targets specified in the top-level options.\n    targetsOption ||\n    configPath ||\n    ignoreBrowserslistConfig\n  ) {\n    const targetsObj =\n      typeof targetsOption === \"string\" || Array.isArray(targetsOption)\n        ? { browsers: targetsOption }\n        : targetsOption;\n\n    targets = getTargets(targetsObj, {\n      ignoreBrowserslistConfig,\n      configPath,\n    });\n  } else {\n    targets = babelApi.targets();\n  }\n\n  return {\n    method,\n    methodName,\n    targets,\n    absoluteImports: absoluteImports ?? false,\n    shouldInjectPolyfill,\n    debug: !!debug,\n    providerOptions: providerOptions as any as ProviderOptions<Options>,\n  };\n}\n\nfunction instantiateProvider<Options>(\n  factory: PolyfillProvider<Options>,\n  options: PluginOptions,\n  missingDependencies,\n  dirname,\n  debugLog,\n  babelApi,\n) {\n  const {\n    method,\n    methodName,\n    targets,\n    debug,\n    shouldInjectPolyfill,\n    providerOptions,\n    absoluteImports,\n  } = resolveOptions<Options>(options, babelApi);\n\n  const getUtils = createUtilsGetter(\n    new ImportsCache(moduleName =>\n      deps.resolve(dirname, moduleName, absoluteImports),\n    ),\n  );\n\n  // eslint-disable-next-line prefer-const\n  let include, exclude;\n  let polyfillsSupport;\n  let polyfillsNames;\n  let filterPolyfills;\n\n  const depsCache = new Map();\n\n  const api: ProviderApi = {\n    babel: babelApi,\n    getUtils,\n    method: options.method,\n    targets,\n    createMetaResolver,\n    shouldInjectPolyfill(name) {\n      if (polyfillsNames === undefined) {\n        throw new Error(\n          `Internal error in the ${factory.name} provider: ` +\n            `shouldInjectPolyfill() can't be called during initialization.`,\n        );\n      }\n      if (!polyfillsNames.has(name)) {\n        console.warn(\n          `Internal error in the ${provider.name} provider: ` +\n            `unknown polyfill \"${name}\".`,\n        );\n      }\n\n      if (filterPolyfills && !filterPolyfills(name)) return false;\n\n      let shouldInject = isRequired(name, targets, {\n        compatData: polyfillsSupport,\n        includes: include,\n        excludes: exclude,\n      });\n\n      if (shouldInjectPolyfill) {\n        shouldInject = shouldInjectPolyfill(name, shouldInject);\n        if (typeof shouldInject !== \"boolean\") {\n          throw new Error(`.shouldInjectPolyfill must return a boolean.`);\n        }\n      }\n\n      return shouldInject;\n    },\n    debug(name) {\n      debugLog().found = true;\n\n      if (!debug || !name) return;\n\n      if (debugLog().polyfills.has(provider.name)) return;\n      debugLog().polyfills.add(name);\n      debugLog().polyfillsSupport ??= polyfillsSupport;\n    },\n    assertDependency(name, version = \"*\") {\n      if (missingDependencies === false) return;\n      if (absoluteImports) {\n        // If absoluteImports is not false, we will try resolving\n        // the dependency and throw if it's not possible. We can\n        // skip the check here.\n        return;\n      }\n\n      const dep = version === \"*\" ? name : `${name}@^${version}`;\n\n      const found = missingDependencies.all\n        ? false\n        : mapGetOr(depsCache, `${name} :: ${dirname}`, () =>\n            deps.has(dirname, name),\n          );\n\n      if (!found) {\n        debugLog().missingDeps.add(dep);\n      }\n    },\n  };\n\n  const provider = factory(api, providerOptions, dirname);\n\n  if (typeof provider[methodName] !== \"function\") {\n    throw new Error(\n      `The \"${provider.name || factory.name}\" provider doesn't ` +\n        `support the \"${method}\" polyfilling method.`,\n    );\n  }\n\n  if (Array.isArray(provider.polyfills)) {\n    polyfillsNames = new Set(provider.polyfills);\n    filterPolyfills = provider.filterPolyfills;\n  } else if (provider.polyfills) {\n    polyfillsNames = new Set(Object.keys(provider.polyfills));\n    polyfillsSupport = provider.polyfills;\n    filterPolyfills = provider.filterPolyfills;\n  } else {\n    polyfillsNames = new Set();\n  }\n\n  ({ include, exclude } = validateIncludeExclude(\n    provider.name || factory.name,\n    polyfillsNames,\n    providerOptions.include || [],\n    providerOptions.exclude || [],\n  ));\n\n  return {\n    debug,\n    method,\n    targets,\n    provider,\n    callProvider(payload: MetaDescriptor, path: NodePath) {\n      const utils = getUtils(path);\n      provider[methodName](payload, utils, path);\n    },\n  };\n}\n\nexport default function definePolyfillProvider<Options>(\n  factory: PolyfillProvider<Options>,\n) {\n  return declare((babelApi, options: PluginOptions, dirname: string) => {\n    babelApi.assertVersion(7);\n    const { traverse } = babelApi;\n\n    let debugLog;\n\n    const missingDependencies = applyMissingDependenciesDefaults(\n      options,\n      babelApi,\n    );\n\n    const { debug, method, targets, provider, callProvider } =\n      instantiateProvider<Options>(\n        factory,\n        options,\n        missingDependencies,\n        dirname,\n        () => debugLog,\n        babelApi,\n      );\n\n    const createVisitor = method === \"entry-global\" ? v.entry : v.usage;\n\n    const visitor = provider.visitor\n      ? traverse.visitors.merge([createVisitor(callProvider), provider.visitor])\n      : createVisitor(callProvider);\n\n    if (debug && debug !== presetEnvSilentDebugHeader) {\n      console.log(`${provider.name}: \\`DEBUG\\` option`);\n      console.log(`\\nUsing targets: ${stringifyTargetsMultiline(targets)}`);\n      console.log(`\\nUsing polyfills with \\`${method}\\` method:`);\n    }\n\n    return {\n      name: \"inject-polyfills\",\n      visitor,\n\n      pre() {\n        debugLog = {\n          polyfills: new Set(),\n          polyfillsSupport: undefined,\n          found: false,\n          providers: new Set(),\n          missingDeps: new Set(),\n        };\n\n        provider.pre?.apply(this, arguments);\n      },\n      post() {\n        provider.post?.apply(this, arguments);\n\n        if (missingDependencies !== false) {\n          if (missingDependencies.log === \"per-file\") {\n            deps.logMissing(debugLog.missingDeps);\n          } else {\n            deps.laterLogMissing(debugLog.missingDeps);\n          }\n        }\n\n        if (!debug) return;\n\n        if (this.filename) console.log(`\\n[${this.filename}]`);\n\n        if (debugLog.polyfills.size === 0) {\n          console.log(\n            method === \"entry-global\"\n              ? debugLog.found\n                ? `Based on your targets, the ${provider.name} polyfill did not add any polyfill.`\n                : `The entry point for the ${provider.name} polyfill has not been found.`\n              : `Based on your code and targets, the ${provider.name} polyfill did not add any polyfill.`,\n          );\n\n          return;\n        }\n\n        if (method === \"entry-global\") {\n          console.log(\n            `The ${provider.name} polyfill entry has been replaced with ` +\n              `the following polyfills:`,\n          );\n        } else {\n          console.log(\n            `The ${provider.name} polyfill added the following polyfills:`,\n          );\n        }\n\n        for (const name of debugLog.polyfills) {\n          if (debugLog.polyfillsSupport?.[name]) {\n            const filteredTargets = getInclusionReasons(\n              name,\n              targets,\n              debugLog.polyfillsSupport,\n            );\n\n            const formattedTargets = JSON.stringify(filteredTargets)\n              .replace(/,/g, \", \")\n              .replace(/^\\{\"/, '{ \"')\n              .replace(/\"\\}$/, '\" }');\n\n            console.log(`  ${name} ${formattedTargets}`);\n          } else {\n            console.log(`  ${name}`);\n          }\n        }\n      },\n    };\n  });\n}\n\nfunction mapGetOr(map, key, getDefault) {\n  let val = map.get(key);\n  if (val === undefined) {\n    val = getDefault();\n    map.set(key, val);\n  }\n  return val;\n}\n\nfunction isEmpty(obj) {\n  return Object.keys(obj).length === 0;\n}\n"],"names":["types","t","template","intersection","a","b","result","Set","forEach","v","has","add","object","key","Object","prototype","hasOwnProperty","call","getType","target","toString","slice","resolveId","path","isIdentifier","scope","hasBinding","node","name","deopt","evaluate","resolveKey","computed","isStringLiteral","value","parent","isMemberExpression","get","sym","resolveSource","obj","id","placement","undefined","isRegExpLiteral","isFunction","getImportSource","specifiers","length","source","getRequireSource","isExpressionStatement","expression","isCallExpression","callee","arguments","hoist","_blockHoist","createUtilsGetter","cache","prog","findParent","p","isProgram","injectGlobalImport","url","storeAnonymous","isScript","statement","ast","importDeclaration","injectNamedImport","hint","storeNamed","generateUidIdentifier","importSpecifier","injectDefaultImport","importDefaultSpecifier","ImportsCache","constructor","resolver","_imports","WeakMap","_anonymousImports","_lastImports","_resolver","programPath","getVal","_normalizeKey","imports","_ensure","sourceType","stringLiteral","_injectImport","Map","identifier","set","lastImport","newNodes","container","body","insertAfter","unshiftContainer","newNode","map","Collection","collection","presetEnvSilentDebugHeader","stringifyTargetsMultiline","targets","JSON","stringify","prettifyTargets","patternToRegExp","pattern","RegExp","buildUnusedError","label","unused","original","String","join","buldDuplicatesError","duplicates","size","Array","from","validateIncludeExclude","provider","polyfills","includePatterns","excludePatterns","current","filter","regexp","matched","polyfill","test","include","unusedInclude","exclude","unusedExclude","Error","applyMissingDependenciesDefaults","options","babelApi","missingDependencies","caller","log","inject","all","callProvider","property","kind","ReferencedIdentifier","getBindingIdentifier","MemberExpression","binding","getBinding","isImportNamespaceSpecifier","ObjectPattern","parentPath","isVariableDeclarator","isAssignmentExpression","grand","isNewExpression","prop","isObjectProperty","BinaryExpression","operator","ImportDeclaration","Program","bodyPath","resolve","dirname","moduleName","absoluteImports","basedir","logMissing","missingDeps","laterLogMissing","PossibleGlobalObjects","createMetaResolver","static","staticP","instance","instanceP","global","globalP","meta","desc","getTargets","_getTargets","default","resolveOptions","method","targetsOption","ignoreBrowserslistConfig","configPath","debug","shouldInjectPolyfill","providerOptions","isEmpty","methodName","targetsObj","isArray","browsers","instantiateProvider","factory","debugLog","getUtils","deps","polyfillsSupport","polyfillsNames","filterPolyfills","depsCache","api","babel","console","warn","shouldInject","isRequired","compatData","includes","excludes","found","assertDependency","version","dep","mapGetOr","keys","payload","utils","definePolyfillProvider","declare","assertVersion","traverse","createVisitor","visitor","visitors","merge","pre","providers","apply","post","filename","filteredTargets","getInclusionReasons","formattedTargets","replace","getDefault","val"],"mappings":"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"}
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
