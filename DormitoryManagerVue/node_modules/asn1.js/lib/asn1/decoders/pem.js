<<<<<<< HEAD
var inherits = require('inherits');
var Buffer = require('buffer').Buffer;

var DERDecoder = require('./der');
=======
'use strict';

const inherits = require('inherits');
const Buffer = require('safer-buffer').Buffer;

const DERDecoder = require('./der');
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07

function PEMDecoder(entity) {
  DERDecoder.call(this, entity);
  this.enc = 'pem';
<<<<<<< HEAD
};
=======
}
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
inherits(PEMDecoder, DERDecoder);
module.exports = PEMDecoder;

PEMDecoder.prototype.decode = function decode(data, options) {
<<<<<<< HEAD
  var lines = data.toString().split(/[\r\n]+/g);

  var label = options.label.toUpperCase();

  var re = /^-----(BEGIN|END) ([^-]+)-----$/;
  var start = -1;
  var end = -1;
  for (var i = 0; i < lines.length; i++) {
    var match = lines[i].match(re);
=======
  const lines = data.toString().split(/[\r\n]+/g);

  const label = options.label.toUpperCase();

  const re = /^-----(BEGIN|END) ([^-]+)-----$/;
  let start = -1;
  let end = -1;
  for (let i = 0; i < lines.length; i++) {
    const match = lines[i].match(re);
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
    if (match === null)
      continue;

    if (match[2] !== label)
      continue;

    if (start === -1) {
      if (match[1] !== 'BEGIN')
        break;
      start = i;
    } else {
      if (match[1] !== 'END')
        break;
      end = i;
      break;
    }
  }
  if (start === -1 || end === -1)
    throw new Error('PEM section not found for: ' + label);

<<<<<<< HEAD
  var base64 = lines.slice(start + 1, end).join('');
  // Remove excessive symbols
  base64.replace(/[^a-z0-9\+\/=]+/gi, '');

  var input = new Buffer(base64, 'base64');
=======
  const base64 = lines.slice(start + 1, end).join('');
  // Remove excessive symbols
  base64.replace(/[^a-z0-9+/=]+/gi, '');

  const input = Buffer.from(base64, 'base64');
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
  return DERDecoder.prototype.decode.call(this, input, options);
};
