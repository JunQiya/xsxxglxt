<<<<<<< HEAD
<<<<<<< HEAD
const conversions = require('./conversions');

/*
	This function routes a model to all other models.
=======
var conversions = require('./conversions');

/*
	this function routes a model to all other models.
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
var conversions = require('./conversions');

/*
	this function routes a model to all other models.
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)

	all functions that are routed have a property `.conversion` attached
	to the returned synthetic function. This property is an array
	of strings, each with the steps in between the 'from' and 'to'
	color models (inclusive).

	conversions that are not possible simply are not included.
*/

function buildGraph() {
<<<<<<< HEAD
<<<<<<< HEAD
	const graph = {};
=======
	var graph = {};
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)
	// https://jsperf.com/object-keys-vs-for-in-with-closure/3
	var models = Object.keys(conversions);

<<<<<<< HEAD
	for (let len = models.length, i = 0; i < len; i++) {
=======
	var graph = {};
	// https://jsperf.com/object-keys-vs-for-in-with-closure/3
	var models = Object.keys(conversions);

	for (var len = models.length, i = 0; i < len; i++) {
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
	for (var len = models.length, i = 0; i < len; i++) {
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)
		graph[models[i]] = {
			// http://jsperf.com/1-vs-infinity
			// micro-opt, but this is simple.
			distance: -1,
			parent: null
		};
	}

	return graph;
}

// https://en.wikipedia.org/wiki/Breadth-first_search
function deriveBFS(fromModel) {
<<<<<<< HEAD
<<<<<<< HEAD
	const graph = buildGraph();
	const queue = [fromModel]; // Unshift -> queue -> pop
=======
	var graph = buildGraph();
	var queue = [fromModel]; // unshift -> queue -> pop
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
	var graph = buildGraph();
	var queue = [fromModel]; // unshift -> queue -> pop
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)

	graph[fromModel].distance = 0;

	while (queue.length) {
<<<<<<< HEAD
<<<<<<< HEAD
		const current = queue.pop();
		const adjacents = Object.keys(conversions[current]);

		for (let len = adjacents.length, i = 0; i < len; i++) {
			const adjacent = adjacents[i];
			const node = graph[adjacent];
=======
		var current = queue.pop();
		var adjacents = Object.keys(conversions[current]);

		for (var len = adjacents.length, i = 0; i < len; i++) {
			var adjacent = adjacents[i];
			var node = graph[adjacent];
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
		var current = queue.pop();
		var adjacents = Object.keys(conversions[current]);

		for (var len = adjacents.length, i = 0; i < len; i++) {
			var adjacent = adjacents[i];
			var node = graph[adjacent];
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)

			if (node.distance === -1) {
				node.distance = graph[current].distance + 1;
				node.parent = current;
				queue.unshift(adjacent);
			}
		}
	}

	return graph;
}

function link(from, to) {
	return function (args) {
		return to(from(args));
	};
}

function wrapConversion(toModel, graph) {
<<<<<<< HEAD
<<<<<<< HEAD
	const path = [graph[toModel].parent, toModel];
	let fn = conversions[graph[toModel].parent][toModel];

	let cur = graph[toModel].parent;
=======
	var path = [graph[toModel].parent, toModel];
	var fn = conversions[graph[toModel].parent][toModel];

	var cur = graph[toModel].parent;
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
	var path = [graph[toModel].parent, toModel];
	var fn = conversions[graph[toModel].parent][toModel];

	var cur = graph[toModel].parent;
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)
	while (graph[cur].parent) {
		path.unshift(graph[cur].parent);
		fn = link(conversions[graph[cur].parent][cur], fn);
		cur = graph[cur].parent;
	}

	fn.conversion = path;
	return fn;
}

module.exports = function (fromModel) {
<<<<<<< HEAD
<<<<<<< HEAD
	const graph = deriveBFS(fromModel);
	const conversion = {};
=======
	var graph = deriveBFS(fromModel);
	var conversion = {};
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)

	var models = Object.keys(graph);
	for (var len = models.length, i = 0; i < len; i++) {
		var toModel = models[i];
		var node = graph[toModel];

		if (node.parent === null) {
<<<<<<< HEAD
			// No possible conversion, or this node is the source model.
=======
	var graph = deriveBFS(fromModel);
	var conversion = {};

	var models = Object.keys(graph);
	for (var len = models.length, i = 0; i < len; i++) {
		var toModel = models[i];
		var node = graph[toModel];

		if (node.parent === null) {
			// no possible conversion, or this node is the source model.
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
=======
			// no possible conversion, or this node is the source model.
>>>>>>> parent of 99ae58fb (修正代码，并打包成功上传部署到服务器（测试IP地址）)
			continue;
		}

		conversion[toModel] = wrapConversion(toModel, graph);
	}

	return conversion;
};

