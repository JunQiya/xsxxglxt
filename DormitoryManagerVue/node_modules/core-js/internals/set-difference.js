'use strict';
var aSet = require('../internals/a-set');
var SetHelpers = require('../internals/set-helpers');
var clone = require('../internals/set-clone');
var size = require('../internals/set-size');
var getSetRecord = require('../internals/get-set-record');
var iterateSet = require('../internals/set-iterate');
var iterateSimple = require('../internals/iterate-simple');

var has = SetHelpers.has;
var remove = SetHelpers.remove;

// `Set.prototype.difference` method
<<<<<<< HEAD
// https://tc39.es/ecma262/#sec-set.prototype.difference
=======
// https://github.com/tc39/proposal-set-methods
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
module.exports = function difference(other) {
  var O = aSet(this);
  var otherRec = getSetRecord(other);
  var result = clone(O);
  if (size(O) <= otherRec.size) iterateSet(O, function (e) {
    if (otherRec.includes(e)) remove(result, e);
  });
  else iterateSimple(otherRec.getIterator(), function (e) {
<<<<<<< HEAD
    if (has(result, e)) remove(result, e);
=======
    if (has(O, e)) remove(result, e);
>>>>>>> e6897d3eee7dd92889ec4638067e9f9148ca1f07
  });
  return result;
};
